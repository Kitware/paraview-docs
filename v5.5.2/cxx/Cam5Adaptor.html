<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaView: Cam5 Catalyst Adaptor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParaView
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Cam5 Catalyst Adaptor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We provide a ParaView Catalyst Adaptor for CAM5 simulation with Finite Volume (fv) or Spectral Element (se) dynamic modules. We tested our code with cesm1_2_2.</p>
<p>Files:</p>
<ul>
<li>catalyst_add_and_coprocess.F90: included in one of the simulation files as it needs to call functions from the simulation executable.</li>
<li>fv_create_data.cxx, se_create_data.cxx: initializes and stores the VTK grid.</li>
<li>Grid.cxx, <a class="el" href="Grid_8h.html">Grid.h</a>: manages the VTK grid.</li>
<li>fv_coprocess.py, se_coprocess.py: ParaView pipeline.</li>
<li>cesm1_2_2.patch: patch to Cam5 sources</li>
</ul>
<p>Useful documentation:</p>
<ul>
<li><a href="http://www.cesm.ucar.edu/models/cesm1.2/cam/docs/ug5_3/ug.html">http://www.cesm.ucar.edu/models/cesm1.2/cam/docs/ug5_3/ug.html</a></li>
<li><a href="http://www.cesm.ucar.edu/cgi-bin/eaton/namelist/nldef2html-cam5_3">http://www.cesm.ucar.edu/cgi-bin/eaton/namelist/nldef2html-cam5_3</a></li>
<li><a href="http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/usersguide/book1.html">http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/usersguide/book1.html</a></li>
<li><a href="http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/modelnl/env_run.html">http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/modelnl/env_run.html</a></li>
<li><a href="http://www.cesm.ucar.edu/models/pio/decomp.html">http://www.cesm.ucar.edu/models/pio/decomp.html</a></li>
<li><a href="http://www.cesm.ucar.edu/models/pio/_c_a_mexample.html">http://www.cesm.ucar.edu/models/pio/_c_a_mexample.html</a></li>
<li>For information about the SE grid see <a href="https://www.earthsystemcog.org/projects/dcmip-2012/cam-se">https://www.earthsystemcog.org/projects/dcmip-2012/cam-se</a>.</li>
</ul>
<p>To build CAM5 and the Catalyst adaptor:</p>
<ol type="1">
<li><p class="startli">Download ParaView source code and download CESM (Community Earth System Model) source code using instructions in:</p>
<p class="startli"><a href="http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/usersguide/book1.html">http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/usersguide/book1.html</a></p>
</li>
<li>Modify <code>configure-cam.sh</code>, <code>gen-cam.sh</code>, <code>build-namelist.sh</code> in <code>~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/</code> such that <code>CAM_ROOT</code> points to the location for <code>cesm1_2_2</code> sources. By default the scripts assume that <code>cesm1_2_2</code> is stored in <code>~/src/cesm_1_2_2</code>.</li>
<li><p class="startli">Set <code>PARAVIEW_BUILD_CATALYST_ADAPTORS</code> to <code>On</code> and build ParaView.</p>
<p class="startli">Patch <code>cesm1_2_2</code> sources to call the Catalyst Adaptor: </p><pre class="fragment">cd ~/src/cesm1_2_2/models/atm/cam
patch &lt; ~/build/ParaView/CoProcessing/Adaptors/CamAdaptor/cesm1_2_2.patch
</pre><p class="startli">By default, Cam5 Adaptor saves the simulation data. See <code>fv_coprocess.py</code> and <code>se_coprocess.py</code> for the ParaView pipeline that is executed. To execute a different script you can modify those files or modify <code>src/cpl_mct/atm_comp_mct.F90</code> to point to your scripts.</p>
</li>
<li><p class="startli">Configure Cam5: </p><pre class="fragment"> mkdir ~/build/cam-5.3
 cd ~/build/cam-5.3
</pre><p class="startli">Edit the configuration script by uncommenting the configuration you want or creating a different configuration. Parameters for finite volume and spectral element with different grid sizes are available. Run the configuration script. </p><pre class="fragment">~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/configure-cam.sh
</pre><p class="startli">Note you have to configure the number of MPI processors and use the same number when you run the simulation.</p>
<p class="startli">Build cam5: </p><pre class="fragment">make -j10
</pre></li>
<li><p class="startli">Create a run directory for the simulation and create the parameters for the simulation. This is where you set for how long you run the simulation and how often you save data. </p><pre class="fragment"> mkdir ~/run/cam-5.3
 cd ~/run/cam-5.3
 ~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/build-namelist.sh | grep FOUND
</pre><p> Namelists (parameters) for the simulation are listed in:</p>
<p class="startli"><a href="http://www.cesm.ucar.edu/cgi-bin/eaton/namelist/nldef2html-cam5_3">http://www.cesm.ucar.edu/cgi-bin/eaton/namelist/nldef2html-cam5_3</a></p>
<p class="startli">Different configurations need different data files. If any of the required data files are NOT FOUND download them from: <a href="https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata">https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata</a> Don't checkout everything as the datafiles are big! First checkout individual empty directories leading to the file you are interested in: </p><pre class="fragment">cd ~/src/cesm-data
svn update --depth empty atm
cd atm
svn update --depth empty cam
cd cam
svn update --depth empty inic
cd inic
svn update --depth empty homme
cd homme
</pre><p class="startli">Then checkout the file: </p><pre class="fragment">svn update cami-mam3_0000-01-01_ne30np4_L30_c130424.nc
</pre></li>
<li><p class="startli">Run the simulation: </p><pre class="fragment"> ~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/run-cam.sh
</pre><p class="startli">The data fields generated by the simulation (those stored in the .nc file) are listed in:</p>
<p class="startli"><a href="http://www.cesm.ucar.edu/models/cesm1.2/cam/docs/ug5_3/hist_flds_fv_cam5.html">http://www.cesm.ucar.edu/models/cesm1.2/cam/docs/ug5_3/hist_flds_fv_cam5.html</a></p>
<p class="startli">You can view the history file <code>camrun.cam.h0.*.nc</code> in ParaView using 'NetCDF files generic and CF conventions' reader. You can switch the dimensions viewed to be (lat,lon) or (lev, lat, lon) to get a sphere or a ball.</p>
</li>
<li><p class="startli">Optional: If you want to debug certain pio files in the simulation run: </p><pre class="fragment"> ~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/gen-cam.sh d
</pre><p class="startli">This command copies a list of .F90.in to the corresponding .F90 so that gdb works correctly over these files. When you need to rebuild run: </p><pre class="fragment">~/src/ParaView/CoProcessing/Adaptors/CamAdaptor/gen-cam.sh g
</pre></li>
</ol>
<p>To dump the history file produced by the simulation in text format run ncdump camrun.cam.h0.*.nc &gt; camrun.txt</p>
<p>See <a href="http://www.unidata.ucar.edu/software/netcdf/docs/netcdf_utilities_guide.html#ncdump_SYNOPSIS">http://www.unidata.ucar.edu/software/netcdf/docs/netcdf_utilities_guide.html#ncdump_SYNOPSIS</a> for more information. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
