<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaView: Implementation Details: String Encoding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="height: 56px;">
  <div class="pv-title-cpp title-line">
    <div class="title-line">
      <img class="pv-logo" src="paraview-logo-small.png" />
    </div>
    <div class="langSwitch title-line"></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Implementation Details: String Encoding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page summarizes the design details of string encoding in ParaView, which covers pq to SM string call and SI to VTK / VTK to SI string arguments passing.</p>
<h2>Motivation</h2>
<p>For a long time, ParaView used a simple implementation when passing string arguments. pq Classes handles QString, which are a vory robust implementation of string that need to be converted before being used as an actual c string. For this conversion, ParaView used to use QString::toLatin1(), which works fine, in order to pass the String to SM level. Then on lower levels, all classes manipulate the same c string, without any reencoding.</p>
<p>This works fine most of the time, except in some cases, when the string contains special characters. And it can happens a lot with filenames.</p>
<p>They were two reasons for it not to work. First the client/server communication is done via a library called protobuf, which support only UTF8 string. Second, Latin1 is a specific encoding, which can be different from the local 8 Bits encoding of strings.</p>
<p>Special character are now supported in filenames in ParaView, and one should take care of conversion when handling filenames.</p>
<h2>Design</h2>
<p>Once the problem is understood, the design is quite simple. QString in pq classes given as an argument of non-pq classes should be encoded to local 8 bit encoding when used locally. QString in pq classes given as an argument of SM classes that will transfer it to the server should be encoded to utf8. In SI classes, string should then reencoded to local 8 bit before being given to vtk classes SI classes recovering string from vtk classes should re-encode string in utf8.</p>
<h2>Usage</h2>
<p>When developping a new feature, especially a Qt feature handling filenames, one should use the following pattern :</p><ul>
<li>Filename QString that need to be converted to c-string and used <b>locally</b> should be encoded using <b>QString::toLocal8Bit</b>.</li>
<li>Filename QString that need to be converted to c-string and <b>transferred to the server</b> should be encoded using <b>QString::toUtf8</b>.</li>
<li>All <b>other</b> QString should be converted <b>using QString::toUtf8</b> unless specific reasons.</li>
</ul>
<p>The server side is done automatically for filename StringVectorProperty, and a few other cases.</p>
<h2>Notes </h2>
<p>This page is generated from <em><a class="el" href="StringEncoding_8md.html">StringEncoding.md</a></em>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15 on Tue Feb 18 2020
</small></address>
<!-- KW:BEGIN -->
<!-- this adds the version selection header -->
<script type="text/javascript" src="/paraview-docs/paraview-version.js"></script>
<!-- KW:END -->
</body>
</html>
