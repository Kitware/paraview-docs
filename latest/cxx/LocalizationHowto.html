<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaView: Localization Howto</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="height: 56px;">
  <div class="pv-title-cpp title-line">
    <div class="title-line">
      <img class="pv-logo" src="paraview-logo-small.png" />
    </div>
    <div class="langSwitch title-line"></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Localization Howto </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>ParaView comes with a localization system that handles the complete language introspection workflow, from translation searching in the source code to language selection in the settings.</p>
<p>The theoretical workflow for a single language runs as follows:</p>
<ul>
<li>The ParaView build system generates translation source files (.ts files) in the chosen destination repository.</li>
<li>The translation from English to the desired language is written into these source files</li>
<li>These translations files are compiled into a binary file (.qm file) and installed in the <code>translations</code> shared folder of ParaView.</li>
<li>The language can then be selected in the settings <code>Interface Language</code> section.</li>
</ul>
<p>In practice, the process is slightly more complex since we use an official translation source repository that is updated by a translations CMS, for simplifying contributions.</p>
<h3>Technologies used</h3>
<p>Most of the steps are done using two of the <a href="https://doc.qt.io/qt-5/linguist-manager.html">Qt5's linguist utilities</a>:</p><ul>
<li><code>lupdate</code>, a source file parser that can parse C++ and Qt's UI files for translatable strings, and then generates a .ts file from it</li>
<li><code>lrelease</code>, a .ts file compiler, that generates the .qm files.</li>
</ul>
<p>These utilities are invoked in the ParaView CMake build system and in the official ts repository respectively.</p>
<h3>What is translated</h3>
<ul>
<li>Interface (Menus, buttons...)</li>
<li>Proxy and property names/labels and docs (see below for the exhaustive list).</li>
</ul>
<h2>Glossary</h2>
<ul>
<li>locale: In this context, a locale is a string in the format <code>&lt;language&gt;_&lt;COUNTRY&gt;</code>. It is a language's national variant.</li>
<li>lrelease: A Qt utility that transforms ts files into a qm.</li>
<li>lupdate: A Qt utility that parses .ui and C++ files into ts files.</li>
<li>.qm: A Qt resource file containing translations.</li>
<li>Qt linguist: A Qt tool to fill ts files with translations.</li>
<li>translation context: Qt enforces that all translations are within a context, possibly user-specified. In ParaView, the standard is to use the class name as context. For a translation to be used, the context must be the same at parse-time and at runtime.</li>
<li>.ts: A Qt's xml containing string to translate and its translation if filled.</li>
<li>.ui: A Qt resource file containing user interface layouts.</li>
</ul>
<h2>Writing translatable source code</h2>
<p>All the source code in ParaView should ideally be translatable. A string is <em>translatable</em> if it can be found by lupdate.</p>
<p>Strings displayed in the ParaView client can come from three main sources:</p><ul>
<li>Qt's UI files</li>
<li>C++ source code that is Qt-related</li>
<li>XML proxy files</li>
</ul>
<p>Qt's UI files are automatically found by lupdate, so if a string shall <b>not</b> be translated (ie ParaView's name !) it has to have its <code>translatable</code> property disabled in Qt Designer.</p>
<h3>In the ParaView Qt classes</h3>
<p>An exhaustive guide to translatable source code using Qt5 can be found <a href="https://doc.qt.io/qt-5/i18n-source-translation.html">here</a>.</p>
<p>For setting the translatable property of a string in the most common cases:</p><ul>
<li>If an explicit string is in a class inheriting QObject that has the <code>Q_OBJECT</code> macro, you can use the <code>tr(&lt;explicitStringToTranslate&gt;)</code> method of <code>QObject</code>, without specifying <code>this-&gt;</code> before (<a href="https://gitlab.kitware.com/paraview/paraview/-/blob/c055918678939470ba25e2334e131870da8f2fde/Qt/ApplicationComponents/pqSaveDataReaction.cxx#L159">example</a>).</li>
<li>If a class cannot be given the <code>Q_OBJECT</code> macro, or does not inherit from <code>QObject</code>, you can either:<ul>
<li>add the <code>Q_DECLARE_TR_FUNCTIONS(&lt;className&gt;)</code> to the class and then call <code>tr(&lt;explicitStringToTranslate&gt;)</code> inside (<a href="https://gitlab.kitware.com/paraview/paraview/-/blob/c055918678939470ba25e2334e131870da8f2fde/Qt/Components/pqArrayListWidget.cxx#L46">example</a>) or</li>
<li>write <code>QCoreApplication::translate(&lt;className&gt;, &lt;explicitStringToTranslate&gt;)</code> for every string to translate in the class (<a href="https://gitlab.kitware.com/paraview/paraview/-/blob/c055918678939470ba25e2334e131870da8f2fde/Qt/ApplicationComponents/pqParaViewMenuBuilders.cxx#L329">example</a>).</li>
</ul>
</li>
<li>If the string is located outside of a class, method or even function, you can use <code>QT_TRANSLATE_NOOP(&lt;contextName&gt;, &lt;explicitStringToTranslate&gt;)</code>.</li>
</ul>
<p>All these methods requires the include of <code>QCoreApplication</code>.</p>
<p>Some examples: </p><div class="fragment"><div class="line"><span class="comment">// When inside a class method with Q_OBJECT macro</span></div><div class="line"><span class="keyword">class </span>someClass : QObject</div><div class="line">{</div><div class="line">    Q_OBJECT</div><div class="line">    QString someMethod();</div><div class="line">};</div><div class="line"></div><div class="line">QString someClass::someMethod()</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> tr(<span class="stringliteral">&quot;Translated string&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// When inside a class without Q_OBJECT macro</span></div><div class="line"><span class="keyword">class </span>someNonQtClass</div><div class="line">{</div><div class="line">    Q_DECLARE_TR_FUNCTIONS(someNonQtClass)</div><div class="line">    QString someMethod();</div><div class="line">};</div><div class="line"></div><div class="line">QString someNonQtClass::someMethod()</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> tr(<span class="stringliteral">&quot;Translated string&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">class </span>someNonQtClass2</div><div class="line">{</div><div class="line">    QString someMethod();</div><div class="line">};</div><div class="line"></div><div class="line">QString someNonQtClass2::someMethod()</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> QCoreApplication::translate(<span class="stringliteral">&quot;someNonQtClass2&quot;</span>, <span class="stringliteral">&quot;Translated string&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// When outside of any method</span></div><div class="line">QString someFunction()</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> QT_TRANSLATE_NOOP(<span class="stringliteral">&quot;translationContext&quot;</span>, <span class="stringliteral">&quot;Translated string&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><h3>Making Proxy XML elements translatable</h3>
<p>The XML format is not natively supported by lupdate. Therefore, <code>CMake/XML_translations_header_generator.py</code> was developed. It transforms proxy XMLs into C++ headers in order to be found by lupdate.</p>
<p>In a C++ code that displays text from the XML, it is now mandatory to use the context "ServerManagerXML" so that the translation can be found at runtime. E.g.: <code>QCoreApplication::translate("ServerManagerXML", &lt;translated XML element&gt;));</code>.</p>
<p>Currently translatable XML fields are:</p>
<ul>
<li><code>label</code>, which can be an attribute of any element</li>
<li><code>menu_label</code>, which can be an attribute of any element</li>
<li><code>Documentation</code> element's content<ul>
<li><code>long_help</code> attribute</li>
<li><code>short_help</code> attribute</li>
</ul>
</li>
<li>All <code>*Property</code>'s <code>name</code>s</li>
</ul>
<p>This behavior can be extended by adding new elements or attributes to parse in the python utility.</p>
<h2>Testing new translations</h2>
<p>The plugin <code>TranslationsTesting</code>, bundled with ParaView, is built by default when enabling the <code>PARAVIEW_BUILD_TRANSLATIONS</code> option. It will search though the main window for untranslated strings and print a warning if found.</p>
<p>This plugin is meant to be run through ctest, with the <code>TranslationsTesting</code> test. It might be slow since it uses Regexes for its widget-ignore list (hopefully this list will be empty, otherwise, you will have the time to admire the improved version of ParaView).</p>
<h3>Ignoring untranslated strings</h3>
<p>Some source strings could not, or should not be translatable (ie ParaView's name !). ParaView translatability is tested on the ParaView's Gitlab CI, so if a string cannot be translated, the widget/action containing it <b>has</b> to be be added on the ignore list of the plugin.</p>
<p>The ignore list is located at <code>Plugins/TranslationsTesting/pqTranslationsTesting.h</code>. You can use either</p><ul>
<li><code>TRANSLATION_IGNORE_STRINGS</code> to ignore a precise widget/action, or</li>
<li><code>TRANSLATION_IGNORE_REGEXES</code> to ignore a range of widgets.</li>
</ul>
<p>Both lists take pairs of strings: the first element is the name of the widget and the second is the attribute to ignore or an empty string to ignore all attributes.</p>
<p>The tested Qt attributes are text, <code>toolTip</code>, <code>windowTitle</code>, <code>placeholderText</code>, <code>text</code> and <code>label</code>.</p>
<h2>Translation workflow</h2>
<h3>Source files generation</h3>
<p>When <code>PARAVIEW_BUILD_TRANSLATIONS</code> is enabled, translations source files are built in the given <code>PARAVIEW_TRANSLATIONS_DIRECTORY</code>. A specific build target <code>localization</code> can be used separatly from the ALL target to build them.</p>
<h3>Source files filling</h3>
<p>There is an official <a href="https://gitlab.kitware.com/paraview/paraview-translations">paraview-translations</a> repository containing up-to-date source files.</p>
<p>The target <code>files_update</code> will complete all ts files of all languages with the source strings. A single language can also be updated using the special target <code>&lt;locale&gt;_update</code>.</p>
<p>After this step, translators can fill ts files with translations using <a href="https://doc.qt.io/qt-5/linguist-translators.html">Qt Linguist</a> or any other tool supporting ts files.</p>
<h3>Source file compilation</h3>
<p>Source files can be compiled into qm files using the CMake process of the translations repository. Each locale with a folder in the translations repository is a valid target that will create a qm.</p>
<p>It is also possible to compile ts files manually using lrelease. The command is <code>lrelease &lt;input files&gt; -qm &lt;outputQm&gt;</code>.</p>
<h3>Binary files loading</h3>
<p>Qm files can be loaded from the general settings. If a qm is found by ParaView, the language it provides will be available in the <code>Interface language</code> Combobox. The selected language is saved in the settings, and a restart is required.</p>
<p>By default, ParaView searches for qms in the <code>translations</code> shared folder. The environment variable <code>PV_TRANSLATIONS_DIR</code> can provide other searching paths. When multiple qm files have the same language, the first qm found will be used, using the <code>PV_TRANSLATIONS_DIR</code> paths first, and the default path after.</p>
<p>The locale can also be forced using the <code>PV_TRANSLATIONS_LOCALE</code> environment variable. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13 on Mon Jul 15 2024
</small></address>
<!-- KW:BEGIN -->
<!-- this adds the version selection header -->
<script type="text/javascript" src="/paraview-docs/paraview-version.js"></script>
<!-- KW:END -->
</body>
</html>
