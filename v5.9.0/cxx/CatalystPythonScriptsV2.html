<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaView: Anatomy of Catalyst Python Module (Version 2.0)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="height: 56px;">
  <div class="pv-title-cpp title-line">
    <div class="title-line">
      <img class="pv-logo" src="paraview-logo-small.png" />
    </div>
    <div class="langSwitch title-line"></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Anatomy of Catalyst Python Module (Version 2.0) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes the details of Python modules intended for use in Catalyst. This page covers features supported by ParaView 5.9 and later i.e. version 2.0.</p>
<h2>Basics</h2>
<p>Catalyst Python modules are simply Python scripts that use the <code>paraview</code> package to define data analysis and visualization pipelines. You use these modules to define the analysis pipelines to be executed in a Catalyst-instrumented simulation code, for example.</p>
<p><a href="https://docs.python.org/3/tutorial/modules.html">Python</a> defines a module as a file containing Python definitions and statements. The file name for a module is the name of the module suffixed by extension <code>.py</code>. Thus a module named <code>foo</code> will be in a file named <code>foo.py</code>.</p>
<p><a href="https://docs.python.org/3/tutorial/modules.html#packages">Packages</a> are a mechanism for structuring multiple modules. Essentially, if you place a bunch of .py files (aka modules) in a directory structure, that becomes a package! Of course, there's a little more to that and the <a href="https://docs.python.org/3/tutorial/modules.html#packages">Python docs</a> are a highly recommended read. Similar to the convection to name a module using the file name, the name of the directory representing a Python package becomes the name of the package. A package can contain multiple directories (sub-packages) and Python files.</p>
<p>When a Python module is <em>imported</em> into the application, the Python statements in the module are executed. Since a Python module is a file, the execution starts with the first statement in the file and continues till the end of the file is reached or an error is encountered.</p>
<p>When a Python package is <em>imported</em>, the entry-point is defined by a file named <code>__init__.py</code> with in the package. Statements in this file are executed. In the simplest case, <code>__init__.py</code> can be an empty file, but it can also execute initialization code, including importing other modules, packages, sub-packages etc.</p>
<p>Catalyst Python code can be structured as modules or packages. In either case, the module (or package) is imported and then functions or variables defined on the module (or package) are checked and invoked as described in following sections.</p>
<h2><a class="el" href="classvtkCPPythonScriptV2Pipeline.html" title="vtkCPPipeline for Catalyst Python script / package version 2.0 ">vtkCPPythonScriptV2Pipeline</a></h2>
<p>Catalyst adaptors should use <code><a class="el" href="classvtkCPPythonScriptV2Pipeline.html" title="vtkCPPipeline for Catalyst Python script / package version 2.0 ">vtkCPPythonScriptV2Pipeline</a></code> to execute scripts as described in this document. For older Catalyst Python scripts, i.e. those that use <code>RequestDataDescription</code> and <code>DoCoProcess</code> functions, should continue to use <code><a class="el" href="classvtkCPPythonScriptPipeline.html" title="Class that creates a coprocessing pipeline starting from a coprocessing script. ">vtkCPPythonScriptPipeline</a></code> and <code><a class="el" href="classvtkCPPythonStringPipeline.html" title="Class that creates a coprocessing pipeline from a coprocessing string. ">vtkCPPythonStringPipeline</a></code> at this time. It is conceivable that we provide a wrapper that lets us use <code><a class="el" href="classvtkCPPythonScriptV2Pipeline.html" title="vtkCPPipeline for Catalyst Python script / package version 2.0 ">vtkCPPythonScriptV2Pipeline</a></code> for these older script too, however, that has not been implemented at this time.</p>
<p><code><a class="el" href="classvtkCPPythonPipeline.html#a965eb321f4815bcdca21a1beb00d1da4" title="Starting with ParaView 5.9, there are two versions of Python scripts that ParaView supports...">vtkCPPythonPipeline::DetectScriptVersion</a></code> may be used to detect the version number for the script. The logic relies on the file type and presence of certain comments in the header of the file to determine which version it may be.</p>
<p>Adaptors may use <code><a class="el" href="classvtkCPPythonPipeline.html#a100988565470d540cad5c96bcdf4e6c6" title="Detects the script version, if possible and created appropriate subclass. ">vtkCPPythonPipeline::CreatePipeline</a></code> to create appropriate <code><a class="el" href="classvtkCPPythonPipeline.html" title="Abstract class that takes care of initializing Catalyst Python pipelines for all concrete implementat...">vtkCPPythonPipeline</a></code> subclass based on the script version.</p>
<h2>Structure</h2>
<p>Now, let's look at the structure of a Catalyst Python module. The same is applicable to a Python package as well.</p>
<h3>Visualization Pipeline</h3>
<p>ParaView Python API, exposed via the <code>paraview.simple</code> module, is used to define the visualization and data analysis pipeline. The API mimics actions one would take the GUI. For example, simple script to create a <b>Wavelet</b> source and slice it, looks as follows:</p>
<div class="fragment"><div class="line"><span class="comment"># filename: sample1.py</span></div><div class="line"><span class="keyword">from</span> paraview.simple <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> paraview <span class="keyword">import</span> print_info</div><div class="line"></div><div class="line"><span class="comment"># print start marker</span></div><div class="line">print_info(<span class="stringliteral">&quot;begin &#39;%s&#39;&quot;</span>, __name__)</div><div class="line"></div><div class="line">wavelet1 = Wavelet(registrationName=<span class="stringliteral">&#39;Wavelet1&#39;</span>)</div><div class="line"></div><div class="line"><span class="comment"># create a new &#39;Slice&#39;</span></div><div class="line">slice1 = Slice(registrationName=<span class="stringliteral">&#39;Slice1&#39;</span>, Input=wavelet1)</div><div class="line">slice1.SliceType = <span class="stringliteral">&#39;Plane&#39;</span></div><div class="line">slice1.SliceType.Normal = [0, 0, 1]</div><div class="line"></div><div class="line"><span class="comment"># print end marker</span></div><div class="line">print_info(<span class="stringliteral">&quot;end &#39;%s&#39;&quot;</span>, __name__)</div></div><!-- fragment --><p>This same code can be used in a Catalyst Python script to setup the visualization pipeline. The only thing to note is that we need a mechanism to indicate which of the data-producers in the pipeline should be replaced by the data generated by the simulation. In Catalyst, the data produced by the simulation is available on named channels. Thus, we need to identify which named-channel corresponds to which data data-producer in the pipeline. For that, we use the <code>registrationName</code> attribute. In the Python script, when creating a source or a filter, one can pass in an optional argument <code>registrationName</code>. When the script is being executed within Catalyst, Catalyst looks to see if the <code>registrationName</code> matches the name of a known channel. If so, the data producer type requested (in this case Wavelet) is ignored and instead is replaced by a producer that provides simulation data as the output.</p>
<p>The <code>paraview.demos.wavelet_miniapp</code> is a miniapp that acts as a simulation producing a time value <code><a class="elRef" doxygen="/builds/gitlab-kitware-sciviz-ci/build/Utilities/Doxygen/vtkNightlyDoc.tag:http://www.vtk.org/doc/nightly/html/" href="http://www.vtk.org/doc/nightly/html/classvtkImageData.html">vtkImageData</a></code> dataset. So we can use it to run the above script as follows:</p>
<div class="fragment"><div class="line">&gt; pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">          --script .../sample1.py</div><div class="line">          --script-version 2</div><div class="line">          --timesteps 2</div><div class="line"></div><div class="line">(   0.550s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.830s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/2</div><div class="line">(   1.897s) [pvbatch         ]             sample1.py:6     INFO| begin &#39;sample1&#39;</div><div class="line">(   1.933s) [pvbatch         ]             sample1.py:16    INFO| end &#39;sample1&#39;</div><div class="line">(   1.933s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample1&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   1.936s) [pvbatch         ]vtkCPPythonScriptV2Help:432   WARN| script may not depend on simulation data; is that expected?</div><div class="line">(   1.937s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/2</div><div class="line">(   1.985s) [pvbatch         ]vtkCPPythonScriptV2Help:432   WARN| script may not depend on simulation data; is that expected?</div></div><!-- fragment --><p>Let's inspect the warnings to understand what's going on.</p>
<p><code>bridge.py:17</code> warning can be ignored for now. The <code>INFO</code> messages are produced by <code>wavelet_miniapp.py</code> to provide information about the timestep as it progresses through the mock-simulation timesteps.</p>
<p>`Module 'sample1' missing Catalyst 'options', will use a default options object` warning lets us know that the Catalyst will default 'options'. More on that later.</p>
<p><code>script may not depend on simulation data; is that expected?</code> tells us that the pipeline we've setup in this script does not use any data produced by the simulation at all. While there's nothing wrong with that, it's highly unlikely that that's the intent and hence this warning is posted.</p>
<p>In our case, we want the <code>Wavelet</code> source to be replaced by the simulation data. As mentioned, this means the <code>registrationName</code> should match the simulation channel name. <code>wavelet_miniapp</code> uses <b>input</b> as the default channel name. It can be changed using <code>-c</code> (or <code>--channel</code>) command line argument. Let's rename the channel using <code>--channel</code>.</p>
<div class="fragment"><div class="line">&gt; pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">          --script .../sample1.py</div><div class="line">          --script-version 2</div><div class="line">          --timesteps 2</div><div class="line">          --channel Wavelet1</div><div class="line"></div><div class="line">(   0.563s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.876s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/2</div><div class="line">(   1.944s) [pvbatch         ]             sample1.py:6     INFO| begin &#39;sample1&#39;</div><div class="line">(   2.069s) [pvbatch         ]             sample1.py:16    INFO| end &#39;sample1&#39;</div><div class="line">(   2.069s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample1&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   2.072s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/2</div></div><!-- fragment --><p>Great! Now the warnings about simulation data have disappeared.</p>
<p>The pipeline, however, still doesn't do anything significant.</p>
<p>Also, the code in the module seems to execute only once, for the first timestep. This is confirmed by the fact that the <code>print_info</code> statements in <code>sample.py</code> only show up once in the output. This is because the code in the module gets executed only when its imported for the first time. Once imported, which happens on first timestep, the module is not re-imported and hence the code is not re-executed.</p>
<p>To add code that gets executed each iteration, you can define a <code>catalyst_execute</code> function. Likewise, <code>catalyst_initialize</code> and <code>catalyst_finalize</code> functions may be defined too and they will get called for the first and after the last timestep respectively. Here's an example script to see that in action.</p>
<div class="fragment"><div class="line"><span class="comment"># filename: sample2.py</span></div><div class="line"><span class="keyword">from</span> paraview.simple <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> paraview <span class="keyword">import</span> print_info</div><div class="line"></div><div class="line"><span class="comment"># print start marker</span></div><div class="line">print_info(<span class="stringliteral">&quot;begin &#39;%s&#39;&quot;</span>, __name__)</div><div class="line"></div><div class="line">w = Wavelet(registrationName=<span class="stringliteral">&quot;Wavelet1&quot;</span>)</div><div class="line"></div><div class="line"><span class="keyword">def </span>catalyst_initialize():</div><div class="line">    print_info(<span class="stringliteral">&quot;in &#39;%s::catalyst_initialize&#39;&quot;</span>, __name__)</div><div class="line"></div><div class="line"><span class="keyword">def </span>catalyst_execute(info):</div><div class="line">    print_info(<span class="stringliteral">&quot;in &#39;%s::catalyst_execute&#39;&quot;</span>, __name__)</div><div class="line"></div><div class="line"><span class="keyword">def </span>catalyst_finalize():</div><div class="line">    print_info(<span class="stringliteral">&quot;in &#39;%s::catalyst_finalize&#39;&quot;</span>, __name__)</div><div class="line"></div><div class="line"><span class="comment"># print end marker</span></div><div class="line">print_info(<span class="stringliteral">&quot;end &#39;%s&#39;&quot;</span>, __name__)</div></div><!-- fragment --><p>When executed using the <code>wavelet_miniapp</code> (this time, let's execute for 3 timesteps just to make things a little clearer), we get the following:</p>
<div class="fragment"><div class="line">&gt; ./bin/pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">                --script /tmp/sample2.py</div><div class="line">                --script-version 2</div><div class="line">                --timesteps 3</div><div class="line">                --channel Wavelet1</div><div class="line"></div><div class="line">(   0.559s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.865s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/3</div><div class="line">(   1.933s) [pvbatch         ]             sample2.py:6     INFO| begin &#39;sample2&#39;</div><div class="line">(   1.939s) [pvbatch         ]             sample2.py:20    INFO| end &#39;sample2&#39;</div><div class="line">(   1.939s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample2&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   1.943s) [pvbatch         ]             sample2.py:11    INFO| in &#39;sample2::catalyst_initialize&#39;</div><div class="line">(   1.943s) [pvbatch         ]             sample2.py:14    INFO| in &#39;sample2::catalyst_execute&#39;</div><div class="line">(   1.943s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/3</div><div class="line">(   1.994s) [pvbatch         ]             sample2.py:14    INFO| in &#39;sample2::catalyst_execute&#39;</div><div class="line">(   1.994s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 3/3</div><div class="line">(   2.043s) [pvbatch         ]             sample2.py:14    INFO| in &#39;sample2::catalyst_execute&#39;</div><div class="line">(   2.044s) [pvbatch         ]             sample2.py:17    INFO| in &#39;sample2::catalyst_finalize&#39;</div></div><!-- fragment --><p>Note that <code>catalyst_initialize</code> and <code>catalyst_finalize</code> only gets called once while <code>catalyst_execute</code> gets called for each iteration.</p>
<p>The <code>info</code> object passed to <code>catalyst_initialize</code> can be used to obtain information about the current invocation which may be useful when writing code to execute per iteration.</p>
<div class="fragment"><div class="line">&gt; help(info)</div><div class="line"></div><div class="line">Help on Information in module paraview.catalyst.v2_internals object:</div><div class="line"></div><div class="line">class Information(builtins.object)</div><div class="line"> |  Information(dataDescription)</div><div class="line"> |</div><div class="line"> |  Provides information to the current `catalyst_execute` call.</div><div class="line"> |</div><div class="line"> |  Methods defined here:</div><div class="line"> |</div><div class="line"> |  __init__(self, dataDescription)</div><div class="line"> |      Initialize self.  See help(type(self)) for accurate signature.</div><div class="line"> |</div><div class="line"> |  ----------------------------------------------------------------------</div><div class="line"> |  Readonly properties defined here:</div><div class="line"> |</div><div class="line"> |  cycle</div><div class="line"> |      returns the current simulation cycle or timestep index</div><div class="line"> |</div><div class="line"> |  dataDescription</div><div class="line"> |      avoid using this unless absolutely sure what you&#39;re doing</div><div class="line"> |</div><div class="line"> |  time</div><div class="line"> |      returns the current simulation time</div><div class="line"> |</div><div class="line"> |  timestep</div><div class="line"> |      returns the current simulation cycle or timestep index</div></div><!-- fragment --><p>Here's a sample script that saves out an image each iteration.</p>
<div class="fragment"><div class="line"><span class="comment"># filename: sample3.py</span></div><div class="line"><span class="keyword">from</span> paraview.simple <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> paraview <span class="keyword">import</span> print_info</div><div class="line"></div><div class="line">view = CreateRenderView()</div><div class="line"></div><div class="line">wavelet1 = Wavelet(registrationName=<span class="stringliteral">&quot;Wavelet1&quot;</span>)</div><div class="line"></div><div class="line"><span class="comment"># create a new &#39;Slice&#39;</span></div><div class="line">slice1 = Slice(registrationName=<span class="stringliteral">&#39;Slice1&#39;</span>, Input=wavelet1)</div><div class="line">slice1.SliceType = <span class="stringliteral">&#39;Plane&#39;</span></div><div class="line">slice1.SliceType.Normal = [0, 0, 1]</div><div class="line"></div><div class="line">sliceDisplay = Show(slice1)</div><div class="line"></div><div class="line"><span class="keyword">def </span>catalyst_execute(info):</div><div class="line">    fname = <span class="stringliteral">&quot;/tmp/output-%d.png&quot;</span> % info.timestep</div><div class="line"></div><div class="line">    <span class="comment"># ensure camera is setup correctly</span></div><div class="line">    ResetCamera()</div><div class="line"></div><div class="line">    <span class="comment"># save screenshot</span></div><div class="line">    print_info(<span class="stringliteral">&quot;time=%f, saving file: %s&quot;</span>, info.time, fname)</div><div class="line">    SaveScreenshot(fname)</div></div><!-- fragment --><p>Here's the result of executing this script with <code>wavelet_miniapp</code>:</p>
<div class="fragment"><div class="line">&gt; pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">          -s .../sample3.py</div><div class="line">          --script-version 2</div><div class="line">          --timesteps 3</div><div class="line">          -c Wavelet1</div><div class="line"></div><div class="line">(   0.558s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.840s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/3</div><div class="line">(   2.725s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample3&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   2.923s) [pvbatch         ]             sample3.py:23    INFO| time=0.000000, saving file: /tmp/output-0.png</div><div class="line">(   2.997s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/3</div><div class="line">(   3.278s) [pvbatch         ]             sample3.py:23    INFO| time=0.333333, saving file: /tmp/output-1.png</div><div class="line">(   3.327s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 3/3</div><div class="line">(   3.610s) [pvbatch         ]             sample3.py:23    INFO| time=0.666667, saving file: /tmp/output-2.png</div></div><!-- fragment --><h3>Using Extractors</h3>
<p>In ParaView 5.9, we introduced a new pipeline object called <b>Extractors</b>. <b>Extractors</b> are items in the visualization pipeline that can save data or images per timestep. Extractors make it largely unnecessary to have any custom code to execute per iteration since one can simply use extracts to save out image extracts from views or data extracts from filters and other data producers.</p>
<p>For example, <code>sample3.py</code> can be modified to use extractors as follows:</p>
<div class="fragment"><div class="line"><span class="comment"># filename: sample4.py</span></div><div class="line"><span class="keyword">from</span> paraview.simple <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> paraview <span class="keyword">import</span> print_info</div><div class="line"></div><div class="line">view = CreateRenderView()</div><div class="line"></div><div class="line">wavelet1 = Wavelet(registrationName=<span class="stringliteral">&quot;Wavelet1&quot;</span>)</div><div class="line"></div><div class="line"><span class="comment"># create a new &#39;Slice&#39;</span></div><div class="line">slice1 = Slice(registrationName=<span class="stringliteral">&#39;Slice1&#39;</span>, Input=wavelet1)</div><div class="line">slice1.SliceType = <span class="stringliteral">&#39;Plane&#39;</span></div><div class="line">slice1.SliceType.Normal = [0, 0, 1]</div><div class="line"></div><div class="line">sliceDisplay = Show(slice1)</div><div class="line"></div><div class="line"><span class="comment"># create extractor</span></div><div class="line">extractor1 = CreateExtractor(<span class="stringliteral">&#39;PNG&#39;</span>, view, registrationName=<span class="stringliteral">&#39;PNG1&#39;</span>)</div><div class="line"><span class="comment"># trace defaults for the extractor.</span></div><div class="line"><span class="comment"># init the &#39;PNG&#39; selected for &#39;Writer&#39;</span></div><div class="line">extractor1.Writer.FileName = <span class="stringliteral">&#39;/tmp/output-%ts.png&#39;</span></div><div class="line">extractor1.Writer.ImageResolution = [800, 880]</div></div><!-- fragment --><p>This will produce an output like follows: </p><div class="fragment"><div class="line">&gt; pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">          -s .../sample3.py</div><div class="line">          --script-version 2</div><div class="line">          --timesteps 3</div><div class="line">          -c Wavelet1</div><div class="line"></div><div class="line">(   0.554s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.835s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/3</div><div class="line">(   2.823s) [pvbatch         ]        v2_internals.py:150   WARN| Module &#39;sample4&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   3.208s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/3</div><div class="line">(   3.652s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 3/3</div></div><!-- fragment --><p>If you look at the generated results, <code>/tmp/output-0.png</code>, <code>/tmp/output-1.png</code>, etc. will be generated as with <code>sample3.py</code>. However, this time, we didn't need to add an explicit code to execute per iteration by providing <code>catalyst_execute</code>. The extractor achieve the same effect.</p>
<p>Such Catalyst scripts that use extractors can be easily exported from the ParaView GUI using <b>File &gt; Save Catalyst State</b>. Such an exported script will often how the following trailer:</p>
<div class="fragment"><div class="line"><span class="comment"># exported Catalyst script</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment"># ------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"># Catalyst options</span></div><div class="line"><span class="keyword">from</span> paraview <span class="keyword">import</span> catalyst</div><div class="line">options = catalyst.Options()</div><div class="line">options.GenerateCinemaSpecification = 1</div><div class="line">options.ExtractsOutputDirectory = <span class="stringliteral">&quot;/tmp&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># ------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div><div class="line">    <span class="keyword">from</span> paraview.simple <span class="keyword">import</span> SaveExtractsUsingCatalystOptions</div><div class="line">    <span class="comment"># Code for non in-situ environments; if executing in post-processing</span></div><div class="line">    <span class="comment"># i.e. non-Catalyst mode, lets generate extracts using Catalyst options</span></div><div class="line">    SaveExtractsUsingCatalystOptions(options)</div></div><!-- fragment --><p>The <code>options</code> variable is setup with values chosen in the <b>Save Catalyst State</b> dialog. This is the <em>options</em> variable that we have been seeing warnings for in our runs so far. If present, <code>options</code> must be of the type <code>paraview.catalyst.Options</code>. This is used to specify parameters that control how the code is executed e.g. location of output directory, Catalyst Live connection information etc. If not present, a default one is created.</p>
<p>The following lists several of the important properties on <code>options</code> and their default values.</p>
<div class="fragment"><div class="line"><span class="comment"># catalyst options</span></div><div class="line"><span class="keyword">from</span> paraview.catalyst <span class="keyword">import</span> Options</div><div class="line">options = Options()</div><div class="line"></div><div class="line"><span class="comment"># directory under which to save all extracts</span></div><div class="line"><span class="comment"># generated using Extractors defined in the pipeline, if any.</span></div><div class="line"><span class="comment"># (optional, but recommended)</span></div><div class="line">options.ExtractsOutputDirectory = <span class="stringliteral">&quot;....&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># enable/disable Cinema database generation for</span></div><div class="line"><span class="comment"># generated extracts (optional)</span></div><div class="line">options.GenerateCinemaSpecification = ...           <span class="comment"># default=False</span></div><div class="line"></div><div class="line"><span class="comment"># global trigger params (optional)</span></div><div class="line">options.GlobalTrigger.UseStartTimeStep = ...        <span class="comment"># default=False</span></div><div class="line">options.GlobalTrigger.StartTimeStep = ...           <span class="comment"># default=0</span></div><div class="line">options.GlobalTrigger.UseEndTimeStep = ..           <span class="comment"># default=False</span></div><div class="line">options.GlobalTrigger.EndTimeStep = ...             <span class="comment"># default=0</span></div><div class="line">options.GlobalTrigger.Frequency = ...               <span class="comment"># default=1</span></div><div class="line"></div><div class="line"><span class="comment"># live params (optional)</span></div><div class="line">options.EnableCatalystLive = ...                    <span class="comment"># default=False</span></div><div class="line">options.CatalystLiveURL = ...                       <span class="comment"># default=&quot;localhost:2222&quot;</span></div><div class="line">options.CatalystLiveTrigger.UseStartTimeStep = ...  <span class="comment"># default=False</span></div><div class="line">options.CatalystLiveTrigger.StartTimeStep = ...     <span class="comment"># default=0</span></div><div class="line">options.CatalystLiveTrigger.UseEndTimeStep = ...    <span class="comment"># default=False</span></div><div class="line">options.CatalystLiveTrigger.EndTimeStep = ...       <span class="comment"># default=0</span></div><div class="line">options.CatalystLiveTrigger.Frequency = ...         <span class="comment"># default=1</span></div></div><!-- fragment --><p><code>options.ExtractsOutputDirectory</code> is handy to place all generated extracts under a specific directory. To use it, ensure that all extractor use a relative filename. The filename is then evaluated to be relative to the directory provided for <code>options.ExtractsOutputDirectory</code></p>
<h3>Using Python Package</h3>
<p>In previous section, we used a single .py file to demonstrate various aspects of Catalyst Python module. The same is applicable to a Python package. Take a simple package with directory structure as follows:</p>
<div class="fragment"><div class="line">..../sample/</div><div class="line">           / __init__.py</div></div><!-- fragment --><p>The contents of <code>__init__.py</code> as <code>sample2.py</code> described earlier. Now, you can use this package together with the <code>wavelet_miniapp</code> as follows:</p>
<div class="fragment"><div class="line">&gt; ./bin/pvbatch -m paraview.demos.wavelet_miniapp</div><div class="line">                --script .../sample</div><div class="line">                --script-version 2</div><div class="line">                --timesteps 3</div><div class="line">                --channel Wavelet1</div><div class="line"></div><div class="line">(   0.570s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.856s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/3</div><div class="line">(   1.923s) [pvbatch         ]            __init__.py:6     INFO| begin &#39;sample&#39;</div><div class="line">(   1.929s) [pvbatch         ]            __init__.py:20    INFO| end &#39;sample&#39;</div><div class="line">(   1.929s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   1.932s) [pvbatch         ]            __init__.py:11    INFO| in &#39;sample::catalyst_initialize&#39;</div><div class="line">(   1.932s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   1.933s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/3</div><div class="line">(   1.982s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   1.982s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 3/3</div><div class="line">(   2.030s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   2.030s) [pvbatch         ]            __init__.py:17    INFO| in &#39;sample::catalyst_finalize&#39;</div></div><!-- fragment --><p>As you can see, it produces a very similar result to using <code>sample2.py</code>. This is of course a very simple script. For complex scripts, a package allows better code organization and reusability and hence can be very handy in those situations.</p>
<p>The <code>__init__.py</code> file is the entry point. You can import other modules, packages, or sub-packages in it as needed.</p>
<h3>Using ZIP archives</h3>
<p>Python supports importing modules and packages from within a ZIP archive without having to unzip the contents. This can be a very handy feature for Catalyst Python scripts. You can simply archive a package directory using the same name as the directory (adding extension <code>.zip</code>) and then use that instead of the .py file.</p>
<p>For example, we can zip the <code>sample</code> directory as sample.zip use it as follows to produce almost identical result:</p>
<div class="fragment"><div class="line">&gt; pvbatch -m paraview.demos.wavelet_miniapp -s /tmp/sample.zip --script-version 2 --timesteps 3  -c Wavelet1</div><div class="line"></div><div class="line">(   0.551s) [pvbatch         ]              bridge.py:17    WARN| Warning: ParaView has been initialized before `initialize` is called</div><div class="line">(   1.992s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 1/3</div><div class="line">(   2.061s) [pvbatch         ]            __init__.py:6     INFO| begin &#39;sample&#39;</div><div class="line">(   2.066s) [pvbatch         ]            __init__.py:20    INFO| end &#39;sample&#39;</div><div class="line">(   2.066s) [pvbatch         ]        v2_internals.py:145   WARN| Module &#39;sample&#39; missing Catalyst &#39;options&#39;, will use a default options object</div><div class="line">(   2.070s) [pvbatch         ]            __init__.py:11    INFO| in &#39;sample::catalyst_initialize&#39;</div><div class="line">(   2.070s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   2.070s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 2/3</div><div class="line">(   2.121s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   2.121s) [pvbatch         ]     wavelet_miniapp.py:97    INFO| timestep: 3/3</div><div class="line">(   2.172s) [pvbatch         ]            __init__.py:14    INFO| in &#39;sample::catalyst_execute&#39;</div><div class="line">(   2.172s) [pvbatch         ]            __init__.py:17    INFO| in &#39;sample::catalyst_finalize&#39;</div></div><!-- fragment --><p>Note, currently it is required that the name of the zip archive and the name of the package directory must match.</p>
<h1>Testing and Debugging</h1>
<p>The <code>pvpython</code>/<code>pvbatch</code> executables can be launched with a <code>-l</code> argument to generate detailed logs as follows:</p>
<div class="fragment"><div class="line">&gt; pvbatch -l=/tmp/log.txt,TRACE -m paraview.demos.wavelet_miniapp ...</div></div><!-- fragment --><p>Here, a <code>/tmp/log.txt</code> will all logging output will be generated. You can also elevate Catalyst-generated log to a higher level and log that, for example, the following will elevate catalyst log level to INFO and log all INFO messages to <code>/tmp/infolog.txt</code></p>
<div class="fragment"><div class="line">&gt; env PARAVIEW_LOG_CATALYST_VERBOSITY=INFO \</div><div class="line">      pvbatch -l=/tmp/infolog.txt,INFO -m paraview.demos.wavelet_miniapp ...</div></div><!-- fragment --><h2>Mini-App: paraview.demos.wavelet_miniapp</h2>
<p>The <code>wavelet_miniapp</code> that we used in several of the examples here is a simple stand-in for a simulation code. It uses the Wavelet (<code><a class="elRef" doxygen="/builds/gitlab-kitware-sciviz-ci/build/Utilities/Doxygen/vtkNightlyDoc.tag:http://www.vtk.org/doc/nightly/html/" href="http://www.vtk.org/doc/nightly/html/classvtkRTAnalyticSource.html">vtkRTAnalyticSource</a></code>) internally to produce time-varying uniform rectilinear grid (<code><a class="elRef" doxygen="/builds/gitlab-kitware-sciviz-ci/build/Utilities/Doxygen/vtkNightlyDoc.tag:http://www.vtk.org/doc/nightly/html/" href="http://www.vtk.org/doc/nightly/html/classvtkImageData.html">vtkImageData</a></code>). Command line options can be used to customize the run, including number of timesteps, etc.</p>
<div class="fragment"><div class="line">&gt; ./bin/pvbatch -m paraview.demos.wavelet_miniapp --help</div><div class="line"></div><div class="line">usage: wavelet_miniapp.py [-h] [-t TIMESTEPS] [--size SIZE] -s SCRIPT [--script-version SCRIPT_VERSION] [-d DELAY] [-c CHANNEL]</div><div class="line"></div><div class="line">Wavelet MiniApp for Catalyst testing</div><div class="line"></div><div class="line">optional arguments:</div><div class="line">  -h, --help            show this help message and exit</div><div class="line">  -t TIMESTEPS, --timesteps TIMESTEPS</div><div class="line">                        number of timesteps to run the miniapp for (default: 100)</div><div class="line">  --size SIZE           number of samples in each coordinate direction (default: 101)</div><div class="line">  -s SCRIPT, --script SCRIPT</div><div class="line">                        path(s) to the Catalyst script(s) to use for in situ processing.</div><div class="line">                        Can be a .py file or a Python package zip or directory</div><div class="line">  --script-version SCRIPT_VERSION</div><div class="line">                        choose Catalyst analysis script version explicitly, otherwise it</div><div class="line">                        will be determined automatically. When specifying multiple scripts,</div><div class="line">                        this setting applies to all scripts.</div><div class="line">  -d DELAY, --delay DELAY</div><div class="line">                        delay (in seconds) between timesteps (default: 0.0)</div><div class="line">  -c CHANNEL, --channel CHANNEL</div><div class="line">                        Catalyst channel name (default: input)</div></div><!-- fragment --><p>To run in parallel using mpi, make sure that you use pvbatch in symmetric mode as follows:</p>
<div class="fragment"><div class="line">&gt; mpirun -np [num ranks] .../pvbatch -sym -m paraview.demos.wavelet_miniapp ....</div></div><!-- fragment --><h2>Mini-App: paraview.demos.filedriver_minapp</h2>
<p>The <code>wavelet_miniapp</code> is a good miniapp to use as stand-in for a simulation code to debug issues with the Catalyst scripts. Another useful miniapp is the <code>filedriver_miniapp</code>. Unlike the <code>wavelet_miniapp</code> which can only produce a specific type of dataset, <code>filedriver_miniapp</code> uses files on disk and serves them as if they are being generated by a simulation.</p>
<div class="fragment"><div class="line">&gt; ./bin/pvbatch -m paraview.demos.filedriver_miniapp --help</div><div class="line"></div><div class="line">usage: filedriver_miniapp.py [-h] -s SCRIPT [--script-version SCRIPT_VERSION] [-d DELAY] [-c CHANNEL] -g GLOB</div><div class="line"></div><div class="line">File-based MiniApp for Catalyst testing</div><div class="line"></div><div class="line">optional arguments:</div><div class="line">  -h, --help            show this help message and exit</div><div class="line">  -s SCRIPT, --script SCRIPT</div><div class="line">                        path(s) to the Catalyst script(s) to use for in situ processing.</div><div class="line">                        Can be a .py file or a Python package zip or directory</div><div class="line">  --script-version SCRIPT_VERSION</div><div class="line">                        choose Catalyst analysis script version explicitly, otherwise it</div><div class="line">                        will be determined automatically. When specifying multiple scripts, this setting</div><div class="line">                        applies to all scripts.</div><div class="line">  -d DELAY, --delay DELAY</div><div class="line">                        delay (in seconds) between timesteps (default: 0.0)</div><div class="line">  -c CHANNEL, --channel CHANNEL</div><div class="line">                        Catalyst channel name (default: input)</div><div class="line">  -g GLOB, --glob GLOB  Pattern to use to locate input filenames.</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13 on Wed Jan 27 2021
</small></address>
<!-- KW:BEGIN -->
<!-- this adds the version selection header -->
<script type="text/javascript" src="/paraview-docs/paraview-version.js"></script>
<!-- KW:END -->
</body>
</html>
