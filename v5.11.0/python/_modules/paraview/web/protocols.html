<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>paraview.web.protocols &mdash; ParaView/Python 5.11.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          <ul>
            <li> <a href="../../../index.html">
              <img src="../../../_static/paraview-logo-small.png"
              alt="ParaView/Python"></img></a> </li>
            <li class="version"> version 5.11.0</li>
          </ul>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quick-start.html">Quick-Start :  A Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.html">The ParaView Python Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.simple.html">simple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.servermanager.html">servermanager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.coprocessing.html">coprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.benchmark.html">benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paraview.servermanager_proxies.html">Available readers, sources, writers, filters and animation cues</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api-changes.html">API Changes between ParaView versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ParaView/Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <a href="../../../genindex.html" class="float-right">Index</a> 
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>paraview.web.protocols</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for paraview.web.protocols</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;paraviewweb_protocols is a module that contains a set of ParaViewWeb related</span>
<span class="sd">protocols that can be combined together to provide a flexible way to define</span>
<span class="sd">very specific web application.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># import paraview modules.</span>
<span class="kn">import</span> <span class="nn">paraview</span>
<span class="kn">from</span> <span class="nn">paraview</span> <span class="kn">import</span> <span class="n">servermanager</span><span class="p">,</span> <span class="n">simple</span>
<span class="kn">from</span> <span class="nn">paraview.servermanager</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">InputProperty</span><span class="p">,</span>
    <span class="n">ProxyProperty</span><span class="p">,</span>
    <span class="n">vtkPVRenderView</span><span class="p">,</span>
    <span class="n">vtkSMPVRepresentationProxy</span><span class="p">,</span>
    <span class="n">vtkSMTransferFunctionManager</span><span class="p">,</span>
    <span class="n">vtkSMTransferFunctionProxy</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">paraview.web</span> <span class="kn">import</span> <span class="n">helper</span>
<span class="kn">from</span> <span class="nn">paraview.web.decorators</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">arrayListDomainDecorator</span><span class="p">,</span>
    <span class="n">arraySelectionDomainDecorator</span><span class="p">,</span>
    <span class="n">booleanDomainDecorator</span><span class="p">,</span>
    <span class="n">clipScalarDecorator</span><span class="p">,</span>
    <span class="n">enumerationDomainDecorator</span><span class="p">,</span>
    <span class="n">genericDecorator</span><span class="p">,</span>
    <span class="n">multiLineDecorator</span><span class="p">,</span>
    <span class="n">numberRangeDomainDecorator</span><span class="p">,</span>
    <span class="n">proxyEditorPropertyWidgetDecorator</span><span class="p">,</span>
    <span class="n">proxyListDomainDecorator</span><span class="p">,</span>
    <span class="n">stringListDomainDecorator</span><span class="p">,</span>
    <span class="n">treeDomainDecorator</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">vtkmodules.vtkCommonCore</span> <span class="kn">import</span> <span class="n">vtkCollection</span><span class="p">,</span> <span class="n">vtkUnsignedCharArray</span>
<span class="kn">from</span> <span class="nn">vtkmodules.vtkCommonDataModel</span> <span class="kn">import</span> <span class="n">vtkDataObject</span><span class="p">,</span> <span class="n">vtkImageData</span>
<span class="kn">from</span> <span class="nn">vtkmodules.vtkWebCore</span> <span class="kn">import</span> <span class="n">vtkDataEncoder</span><span class="p">,</span> <span class="n">vtkWebInteractionEvent</span>
<span class="kn">from</span> <span class="nn">vtkmodules.web</span> <span class="kn">import</span> <span class="n">iteritems</span>
<span class="kn">from</span> <span class="nn">vtkmodules.web</span> <span class="kn">import</span> <span class="n">protocols</span> <span class="k">as</span> <span class="n">vtk_protocols</span>
<span class="kn">from</span> <span class="nn">vtkmodules.web.render_window_serializer</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SynchronizationContext</span><span class="p">,</span>
    <span class="n">getReferenceId</span><span class="p">,</span>
    <span class="n">initializeSerializers</span><span class="p">,</span>
    <span class="n">serializeInstance</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">wslink</span> <span class="kn">import</span> <span class="n">schedule_callback</span>

<span class="c1"># import RPC annotation</span>
<span class="kn">from</span> <span class="nn">wslink</span> <span class="kn">import</span> <span class="n">register</span> <span class="k">as</span> <span class="n">exportRpc</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="n">xrange</span> <span class="o">=</span> <span class="nb">range</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># Helper methods</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="tryint"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.tryint">[docs]</a><span class="k">def</span> <span class="nf">tryint</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="alphanum_key"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.alphanum_key">[docs]</a><span class="k">def</span> <span class="nf">alphanum_key</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turn a string into a list of string and number chunks.</span>
<span class="sd">    &quot;z23a&quot; -&gt; [&quot;z&quot;, 23, &quot;a&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">tryint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;([0-9]+)&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span></div>


<div class="viewcode-block" id="sanitizeKeys"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.sanitizeKeys">[docs]</a><span class="k">def</span> <span class="nf">sanitizeKeys</span><span class="p">(</span><span class="n">mapObj</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mapObj</span><span class="p">:</span>
        <span class="n">sanitizeKey</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_make_name_valid</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">output</span><span class="p">[</span><span class="n">sanitizeKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapObj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">output</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Base class for any ParaView based protocol</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebProtocol"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebProtocol</span><span class="p">(</span><span class="n">vtk_protocols</span><span class="o">.</span><span class="n">vtkWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.Application = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coreServer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ParaViewWebProtocol.mapIdToProxy"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.mapIdToProxy">[docs]</a>    <span class="k">def</span> <span class="nf">mapIdToProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps global-id for a proxy to the proxy instance. May return None if the</span>
<span class="sd">        id is not valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">_getPyProxy</span><span class="p">(</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">ActiveConnection</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">GetRemoteObject</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.getView"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.getView">[docs]</a>    <span class="k">def</span> <span class="nf">getView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the view for a given view ID, if vid is None then return the</span>
<span class="sd">        current active view.</span>
<span class="sd">        :param vid: The view ID</span>
<span class="sd">        :type vid: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="p">:</span>
            <span class="c1"># Use active view is none provided.</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetActiveView</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no view provided: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vid</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">view</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.debug"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugMode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.setBaseDirectory"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.setBaseDirectory">[docs]</a>    <span class="k">def</span> <span class="nf">setBaseDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basePath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overrideDataDirKey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">basePath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">basePath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">basePair</span> <span class="o">=</span> <span class="n">basePath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basePair</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="n">basePair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">overrideDataDirKey</span> <span class="o">=</span> <span class="n">basePair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="n">basePath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baseDirs</span> <span class="o">=</span> <span class="n">basePath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">baseDir</span> <span class="ow">in</span> <span class="n">baseDirs</span><span class="p">:</span>
                <span class="n">basePair</span> <span class="o">=</span> <span class="n">baseDir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basePair</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">[</span><span class="n">basePair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">basePair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Check if we ended up with just a single directory</span>
            <span class="n">bdKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdKeys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">[</span><span class="n">bdKeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">overrideDataDirKey</span> <span class="o">=</span> <span class="n">bdKeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdKeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.getAbsolutePath"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.getAbsolutePath">[docs]</a>    <span class="k">def</span> <span class="nf">getAbsolutePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativePath</span><span class="p">):</span>
        <span class="n">absolutePath</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">relPathParts</span> <span class="o">=</span> <span class="n">relativePath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">realBasePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">[</span><span class="n">relPathParts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">absolutePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">realBasePath</span><span class="p">,</span> <span class="o">*</span><span class="n">relPathParts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">absolutePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span><span class="p">,</span> <span class="n">relativePath</span><span class="p">)</span>

        <span class="n">cleanedPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">absolutePath</span><span class="p">)</span>

        <span class="c1"># Make sure the cleanedPath is part of the allowed ones</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cleanedPath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">cleanedPath</span>
        <span class="k">elif</span> <span class="n">cleanedPath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cleanedPath</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.updateScalarBars"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.updateScalarBars">[docs]</a>    <span class="k">def</span> <span class="nf">updateScalarBars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manage scalarbar state</span>

<span class="sd">            view:</span>
<span class="sd">                A view proxy or the current active view will be used.</span>

<span class="sd">            mode:</span>
<span class="sd">                HIDE_UNUSED_SCALAR_BARS = 0x01,</span>
<span class="sd">                SHOW_USED_SCALAR_BARS = 0x02</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">view</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lutMgr</span> <span class="o">=</span> <span class="n">vtkSMTransferFunctionManager</span><span class="p">()</span>
        <span class="n">lutMgr</span><span class="o">.</span><span class="n">UpdateScalarBars</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebProtocol.publish"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProtocol.publish">[docs]</a>    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreServer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coreServer</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle Mouse interaction on any type of view</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebMouseHandler"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebMouseHandler">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebMouseHandler</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebMouseHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>

    <span class="c1"># RpcName: mouseInteraction =&gt; viewport.mouse.interaction</span>
<div class="viewcode-block" id="ParaViewWebMouseHandler.mouseInteraction"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebMouseHandler.mouseInteraction">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.mouse.interaction&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mouseInteraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC Callback for mouse interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>
        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s2">&quot;UseInteractiveRenderingForScreenshots&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">UseInteractiveRenderingForScreenshots</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">UseInteractiveRenderingForScreenshots</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonLeft&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">LEFT_BUTTON</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonMiddle&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">MIDDLE_BUTTON</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonRight&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">RIGHT_BUTTON</span>

        <span class="n">modifiers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;shiftKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">SHIFT_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;ctrlKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">CTRL_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;altKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">ALT_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;metaKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">META_KEY</span>

        <span class="n">pvevent</span> <span class="o">=</span> <span class="n">vtkWebInteractionEvent</span><span class="p">()</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetModifiers</span><span class="p">(</span><span class="n">modifiers</span><span class="p">)</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetX</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetY</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="c1"># pvevent.SetKeyCode(event[&quot;charCode&quot;])</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">HandleInteractionEvent</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">pvevent</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">pvevent</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">!=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">!=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retVal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">retVal</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Basic 3D Viewport API (Camera + Orientation + CenterOfRotation</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebViewPort"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebViewPort</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">maxWidth</span><span class="o">=</span><span class="mi">2560</span><span class="p">,</span> <span class="n">maxHeight</span><span class="o">=</span><span class="mi">1440</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebViewPort</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="n">maxWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxHeight</span> <span class="o">=</span> <span class="n">maxHeight</span>

    <span class="c1"># RpcName: resetCamera =&gt; viewport.camera.reset</span>
<div class="viewcode-block" id="ParaViewWebViewPort.resetCamera"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.resetCamera">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.camera.reset&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">resetCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC callback to reset camera.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">ResetCamera</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">view</span><span class="o">.</span><span class="n">CenterOfRotation</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">CameraFocalPoint</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span></div>

    <span class="c1"># RpcName: updateOrientationAxesVisibility =&gt; viewport.axes.orientation.visibility.update</span>
<div class="viewcode-block" id="ParaViewWebViewPort.updateOrientationAxesVisibility"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.updateOrientationAxesVisibility">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.axes.orientation.visibility.update&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateOrientationAxesVisibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">showAxis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC callback to show/hide OrientationAxis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">OrientationAxesVisibility</span> <span class="o">=</span> <span class="n">showAxis</span> <span class="k">if</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span></div>

    <span class="c1"># RpcName: updateCenterAxesVisibility =&gt; viewport.axes.center.visibility.update</span>
<div class="viewcode-block" id="ParaViewWebViewPort.updateCenterAxesVisibility"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.updateCenterAxesVisibility">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.axes.center.visibility.update&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateCenterAxesVisibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">showAxis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC callback to show/hide CenterAxesVisibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">CenterAxesVisibility</span> <span class="o">=</span> <span class="n">showAxis</span> <span class="k">if</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span></div>

    <span class="c1"># RpcName: updateCamera =&gt; viewport.camera.update</span>
<div class="viewcode-block" id="ParaViewWebViewPort.updateCamera"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.updateCamera">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.camera.update&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="p">,</span> <span class="n">focal_point</span><span class="p">,</span> <span class="n">view_up</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">forceUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>

        <span class="n">view</span><span class="o">.</span><span class="n">CameraFocalPoint</span> <span class="o">=</span> <span class="n">focal_point</span>
        <span class="n">view</span><span class="o">.</span><span class="n">CameraViewUp</span> <span class="o">=</span> <span class="n">view_up</span>
        <span class="n">view</span><span class="o">.</span><span class="n">CameraPosition</span> <span class="o">=</span> <span class="n">position</span>

        <span class="k">if</span> <span class="n">forceUpdate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebViewPort.getCamera"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.getCamera">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.camera.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">view</span> <span class="ow">and</span> <span class="n">view</span><span class="o">.</span><span class="n">GetClientSideView</span><span class="p">()</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vtkPVRenderView&quot;</span><span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetClientSideView</span><span class="p">()</span><span class="o">.</span><span class="n">GetRenderer</span><span class="p">()</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">ComputeVisiblePropBounds</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">,</span>
            <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">CenterOfRotation</span><span class="p">),</span>
            <span class="s2">&quot;focal&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">CameraFocalPoint</span><span class="p">),</span>
            <span class="s2">&quot;up&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">CameraViewUp</span><span class="p">),</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">CameraPosition</span><span class="p">),</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebViewPort.updateSize"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPort.updateSize">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.size.update&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxWidth</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">*=</span> <span class="n">s</span>
            <span class="n">h</span> <span class="o">*=</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxHeight</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxHeight</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">*=</span> <span class="n">s</span>
            <span class="n">h</span> <span class="o">*=</span> <span class="n">s</span>
        <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Provide Image delivery mechanism</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebViewPortImageDelivery"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortImageDelivery">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebViewPortImageDelivery</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="c1"># RpcName: stillRender =&gt; viewport.image.render</span>
<div class="viewcode-block" id="ParaViewWebViewPortImageDelivery.stillRender"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortImageDelivery.stillRender">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.render&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stillRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC Callback to render a view and obtain the rendered image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beginTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resize</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;mtime&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;quality&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">quality</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span>
        <span class="n">localTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;localTime&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">localTime</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;localTime&quot;</span><span class="p">]</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">StillRenderToString</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

        <span class="c1"># Check that we are getting image size we have set if not wait until we</span>
        <span class="c1"># do.</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">while</span> <span class="p">(</span>
            <span class="n">resize</span>
            <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">GetLastStillRenderImageSize</span><span class="p">())</span> <span class="o">!=</span> <span class="n">size</span>
            <span class="ow">and</span> <span class="n">size</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">app</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">StillRenderToString</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
            <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">resize</span>
            <span class="ow">and</span> <span class="n">options</span>
            <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;clearCache&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;clearCache&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">app</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">StillRenderToString</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;stale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">GetHasImagesBeingProcessed</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">GetLastStillRenderToMTime</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg;base64&quot;</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;global_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;localTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">localTime</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;workTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">beginTime</span>

        <span class="k">return</span> <span class="n">reply</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Provide Image publish-based delivery mechanism</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>

<span class="n">CAMERA_PROP_NAMES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;CameraFocalPoint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CameraParallelProjection&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CameraParallelScale&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CameraPosition&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CameraViewAngle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CameraViewUp&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">_pushCameraLink</span><span class="p">(</span><span class="n">viewSrc</span><span class="p">,</span> <span class="n">viewDstList</span><span class="p">):</span>
    <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CAMERA_PROP_NAMES</span><span class="p">:</span>
        <span class="n">props</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">viewSrc</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">viewDstList</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CAMERA_PROP_NAMES</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">props</span>


<div class="viewcode-block" id="ParaViewWebPublishImageDelivery"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebPublishImageDelivery</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ParaViewWebProtocol</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastStaleTime</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># 0.1s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staleCountLimit</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">decode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">=</span> <span class="mf">30.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minFrameRate</span> <span class="o">=</span> <span class="mf">12.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxFrameRate</span> <span class="o">=</span> <span class="mf">30.0</span>

        <span class="c1"># Camera link handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onLinkChange</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Mouse handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># In case some external protocol wants to monitor when link views change</span>
<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.setLinkChangeCallback"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.setLinkChangeCallback">[docs]</a>    <span class="k">def</span> <span class="nf">setLinkChangeCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onLinkChange</span> <span class="o">=</span> <span class="n">fn</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.pushRender"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.pushRender">[docs]</a>    <span class="k">def</span> <span class="nf">pushRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vId</span><span class="p">,</span> <span class="n">ignoreAnimation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">staleCount</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignoreAnimation</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;originalSize&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">]:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">vId</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;originalSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;ratio&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;originalSize&quot;</span><span class="p">]]</span>

        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stillRender</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">vId</span><span class="p">,</span> <span class="s2">&quot;mtime&quot;</span><span class="p">:</span> <span class="n">mtime</span><span class="p">,</span> <span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="n">quality</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># View might have been deleted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reply</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">stale</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;stale&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]:</span>
            <span class="c1"># depending on whether the app has encoding enabled:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">:</span>
                <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">standard_b64decode</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>

            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addAttachment</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg&quot;</span>
            <span class="c1"># save mtime for next call.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">vId</span><span class="p">][</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span>
            <span class="c1"># echo back real ID, instead of -1 for &#39;active&#39;</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vId</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.subscription&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stale</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastStaleTime</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">schedule_callback</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span><span class="p">,</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderStaleImage</span><span class="p">(</span><span class="n">vId</span><span class="p">,</span> <span class="n">staleCount</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastStaleTime</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.renderStaleImage"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.renderStaleImage">[docs]</a>    <span class="k">def</span> <span class="nf">renderStaleImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vId</span><span class="p">,</span> <span class="n">staleCount</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastStaleTime</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastStaleTime</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span>
                <span class="c1"># Break on staleCount otherwise linked view will always report to be stale</span>
                <span class="c1"># And loop forever</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">delta</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span> <span class="o">*</span> <span class="p">(</span><span class="n">staleCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="n">staleCount</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleCountLimit</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">vId</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">staleCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">vId</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">schedule_callback</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
                        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderStaleImage</span><span class="p">(</span><span class="n">vId</span><span class="p">,</span> <span class="n">staleCount</span><span class="p">),</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.animate"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.animate">[docs]</a>    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderAllViews</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">nextAnimateTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span>

        <span class="c1"># Handle the rendering of the views</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">renderAllViews</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vId</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">vId</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">vId</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">nextAnimateTime</span> <span class="o">-=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxFrameRate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxFrameRate</span>

        <span class="k">if</span> <span class="n">nextAnimateTime</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nextAnimateTime</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minFrameRate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">-=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span><span class="p">:</span>
                <span class="c1"># If active view, prioritize that one over the others</span>
                <span class="c1"># -&gt; Divide by 2 the refresh rate of the other views</span>
                <span class="n">schedule_callback</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">(</span><span class="ow">not</span> <span class="n">renderAllViews</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Keep animating at the best rate we can</span>
                <span class="n">schedule_callback</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have time so let&#39;s render all</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxFrameRate</span> <span class="ow">and</span> <span class="n">nextAnimateTime</span> <span class="o">&gt;</span> <span class="mf">0.005</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">schedule_callback</span><span class="p">(</span><span class="n">nextAnimateTime</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">())</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.setMaxFrameRate"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.setMaxFrameRate">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.animation.fps.max&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setMaxFrameRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxFrameRate</span> <span class="o">=</span> <span class="n">fps</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.getCurrentFrameRate"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.getCurrentFrameRate">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.animation.fps.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getCurrentFrameRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFrameRate</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.startViewAnimation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.startViewAnimation">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.animation.start&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">startViewAnimation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">()</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.stopViewAnimation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.stopViewAnimation">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.animation.stop&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stopViewAnimation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span> <span class="ow">and</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">progressRendering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">][</span><span class="s2">&quot;streaming&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progressRendering</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progressiveRender</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.progressiveRender"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.progressiveRender">[docs]</a>    <span class="k">def</span> <span class="nf">progressiveRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetSession</span><span class="p">()</span><span class="o">.</span><span class="n">GetPendingProgress</span><span class="p">():</span>
            <span class="n">schedule_callback</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deltaStaleTimeBeforeRender</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressiveRender</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">again</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">StreamingUpdate</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">realViewId</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">again</span><span class="p">:</span>
                <span class="n">schedule_callback</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressiveRender</span><span class="p">(</span><span class="n">viewId</span><span class="p">))</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.imagePush"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.imagePush">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">imagePush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>
        <span class="n">viewId</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="c1"># Make sure an image is pushed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span></div>

    <span class="c1"># Internal function since the reply[image] is not</span>
    <span class="c1"># JSON(serializable) it can not be an RPC one</span>
<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.stillRender"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.stillRender">[docs]</a>    <span class="k">def</span> <span class="nf">stillRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC Callback to render a view and obtain the rendered image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beginTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">viewId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>

        <span class="c1"># If no view id provided, skip rendering</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">viewId</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No view&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Make sure request match our selected view</span>
        <span class="k">if</span> <span class="n">viewId</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span> <span class="ow">and</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span> <span class="o">!=</span> <span class="n">viewId</span><span class="p">:</span>
            <span class="c1"># We got active view rather than our request</span>
            <span class="n">view</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># No view to render =&gt; need some cleanup</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="p">:</span>
            <span class="c1"># The view has been deleted, we can not render it...</span>
            <span class="c1"># Clean up old view state</span>
            <span class="k">if</span> <span class="n">viewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewsInAnimations</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">viewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">viewId</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">viewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">viewId</span><span class="p">]</span>

            <span class="c1"># the view does not exist anymore, skip rendering</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># We are in business to render our view...</span>

        <span class="c1"># Make sure our view size match our request</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resize</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="n">size</span>

        <span class="c1"># Rendering options</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;mtime&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;quality&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">quality</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span>
        <span class="n">localTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;localTime&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">localTime</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;localTime&quot;</span><span class="p">]</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">:</span>
            <span class="n">stillRender</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">StillRenderToString</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stillRender</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">StillRenderToBuffer</span>
        <span class="n">reply_image</span> <span class="o">=</span> <span class="n">stillRender</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

        <span class="c1"># Check that we are getting image size we have set if not wait until we</span>
        <span class="c1"># do. The render call will set the actual window size.</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">while</span> <span class="p">(</span>
            <span class="n">resize</span>
            <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">GetLastStillRenderImageSize</span><span class="p">())</span> <span class="o">!=</span> <span class="n">size</span>
            <span class="ow">and</span> <span class="n">size</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">app</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="n">reply_image</span> <span class="o">=</span> <span class="n">stillRender</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
            <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">resize</span>
            <span class="ow">and</span> <span class="n">options</span>
            <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;clearCache&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;clearCache&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">app</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="n">reply_image</span> <span class="o">=</span> <span class="n">stillRender</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

        <span class="c1"># Pack the result</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;stale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">GetHasImagesBeingProcessed</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">GetLastStillRenderToMTime</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;memsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply_image</span><span class="o">.</span><span class="n">GetDataSize</span><span class="p">()</span> <span class="k">if</span> <span class="n">reply_image</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg;base64&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span> <span class="k">else</span> <span class="s2">&quot;jpeg&quot;</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;global_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;localTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">localTime</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">:</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply_image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Convert the vtkUnsignedCharArray into a bytes object, required by Autobahn websockets</span>
            <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">reply_image</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="k">if</span> <span class="n">reply_image</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;workTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">beginTime</span>

        <span class="k">return</span> <span class="n">reply</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.addRenderObserver"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.addRenderObserver">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.observer.add&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">addRenderObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerCallback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
            <span class="n">startCallback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">startViewAnimation</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
            <span class="n">stopCallback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopViewAnimation</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">,</span> <span class="n">observerCallback</span><span class="p">)</span>
            <span class="n">tagStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">,</span> <span class="n">startCallback</span>
            <span class="p">)</span>
            <span class="n">tagStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">,</span> <span class="n">stopCallback</span>
            <span class="p">)</span>
            <span class="c1"># TODO do we need self.getApplication().AddObserver(&#39;ResetActiveView&#39;, resetActiveView())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tag</span><span class="p">,</span> <span class="n">tagStart</span><span class="p">,</span> <span class="n">tagStop</span><span class="p">],</span>
                <span class="s2">&quot;observerCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;mtime&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s2">&quot;streaming&quot;</span><span class="p">:</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetClientSideObject</span><span class="p">()</span><span class="o">.</span><span class="n">GetEnableStreaming</span><span class="p">(),</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is an observer on this view already</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">][</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pushRender</span><span class="p">(</span><span class="n">realViewId</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;viewId&quot;</span><span class="p">:</span> <span class="n">realViewId</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.removeRenderObserver"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.removeRenderObserver">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.observer.remove&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">removeRenderObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no view with ID </span><span class="si">%s</span><span class="s2"> available in removeRenderObserver&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">)</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span> <span class="k">if</span> <span class="n">sView</span> <span class="k">else</span> <span class="n">viewId</span>

        <span class="n">observerInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observerInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to find subscription for view </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">realViewId</span><span class="p">}</span>

        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">RemoveObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">staleHandlerCount</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.setViewQuality"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.setViewQuality">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.quality&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setViewQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">updateLinkedView</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">observerInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observerInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to find subscription for view </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">realViewId</span><span class="p">}</span>

        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quality</span>
        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>

        <span class="c1"># Handle linked view quality/ratio synch</span>
        <span class="k">if</span> <span class="n">updateLinkedView</span> <span class="ow">and</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setViewQuality</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Update image size right now!</span>
        <span class="k">if</span> <span class="s2">&quot;originalSize&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">][</span><span class="s2">&quot;originalSize&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;SetSize&quot;</span> <span class="ow">in</span> <span class="n">sView</span><span class="p">:</span>
                <span class="n">sView</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sView</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="n">size</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.setViewSize"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.setViewSize">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.original.size&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setViewSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;size skip&quot;</span><span class="p">}</span>

        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">observerInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observerInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to find subscription for view </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">realViewId</span><span class="p">}</span>

        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;originalSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.enableView"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.enableView">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.enabled&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">enableView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">observerInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observerInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to find subscription for view </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">realViewId</span><span class="p">}</span>

        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enabled</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.invalidateCache"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.invalidateCache">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.image.push.invalidate.cache&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">invalidateCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvalidateCache</span><span class="p">(</span><span class="n">sView</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># View linked</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.validateViewLinks"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.validateViewLinks">[docs]</a>    <span class="k">def</span> <span class="nf">validateViewLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">linkName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkNames</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">RemoveCameraLink</span><span class="p">(</span><span class="n">linkName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkNames</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">viewList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span> <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">]</span>
            <span class="n">refView</span> <span class="o">=</span> <span class="n">viewList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">viewList</span><span class="p">:</span>
                <span class="n">linkName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">refView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">(),</span>
                    <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">AddCameraLink</span><span class="p">(</span><span class="n">refView</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">linkName</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linkNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linkName</span><span class="p">)</span>

            <span class="c1"># Synch camera state</span>
            <span class="n">srcView</span> <span class="o">=</span> <span class="n">viewList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dstViews</span> <span class="o">=</span> <span class="n">viewList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">_pushCameraLink</span><span class="p">(</span><span class="n">srcView</span><span class="p">,</span> <span class="n">dstViews</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.updateViewLink"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.updateViewLink">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.view.link&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateViewLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linkState</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">viewId</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">linkState</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c1"># self.validateViewLinks()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">allViews</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span> <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">]</span>
            <span class="n">_pushCameraLink</span><span class="p">(</span><span class="n">allViews</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allViews</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onLinkChange</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onLinkChange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">linkState</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Mouse handling</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.mouseInteraction"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.mouseInteraction">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.mouse.interaction&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mouseInteraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC Callback for mouse interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;x&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">event</span> <span class="ow">or</span> <span class="s2">&quot;y&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s2">&quot;UseInteractiveRenderingForScreenshots&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">UseInteractiveRenderingForScreenshots</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">UseInteractiveRenderingForScreenshots</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonLeft&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">LEFT_BUTTON</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonMiddle&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">MIDDLE_BUTTON</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;buttonRight&quot;</span><span class="p">]:</span>
            <span class="n">buttons</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">RIGHT_BUTTON</span>

        <span class="n">modifiers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;shiftKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">SHIFT_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;ctrlKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">CTRL_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;altKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">ALT_KEY</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;metaKey&quot;</span><span class="p">]:</span>
            <span class="n">modifiers</span> <span class="o">|=</span> <span class="n">vtkWebInteractionEvent</span><span class="o">.</span><span class="n">META_KEY</span>

        <span class="n">pvevent</span> <span class="o">=</span> <span class="n">vtkWebInteractionEvent</span><span class="p">()</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetModifiers</span><span class="p">(</span><span class="n">modifiers</span><span class="p">)</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetX</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
        <span class="n">pvevent</span><span class="o">.</span><span class="n">SetY</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="c1"># pvevent.SetKeyCode(event[&quot;charCode&quot;])</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">HandleInteractionEvent</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">pvevent</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">pvevent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">!=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">!=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">)</span>

        <span class="c1"># if retVal :</span>
        <span class="c1">#  self.getApplication().InvokeEvent(&#39;UpdateEvent&#39;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">:</span>
            <span class="n">dstViews</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span> <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">]</span>
            <span class="n">_pushCameraLink</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">dstViews</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastAction</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="ParaViewWebPublishImageDelivery.updateZoomFromWheel"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebPublishImageDelivery.updateZoomFromWheel">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.mouse.zoom.wheel&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateZoomFromWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Start&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">)</span>

        <span class="n">viewProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">viewProxy</span> <span class="ow">and</span> <span class="s2">&quot;spinY&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">rootId</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
            <span class="n">zoomFactor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;spinY&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">10.0</span>

            <span class="k">if</span> <span class="n">rootId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraFocalPoint</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraPosition</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span><span class="o">.</span><span class="n">Zoom</span><span class="p">(</span><span class="n">zoomFactor</span><span class="p">)</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">UpdatePropertyInformation</span><span class="p">()</span>
                <span class="n">pos2</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraPosition</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraFocalPoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                <span class="n">dstViews</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span> <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkedViews</span><span class="p">]</span>
                <span class="n">_pushCameraLink</span><span class="p">(</span><span class="n">viewProxy</span><span class="p">,</span> <span class="n">dstViews</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraFocalPoint</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraPosition</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span><span class="o">.</span><span class="n">Zoom</span><span class="p">(</span><span class="n">zoomFactor</span><span class="p">)</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">UpdatePropertyInformation</span><span class="p">()</span>
                <span class="n">pos2</span> <span class="o">=</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraPosition</span>
                <span class="n">viewProxy</span><span class="o">.</span><span class="n">CameraFocalPoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

        <span class="k">if</span> <span class="s2">&quot;End&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Provide Progress support</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebProgressUpdate"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProgressUpdate">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebProgressUpdate</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="n">progressObserverTag</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebProgressUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listenToProgress</span><span class="p">()</span>

<div class="viewcode-block" id="ParaViewWebProgressUpdate.listenToProgress"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProgressUpdate.listenToProgress">[docs]</a>    <span class="k">def</span> <span class="nf">listenToProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">progressHandler</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">ActiveConnection</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">GetProgressHandler</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ParaViewWebProgressUpdate</span><span class="o">.</span><span class="n">progressObserverTag</span><span class="p">:</span>
            <span class="n">ParaViewWebProgressUpdate</span><span class="o">.</span><span class="n">progressObserverTag</span> <span class="o">=</span> <span class="n">progressHandler</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;ProgressEvent&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">handler</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebProgressUpdate.updateProgress"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProgressUpdate.updateProgress">[docs]</a>    <span class="k">def</span> <span class="nf">updateProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">GetLastProgressText</span><span class="p">()</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">GetLastProgress</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;paraview.progress&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">txt</span><span class="p">,</span> <span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="n">progress</span><span class="p">})</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Provide Geometry delivery mechanism (WebGL)</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebViewPortGeometryDelivery"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortGeometryDelivery">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebViewPortGeometryDelivery</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebViewPortGeometryDelivery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># RpcName: getSceneMetaData =&gt; viewport.webgl.metadata</span>
<div class="viewcode-block" id="ParaViewWebViewPortGeometryDelivery.getSceneMetaData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortGeometryDelivery.getSceneMetaData">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.webgl.metadata&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getSceneMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">GetWebGLSceneMetaData</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="c1"># RpcName: getWebGLData =&gt; viewport.webgl.data</span>
<div class="viewcode-block" id="ParaViewWebViewPortGeometryDelivery.getWebGLData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortGeometryDelivery.getWebGLData">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.webgl.data&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getWebGLData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">GetWebGLBinaryData</span><span class="p">(</span>
            <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">object_id</span><span class="p">),</span> <span class="n">part</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="c1"># RpcName: getCachedWebGLData =&gt; viewport.webgl.cached.data</span>
<div class="viewcode-block" id="ParaViewWebViewPortGeometryDelivery.getCachedWebGLData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortGeometryDelivery.getCachedWebGLData">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.webgl.cached.data&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getCachedWebGLData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sha</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Key </span><span class="si">%s</span><span class="s2"> not in data cache&quot;</span> <span class="o">%</span> <span class="n">sha</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span><span class="p">[</span><span class="n">sha</span><span class="p">]}</span></div>

    <span class="c1"># RpcName: getSceneMetaDataAllTimesteps =&gt; viewport.webgl.metadata.alltimesteps</span>
<div class="viewcode-block" id="ParaViewWebViewPortGeometryDelivery.getSceneMetaDataAllTimesteps"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebViewPortGeometryDelivery.getSceneMetaDataAllTimesteps">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.webgl.metadata.alltimesteps&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getSceneMetaDataAllTimesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">animationScene</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="n">timeKeeper</span> <span class="o">=</span> <span class="n">animationScene</span><span class="o">.</span><span class="n">TimeKeeper</span>
        <span class="n">tsVals</span> <span class="o">=</span> <span class="n">timeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
        <span class="n">currentTime</span> <span class="o">=</span> <span class="n">timeKeeper</span><span class="o">.</span><span class="n">Time</span>

        <span class="n">oldCache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">returnToClient</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToFirst</span><span class="p">()</span>

        <span class="c1"># Iterate over all the timesteps, building up a list of unique shas</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tsVals</span><span class="p">)):</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>

            <span class="n">mdString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">GetWebGLSceneMetaData</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">)</span>
            <span class="n">timestepMetaData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">mdString</span><span class="p">)</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="n">timestepMetaData</span><span class="p">[</span><span class="s2">&quot;Objects&quot;</span><span class="p">]</span>

            <span class="c1"># Iterate over the objects in the scene</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                <span class="n">sha</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">]</span>
                <span class="n">objId</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">numParts</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;parts&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">sha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sha</span> <span class="ow">in</span> <span class="n">oldCache</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span><span class="p">[</span><span class="n">sha</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldCache</span><span class="p">[</span><span class="n">sha</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transparency</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;transparency&quot;</span><span class="p">]</span>
                        <span class="n">layer</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;layer&quot;</span><span class="p">]</span>
                        <span class="n">partData</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="c1"># Ask for the binary data for each part of this object</span>
                        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">numParts</span><span class="p">):</span>
                            <span class="n">partNumber</span> <span class="o">=</span> <span class="n">part</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">GetWebGLBinaryData</span><span class="p">(</span>
                                <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">objId</span><span class="p">),</span> <span class="n">partNumber</span>
                            <span class="p">)</span>
                            <span class="n">partData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                        <span class="c1"># Now add object, with all its binary parts, to the cache</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataCache</span><span class="p">[</span><span class="n">sha</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;md5&quot;</span><span class="p">:</span> <span class="n">sha</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">objId</span><span class="p">,</span>
                            <span class="s2">&quot;numParts&quot;</span><span class="p">:</span> <span class="n">numParts</span><span class="p">,</span>
                            <span class="s2">&quot;transparency&quot;</span><span class="p">:</span> <span class="n">transparency</span><span class="p">,</span>
                            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="p">,</span>
                            <span class="s2">&quot;partsList&quot;</span><span class="p">:</span> <span class="n">partData</span><span class="p">,</span>
                        <span class="p">}</span>

                <span class="n">returnToClient</span><span class="p">[</span><span class="n">sha</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">objId</span><span class="p">,</span> <span class="s2">&quot;numParts&quot;</span><span class="p">:</span> <span class="n">numParts</span><span class="p">}</span>

            <span class="c1"># Now move time forward</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToNext</span><span class="p">()</span>

        <span class="c1"># Set the time back to where it was when all timesteps were requested</span>
        <span class="n">timeKeeper</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">currentTime</span>
        <span class="n">animationScene</span><span class="o">.</span><span class="n">AnimationTime</span> <span class="o">=</span> <span class="n">currentTime</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;metaDataList&quot;</span><span class="p">:</span> <span class="n">returnToClient</span><span class="p">}</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Provide an updated geometry delivery mechanism which better matches the</span>
<span class="c1"># client-side rendering capability we have in vtk.js</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebLocalRendering"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebLocalRendering">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebLocalRendering</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebLocalRendering</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">initializeSerializers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">SynchronizationContext</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># RpcName: getArray =&gt; viewport.geometry.array.get</span>
<div class="viewcode-block" id="ParaViewWebLocalRendering.getArray"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebLocalRendering.getArray">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.geometry.array.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataHash</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addAttachment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getCachedDataArray</span><span class="p">(</span><span class="n">dataHash</span><span class="p">,</span> <span class="n">binary</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getCachedDataArray</span><span class="p">(</span><span class="n">dataHash</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span></div>

    <span class="c1"># RpcName: addViewObserver =&gt; viewport.geometry.view.observer.add</span>
<div class="viewcode-block" id="ParaViewWebLocalRendering.addViewObserver"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebLocalRendering.addViewObserver">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.geometry.view.observer.add&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">addViewObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">pushGeometry</span><span class="p">(</span><span class="n">newSubscription</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">(</span><span class="n">sView</span><span class="p">)</span>
            <span class="n">stateToReturn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getViewState</span><span class="p">(</span><span class="n">realViewId</span><span class="p">,</span> <span class="n">newSubscription</span><span class="p">)</span>
            <span class="n">stateToReturn</span><span class="p">[</span><span class="s2">&quot;mtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">newSubscription</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">stateToReturn</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerCallback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
                <span class="s2">&quot;viewport.geometry.view.subscription&quot;</span><span class="p">,</span> <span class="n">pushGeometry</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">,</span> <span class="n">observerCallback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tag</span><span class="p">],</span> <span class="s2">&quot;observerCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is an observer on this view already</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">][</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;viewport.geometry.view.subscription&quot;</span><span class="p">,</span> <span class="n">pushGeometry</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;viewId&quot;</span><span class="p">:</span> <span class="n">realViewId</span><span class="p">}</span></div>

    <span class="c1"># RpcName: removeViewObserver =&gt; viewport.geometry.view.observer.remove</span>
<div class="viewcode-block" id="ParaViewWebLocalRendering.removeViewObserver"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebLocalRendering.removeViewObserver">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.geometry.view.observer.remove&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">removeViewObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="n">realViewId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

        <span class="n">observerInfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">realViewId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">:</span>
            <span class="n">observerInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observerInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to find subscription for view </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">realViewId</span><span class="p">}</span>

        <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;observerCount&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">observerInfo</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">RemoveObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackingViews</span><span class="p">[</span><span class="n">realViewId</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span></div>

    <span class="c1"># RpcName: getViewState =&gt; viewport.geometry.view.get.state</span>
<div class="viewcode-block" id="ParaViewWebLocalRendering.getViewState"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebLocalRendering.getViewState">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;viewport.geometry.view.get.state&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getViewState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">newSubscription</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">sView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sView</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to get view with id </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">viewId</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setIgnoreLastDependencies</span><span class="p">(</span><span class="n">newSubscription</span><span class="p">)</span>

        <span class="c1"># Get the active view and render window, use it to iterate over renderers</span>
        <span class="n">renderWindow</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
        <span class="n">renderWindowId</span> <span class="o">=</span> <span class="n">sView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">viewInstance</span> <span class="o">=</span> <span class="n">serializeInstance</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">renderWindow</span><span class="p">,</span> <span class="n">renderWindowId</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">viewInstance</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vtkRefId&quot;</span><span class="p">:</span> <span class="n">getReferenceId</span><span class="p">(</span><span class="n">renderWindow</span><span class="p">),</span>
            <span class="s2">&quot;centerOfRotation&quot;</span><span class="p">:</span> <span class="n">sView</span><span class="o">.</span><span class="n">CenterOfRotation</span><span class="o">.</span><span class="n">GetData</span><span class="p">(),</span>
            <span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="n">getReferenceId</span><span class="p">(</span><span class="n">sView</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setIgnoreLastDependencies</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">checkForArraysToRelease</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">viewInstance</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">viewInstance</span>

        <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Time management</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebTimeHandler"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebTimeHandler</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebTimeHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># setup animation scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">GetTimeTrack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">PlayMode</span> <span class="o">=</span> <span class="s2">&quot;Snap To TimeSteps&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playTime</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Time in second</span>

<div class="viewcode-block" id="ParaViewWebTimeHandler.nextPlay"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.nextPlay">[docs]</a>    <span class="k">def</span> <span class="nf">nextPlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateTime</span><span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playing</span><span class="p">:</span>
            <span class="n">schedule_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextPlay</span><span class="p">)</span></div>

    <span class="c1"># RpcName: updateTime =&gt; pv.vcr.action</span>
<div class="viewcode-block" id="ParaViewWebTimeHandler.updateTime"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.updateTime">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.vcr.action&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRenderView</span><span class="p">()</span>
        <span class="n">animationScene</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="n">currentTime</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewTime</span>

        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToNext</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">currentTime</span> <span class="o">==</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewTime</span><span class="p">:</span>
                <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToFirst</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;prev&quot;</span><span class="p">:</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToPrevious</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">currentTime</span> <span class="o">==</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewTime</span><span class="p">:</span>
                <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToLast</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToFirst</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">GoToLast</span><span class="p">()</span>

        <span class="n">timestep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">animationScene</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">animationScene</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="s2">&quot;pv.time.change&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">ViewTime</span><span class="p">),</span> <span class="s2">&quot;timeStep&quot;</span><span class="p">:</span> <span class="n">timestep</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">ViewTime</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.setTimeStep"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.setTimeStep">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.index.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeIdx</span><span class="p">):</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">[</span><span class="n">timeIdx</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.getTimeStep"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.getTimeStep">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.index.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.setTimeValue"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.setTimeValue">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.value.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setTimeValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try to update time with&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;but value not found in the list&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.getTimeValue"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.getTimeValue">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.value.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getTimeValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">anim</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">Time</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.getTimeValues"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.getTimeValues">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.values&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getTimeValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">simple</span><span class="o">.</span><span class="n">GetAnimationScene</span><span class="p">()</span><span class="o">.</span><span class="n">TimeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.play"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.play">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.play&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deltaT</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">playing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playTime</span> <span class="o">=</span> <span class="n">deltaT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nextPlay</span><span class="p">()</span></div>

<div class="viewcode-block" id="ParaViewWebTimeHandler.stop"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTimeHandler.stop">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.time.stop&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playing</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Color management</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebColorManager"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebColorManager</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathToColorMaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showBuiltin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebColorManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pathToColorMaps</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">ImportPresets</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">pathToColorMaps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presets</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">vtkSMTransferFunctionPresets</span><span class="o">.</span><span class="n">GetInstance</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorMapNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presets</span><span class="o">.</span><span class="n">GetNumberOfPresets</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">showBuiltin</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">presets</span><span class="o">.</span><span class="n">IsPresetBuiltin</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorMapNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presets</span><span class="o">.</span><span class="n">GetPresetName</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># RpcName: getScalarBarVisibilities =&gt; pv.color.manager.scalarbar.visibility.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getScalarBarVisibilities"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getScalarBarVisibilities">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.scalarbar.visibility.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getScalarBarVisibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyIdList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether or not each specified scalar bar is visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">visibilities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">proxyId</span> <span class="ow">in</span> <span class="n">proxyIdList</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
                <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">visibilities</span><span class="p">[</span><span class="n">proxyId</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">IsScalarBarVisible</span><span class="p">(</span>
                    <span class="n">rep</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">visibilities</span></div>

    <span class="c1"># RpcName: setScalarBarVisibilities =&gt; pv.color.manager.scalarbar.visibility.set</span>
<div class="viewcode-block" id="ParaViewWebColorManager.setScalarBarVisibilities"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.setScalarBarVisibilities">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.scalarbar.visibility.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setScalarBarVisibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyIdMap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the visibility of the scalar bar corresponding to each specified</span>
<span class="sd">        proxy.  The representation for each proxy is found using the</span>
<span class="sd">        filter/source proxy id and the current view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">visibilities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">proxyId</span> <span class="ow">in</span> <span class="n">proxyIdMap</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetDisplayProperties</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
                <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">SetScalarBarVisibility</span><span class="p">(</span>
                    <span class="n">rep</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">proxyIdMap</span><span class="p">[</span><span class="n">proxyId</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">visibilities</span><span class="p">[</span><span class="n">proxyId</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">IsScalarBarVisible</span><span class="p">(</span>
                    <span class="n">rep</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span>
                <span class="p">)</span>

        <span class="c1"># Render to get scalar bars in correct position when doing local rendering (webgl)</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">visibilities</span></div>

    <span class="c1"># RpcName: rescaleTransferFunction =&gt; pv.color.manager.rescale.transfer.function</span>
<div class="viewcode-block" id="ParaViewWebColorManager.rescaleTransferFunction"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.rescaleTransferFunction">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.rescale.transfer.function&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rescaleTransferFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rescale the color transfer function to fit either the data range,</span>
<span class="sd">        the data range over time, or to a custom range, for the array by</span>
<span class="sd">        which the representation is currently being colored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="n">proxyId</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;proxyId&quot;</span><span class="p">]</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="n">status</span><span class="p">[</span>
                <span class="s2">&quot;success&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">RescaleTransferFunctionToDataRangeOverTime</span><span class="p">(</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">SMProxy</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">extend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s2">&quot;extend&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">extend</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;extend&quot;</span><span class="p">]</span>
            <span class="n">status</span><span class="p">[</span>
                <span class="s2">&quot;success&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">RescaleTransferFunctionToDataRange</span><span class="p">(</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">extend</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
            <span class="n">rangemin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">])</span>
            <span class="n">rangemax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">])</span>
            <span class="n">extend</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s2">&quot;extend&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">extend</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;extend&quot;</span><span class="p">]</span>
            <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">LookupTable</span>
            <span class="k">if</span> <span class="n">lookupTable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">status</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtkSMTransferFunctionProxy</span><span class="o">.</span><span class="n">RescaleTransferFunction</span><span class="p">(</span>
                    <span class="n">lookupTable</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">rangemin</span><span class="p">,</span> <span class="n">rangemax</span><span class="p">,</span> <span class="n">extend</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="n">currentRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurrentScalarRange</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
            <span class="n">status</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentRange</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div>

    <span class="c1"># RpcName: getCurrentScalarRange =&gt; pv.color.manager.scalar.range.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getCurrentScalarRange"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getCurrentScalarRange">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.scalar.range.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getCurrentScalarRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

        <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">LookupTable</span>
        <span class="n">cMin</span> <span class="o">=</span> <span class="n">lookupTable</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cMax</span> <span class="o">=</span> <span class="n">lookupTable</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">cMin</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">cMax</span><span class="p">}</span></div>

    <span class="c1"># RpcName: colorBy =&gt; pv.color.manager.color.by</span>
<div class="viewcode-block" id="ParaViewWebColorManager.colorBy"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.colorBy">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.color.by&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">colorBy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">representation</span><span class="p">,</span>
        <span class="n">colorMode</span><span class="p">,</span>
        <span class="n">arrayLocation</span><span class="o">=</span><span class="s2">&quot;POINTS&quot;</span><span class="p">,</span>
        <span class="n">arrayName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">vectorMode</span><span class="o">=</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span>
        <span class="n">vectorComponent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">rescale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose the array to color by, and optionally specify magnitude or a</span>
<span class="sd">        vector component in the case of vector array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">locationMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;POINTS&quot;</span><span class="p">:</span> <span class="n">vtkDataObject</span><span class="o">.</span><span class="n">POINT</span><span class="p">,</span> <span class="s2">&quot;CELLS&quot;</span><span class="p">:</span> <span class="n">vtkDataObject</span><span class="o">.</span><span class="n">CELL</span><span class="p">}</span>
        <span class="n">repProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">representation</span><span class="p">)</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span>

        <span class="k">if</span> <span class="n">colorMode</span> <span class="o">==</span> <span class="s2">&quot;SOLID&quot;</span><span class="p">:</span>
            <span class="c1"># No array just diffuse color</span>
            <span class="n">repProxy</span><span class="o">.</span><span class="n">ColorArrayName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">ColorBy</span><span class="p">(</span><span class="n">repProxy</span><span class="p">,</span> <span class="p">(</span><span class="n">arrayLocation</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span><span class="p">:</span>
                <span class="n">lut</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span>
                <span class="n">lut</span><span class="o">.</span><span class="n">VectorMode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vectorMode</span><span class="p">)</span>
                <span class="n">lut</span><span class="o">.</span><span class="n">VectorComponent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vectorComponent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rescale</span><span class="p">:</span>
                <span class="n">repProxy</span><span class="o">.</span><span class="n">RescaleTransferFunctionToDataRange</span><span class="p">(</span><span class="n">rescale</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateScalarBars</span><span class="p">()</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: setOpacityFunctionPoints =&gt; pv.color.manager.opacity.points.set</span>
<div class="viewcode-block" id="ParaViewWebColorManager.setOpacityFunctionPoints"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.setOpacityFunctionPoints">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.opacity.points.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setOpacityFunctionPoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">,</span> <span class="n">pointArray</span><span class="p">,</span> <span class="n">enableOpacityMapping</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>
        <span class="n">pwfProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetOpacityTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>

        <span class="c1"># Use whatever the current scalar range is for this array</span>
        <span class="n">cMin</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cMax</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

        <span class="c1"># Scale and bias the x values, which come in between 0.0 and 1.0, to the</span>
        <span class="c1"># current scalar range</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pointArray</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">cMax</span> <span class="o">-</span> <span class="n">cMin</span><span class="p">))</span> <span class="o">+</span> <span class="n">cMin</span>

        <span class="c1"># Set the Points property to scaled and biased points array</span>
        <span class="n">pwfProxy</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">pointArray</span>

        <span class="n">lutProxy</span><span class="o">.</span><span class="n">EnableOpacityMapping</span> <span class="o">=</span> <span class="n">enableOpacityMapping</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: getOpacityFunctionPoints =&gt; pv.color.manager.opacity.points.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getOpacityFunctionPoints"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getOpacityFunctionPoints">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.opacity.points.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getOpacityFunctionPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>
        <span class="n">pwfProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetOpacityTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>

        <span class="c1"># Use whatever the current scalar range is for this array</span>
        <span class="n">cMin</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cMax</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">pointArray</span> <span class="o">=</span> <span class="n">pwfProxy</span><span class="o">.</span><span class="n">Points</span>

        <span class="c1"># Scale and bias the x values, which come in between 0.0 and 1.0, to the</span>
        <span class="c1"># current scalar range</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pointArray</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">cMin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cMax</span> <span class="o">-</span> <span class="n">cMin</span><span class="p">),</span>
                    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;x2&quot;</span><span class="p">:</span> <span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="n">pointArray</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1"># RpcName: getRgbPoints =&gt; pv.color.manager.rgb.points.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getRgbPoints"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getRgbPoints">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.rgb.points.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getRgbPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">):</span>

        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>

        <span class="c1"># First, set the current coloring mode</span>
        <span class="n">colorInfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;categorical&quot;</span> <span class="k">if</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">InterpretValuesAsCategories</span> <span class="k">else</span> <span class="s2">&quot;continuous&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Now build up the continuous coloring information</span>
        <span class="n">continuousInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">continuousInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scalars</span><span class="p">]</span>

        <span class="n">reds</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">greens</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">blues</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">continuousInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reds</span><span class="p">,</span> <span class="n">greens</span><span class="p">,</span> <span class="n">blues</span><span class="p">)]</span>

        <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;continuous&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continuousInfo</span>

        <span class="c1"># Finally, build up the categorical coloring information</span>
        <span class="n">categoricalInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">rgbs</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">IndexedColors</span>
        <span class="n">reds</span> <span class="o">=</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgbs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">greens</span> <span class="o">=</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgbs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">blues</span> <span class="o">=</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgbs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reds</span><span class="p">,</span> <span class="n">greens</span><span class="p">,</span> <span class="n">blues</span><span class="p">)]</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">Annotations</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scalars</span><span class="p">]</span>
        <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1">### If the numbers of categorical colors and scalars do not match,</span>
        <span class="c1">### then this is probably because you already had a categorical color</span>
        <span class="c1">### scheme set up when you applied a new indexed preset.</span>
        <span class="n">numColors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>
        <span class="n">numScalars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">numColors</span> <span class="o">!=</span> <span class="n">numScalars</span><span class="p">:</span>
            <span class="c1"># More colors than scalars means we applied a preset colormap with</span>
            <span class="c1"># more colors than what we had set up already, so I want to add</span>
            <span class="c1"># scalars and annotations.</span>
            <span class="k">if</span> <span class="n">numColors</span> <span class="o">&gt;</span> <span class="n">numScalars</span><span class="p">:</span>
                <span class="n">nextValue</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Another special case here is that there were no categorical</span>
                <span class="c1"># scalars/colors before the preset was applied, and we will need</span>
                <span class="c1"># to insert a single space character (&#39; &#39;) annotation at the start</span>
                <span class="c1"># of the list to make the scalarbar appear.</span>
                <span class="k">if</span> <span class="n">numScalars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nextValue</span><span class="p">)</span>
                    <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="n">nextValue</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">((</span><span class="n">numColors</span> <span class="o">-</span> <span class="n">numScalars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nextValue</span><span class="p">)</span>
                    <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">nextValue</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># More scalars than colors means we applied a preset colormap with</span>
            <span class="c1"># *fewer* colors than what had already, so I want to add fake colors</span>
            <span class="c1"># for any non-empty annotations I have after the end of the color list</span>
            <span class="k">elif</span> <span class="n">numScalars</span> <span class="o">&gt;</span> <span class="n">numColors</span><span class="p">:</span>
                <span class="n">newScalars</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">numColors</span><span class="p">]</span>
                <span class="n">newAnnotations</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">numColors</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">numColors</span><span class="p">,</span> <span class="n">numScalars</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">newScalars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">newAnnotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

                <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newScalars</span>
                <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newAnnotations</span>

            <span class="c1"># Now that we have made the number of indexed colors and associated</span>
            <span class="c1"># scalars match, the final step in this special case is to apply the</span>
            <span class="c1"># matched up props we just computed so that server and client ui are</span>
            <span class="c1"># in sync.</span>
            <span class="n">idxColorsProperty</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">annotationsProperty</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">aIdx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">])):</span>
                <span class="n">annotationsProperty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">][</span><span class="n">aIdx</span><span class="p">]))</span>
                <span class="n">annotationsProperty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">][</span><span class="n">aIdx</span><span class="p">]))</span>
                <span class="n">idxColorsProperty</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">][</span><span class="n">aIdx</span><span class="p">])</span>

            <span class="n">lutProxy</span><span class="o">.</span><span class="n">Annotations</span> <span class="o">=</span> <span class="n">annotationsProperty</span>
            <span class="n">lutProxy</span><span class="o">.</span><span class="n">IndexedColors</span> <span class="o">=</span> <span class="n">idxColorsProperty</span>

            <span class="n">simple</span><span class="o">.</span><span class="n">Render</span>

        <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">categoricalInfo</span>

        <span class="k">return</span> <span class="n">colorInfo</span></div>

    <span class="c1"># RpcName: setRgbPoints =&gt; pv.color.manager.rgb.points.set</span>
<div class="viewcode-block" id="ParaViewWebColorManager.setRgbPoints"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.setRgbPoints">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.rgb.points.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setRgbPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">,</span> <span class="n">rgbInfo</span><span class="p">):</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>

        <span class="n">colorMode</span> <span class="o">=</span> <span class="n">rgbInfo</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span>
        <span class="n">continuousInfo</span> <span class="o">=</span> <span class="n">rgbInfo</span><span class="p">[</span><span class="s2">&quot;continuous&quot;</span><span class="p">]</span>
        <span class="n">categoricalInfo</span> <span class="o">=</span> <span class="n">rgbInfo</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span>

        <span class="c1"># First make sure the continuous mode properties are set</span>
        <span class="n">continuousScalars</span> <span class="o">=</span> <span class="n">continuousInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span>
        <span class="n">continuousColors</span> <span class="o">=</span> <span class="n">continuousInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>

        <span class="n">rgbPoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">continuousScalars</span><span class="p">)):</span>
            <span class="n">scalar</span> <span class="o">=</span> <span class="n">continuousScalars</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">continuousColors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">rgbPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">scalar</span><span class="p">))</span>
            <span class="n">rgbPoints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
        <span class="n">lutProxy</span><span class="o">.</span><span class="n">RGBPoints</span> <span class="o">=</span> <span class="n">rgbPoints</span>

        <span class="c1"># Now make sure the categorical mode properties are set</span>
        <span class="n">annotations</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
        <span class="n">categoricalScalars</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span>
        <span class="n">categoricalColors</span> <span class="o">=</span> <span class="n">categoricalInfo</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>

        <span class="n">annotationsProperty</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxColorsProperty</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aIdx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">annotations</span><span class="p">)):</span>
            <span class="n">annotationsProperty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">categoricalScalars</span><span class="p">[</span><span class="n">aIdx</span><span class="p">]))</span>
            <span class="n">annotationsProperty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">annotations</span><span class="p">[</span><span class="n">aIdx</span><span class="p">]))</span>
            <span class="n">idxColorsProperty</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">categoricalColors</span><span class="p">[</span><span class="n">aIdx</span><span class="p">])</span>

        <span class="n">lutProxy</span><span class="o">.</span><span class="n">Annotations</span> <span class="o">=</span> <span class="n">annotationsProperty</span>
        <span class="n">lutProxy</span><span class="o">.</span><span class="n">IndexedColors</span> <span class="o">=</span> <span class="n">idxColorsProperty</span>

        <span class="c1"># Finally, set the coloring mode property</span>
        <span class="k">if</span> <span class="n">colorMode</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>  <span class="c1"># continuous coloring</span>
            <span class="n">lutProxy</span><span class="o">.</span><span class="n">InterpretValuesAsCategories</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># categorical coloring</span>
            <span class="n">lutProxy</span><span class="o">.</span><span class="n">InterpretValuesAsCategories</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: getLutImage =&gt; pv.color.manager.lut.image.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getLutImage"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getLutImage">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.lut.image.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getLutImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representation</span><span class="p">,</span> <span class="n">numSamples</span><span class="p">,</span> <span class="n">customRange</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">repProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">representation</span><span class="p">)</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span><span class="o">.</span><span class="n">GetClientSideObject</span><span class="p">()</span>

        <span class="n">dataRange</span> <span class="o">=</span> <span class="n">customRange</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dataRange</span><span class="p">:</span>
            <span class="n">dataRange</span> <span class="o">=</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetRange</span><span class="p">()</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dataRange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numSamples</span><span class="p">)</span>

        <span class="n">colorArray</span> <span class="o">=</span> <span class="n">vtkUnsignedCharArray</span><span class="p">()</span>
        <span class="n">colorArray</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">colorArray</span><span class="o">.</span><span class="n">SetNumberOfTuples</span><span class="p">(</span><span class="n">numSamples</span><span class="p">)</span>

        <span class="n">rgb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSamples</span><span class="p">):</span>
            <span class="n">lut</span><span class="o">.</span><span class="n">GetColor</span><span class="p">(</span><span class="n">dataRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
            <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
            <span class="n">colorArray</span><span class="o">.</span><span class="n">SetTuple3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="c1"># Add the color array to an image data</span>
        <span class="n">imgData</span> <span class="o">=</span> <span class="n">vtkImageData</span><span class="p">()</span>
        <span class="n">imgData</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="n">numSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">aIdx</span> <span class="o">=</span> <span class="n">imgData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">SetScalars</span><span class="p">(</span><span class="n">colorArray</span><span class="p">)</span>

        <span class="c1"># Use the vtk data encoder to base-64 encode the image as png, using no compression</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">vtkDataEncoder</span><span class="p">()</span>
        <span class="c1"># two calls in a row crash on Windows - bald timing hack to avoid the crash.</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">b64Str</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">EncodeAsBase64Png</span><span class="p">(</span><span class="n">imgData</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">dataRange</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">b64Str</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebColorManager.getLutImages"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getLutImages">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.lut.image.all&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getLutImages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numSamples</span><span class="p">):</span>
        <span class="n">colorArray</span> <span class="o">=</span> <span class="n">vtkUnsignedCharArray</span><span class="p">()</span>
        <span class="n">colorArray</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">colorArray</span><span class="o">.</span><span class="n">SetNumberOfTuples</span><span class="p">(</span><span class="n">numSamples</span><span class="p">)</span>

        <span class="n">pxm</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">ProxyManager</span><span class="p">()</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">pxm</span><span class="o">.</span><span class="n">NewProxy</span><span class="p">(</span><span class="s2">&quot;lookup_tables&quot;</span><span class="p">,</span> <span class="s2">&quot;PVLookupTable&quot;</span><span class="p">)</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">GetClientSideObject</span><span class="p">()</span>
        <span class="n">dataRange</span> <span class="o">=</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetRange</span><span class="p">()</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dataRange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numSamples</span><span class="p">)</span>

        <span class="c1"># Add the color array to an image data</span>
        <span class="n">imgData</span> <span class="o">=</span> <span class="n">vtkImageData</span><span class="p">()</span>
        <span class="n">imgData</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="n">numSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">imgData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">SetScalars</span><span class="p">(</span><span class="n">colorArray</span><span class="p">)</span>

        <span class="c1"># Use the vtk data encoder to base-64 encode the image as png, using no compression</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">vtkDataEncoder</span><span class="p">()</span>

        <span class="c1"># Result container</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop over all presets</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorMapNames</span><span class="p">:</span>
            <span class="n">lutProxy</span><span class="o">.</span><span class="n">ApplyPreset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSamples</span><span class="p">):</span>
                <span class="n">lut</span><span class="o">.</span><span class="n">GetColor</span><span class="p">(</span><span class="n">dataRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
                <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
                <span class="n">colorArray</span><span class="o">.</span><span class="n">SetTuple3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">EncodeAsBase64Png</span><span class="p">(</span><span class="n">imgData</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">lutProxy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1"># RpcName: setSurfaceOpacity =&gt; pv.color.manager.surface.opacity.set</span>
<div class="viewcode-block" id="ParaViewWebColorManager.setSurfaceOpacity"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.setSurfaceOpacity">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.surface.opacity.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setSurfaceOpacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representation</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">repProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">representation</span><span class="p">)</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span>

        <span class="n">lutProxy</span><span class="o">.</span><span class="n">EnableOpacityMapping</span> <span class="o">=</span> <span class="n">enabled</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: getSurfaceOpacity =&gt; pv.color.manager.surface.opacity.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getSurfaceOpacity"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getSurfaceOpacity">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.surface.opacity.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getSurfaceOpacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representation</span><span class="p">):</span>
        <span class="n">repProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">representation</span><span class="p">)</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span>

        <span class="k">return</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">EnableOpacityMapping</span></div>

    <span class="c1"># RpcName: setSurfaceOpacityByArray =&gt; pv.color.manager.surface.opacity.by.array.set</span>
<div class="viewcode-block" id="ParaViewWebColorManager.setSurfaceOpacityByArray"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.setSurfaceOpacityByArray">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.surface.opacity.by.array.set&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setSurfaceOpacityByArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>

        <span class="n">lutProxy</span><span class="o">.</span><span class="n">EnableOpacityMapping</span> <span class="o">=</span> <span class="n">enabled</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: getSurfaceOpacityByArray =&gt; pv.color.manager.surface.opacity.by.array.get</span>
<div class="viewcode-block" id="ParaViewWebColorManager.getSurfaceOpacityByArray"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.getSurfaceOpacityByArray">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.surface.opacity.by.array.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getSurfaceOpacityByArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">):</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">(</span><span class="n">arrayName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lutProxy</span><span class="o">.</span><span class="n">EnableOpacityMapping</span></div>

    <span class="c1"># RpcName: selectColorMap =&gt; pv.color.manager.select.preset</span>
<div class="viewcode-block" id="ParaViewWebColorManager.selectColorMap"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.selectColorMap">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.select.preset&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">selectColorMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representation</span><span class="p">,</span> <span class="n">paletteName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose the color map preset to use when coloring by an array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">repProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">representation</span><span class="p">)</span>
        <span class="n">lutProxy</span> <span class="o">=</span> <span class="n">repProxy</span><span class="o">.</span><span class="n">LookupTable</span>

        <span class="k">if</span> <span class="n">lutProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lutProxy</span><span class="o">.</span><span class="n">ApplyPreset</span><span class="p">(</span><span class="n">paletteName</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;Representation proxy &quot;</span>
                <span class="o">+</span> <span class="n">representation</span>
                <span class="o">+</span> <span class="s2">&quot; is missing lookup table&quot;</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;preset &quot;</span> <span class="o">+</span> <span class="n">paletteName</span> <span class="o">+</span> <span class="s2">&quot; not found&quot;</span><span class="p">}</span></div>

    <span class="c1"># RpcName: listColorMapNames =&gt; pv.color.manager.list.preset</span>
<div class="viewcode-block" id="ParaViewWebColorManager.listColorMapNames"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebColorManager.listColorMapNames">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.color.manager.list.preset&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">listColorMapNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the names of all color map presets available on the server.  This</span>
<span class="sd">        list will contain the names of any presets you provided in the file you</span>
<span class="sd">        supplied to the constructor of this protocol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorMapNames</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Proxy management protocol</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="ParaViewWebProxyManager"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebProxyManager</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="n">VTK_DATA_TYPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;void&quot;</span><span class="p">,</span>  <span class="c1"># 0</span>
        <span class="s2">&quot;bit&quot;</span><span class="p">,</span>  <span class="c1"># 1</span>
        <span class="s2">&quot;char&quot;</span><span class="p">,</span>  <span class="c1"># 2</span>
        <span class="s2">&quot;unsigned_char&quot;</span><span class="p">,</span>  <span class="c1"># 3</span>
        <span class="s2">&quot;short&quot;</span><span class="p">,</span>  <span class="c1"># 4</span>
        <span class="s2">&quot;unsigned_short&quot;</span><span class="p">,</span>  <span class="c1"># 5</span>
        <span class="s2">&quot;int&quot;</span><span class="p">,</span>  <span class="c1"># 6</span>
        <span class="s2">&quot;unsigned_int&quot;</span><span class="p">,</span>  <span class="c1"># 7</span>
        <span class="s2">&quot;long&quot;</span><span class="p">,</span>  <span class="c1"># 8</span>
        <span class="s2">&quot;unsigned_long&quot;</span><span class="p">,</span>  <span class="c1"># 9</span>
        <span class="s2">&quot;float&quot;</span><span class="p">,</span>  <span class="c1"># 10</span>
        <span class="s2">&quot;double&quot;</span><span class="p">,</span>  <span class="c1"># 11</span>
        <span class="s2">&quot;id_type&quot;</span><span class="p">,</span>  <span class="c1"># 12</span>
        <span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>  <span class="c1"># 13</span>
        <span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>  <span class="c1"># 14</span>
        <span class="s2">&quot;signed_char&quot;</span><span class="p">,</span>  <span class="c1"># 15</span>
        <span class="s2">&quot;long_long&quot;</span><span class="p">,</span>  <span class="c1"># 16</span>
        <span class="s2">&quot;unsigned_long_long&quot;</span><span class="p">,</span>  <span class="c1"># 17</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">allowedProxiesFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">baseDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fileToLoad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">allowUnconfiguredReaders</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">groupProxyEditorWidgets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">respectPropertyGroups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        basePath: specify the base directory (or directories) that we should start with, if this</span>
<span class="sd">        parameter takes the form: &quot;name1=path1|name2=path2|...&quot;, then we will treat this as the</span>
<span class="sd">        case where multiple data directories are required.  In this case, each top-level directory</span>
<span class="sd">        will be given the name associated with the directory in the argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebProxyManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugMode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupProxyEditorPropertyWidget</span> <span class="o">=</span> <span class="n">groupProxyEditorWidgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">respectPropertyGroups</span> <span class="o">=</span> <span class="n">respectPropertyGroups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyDefinitionCache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainFunctionMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vtkSMBooleanDomain&quot;</span><span class="p">:</span> <span class="n">booleanDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMProxyListDomain&quot;</span><span class="p">:</span> <span class="n">proxyListDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMIntRangeDomain&quot;</span><span class="p">:</span> <span class="n">numberRangeDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMDoubleRangeDomain&quot;</span><span class="p">:</span> <span class="n">numberRangeDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMArrayRangeDomain&quot;</span><span class="p">:</span> <span class="n">numberRangeDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMRepresentationTypeDomain&quot;</span><span class="p">:</span> <span class="n">stringListDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMStringListDomain&quot;</span><span class="p">:</span> <span class="n">stringListDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMArrayListDomain&quot;</span><span class="p">:</span> <span class="n">arrayListDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMArraySelectionDomain&quot;</span><span class="p">:</span> <span class="n">arraySelectionDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMEnumerationDomain&quot;</span><span class="p">:</span> <span class="n">enumerationDomainDecorator</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMCompositeTreeDomain&quot;</span><span class="p">:</span> <span class="n">treeDomainDecorator</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alwaysIncludeProperties</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GridAxesVisibility&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alwaysExcludeProperties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;LookupTable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Texture&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ColorArrayName&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Representations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HiddenRepresentations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HiddenProps&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UseTexturedBackground&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BackgroundTexture&quot;</span><span class="p">,</span>
            <span class="s2">&quot;KeyLightWarmth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;KeyLightIntensity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;KeyLightElevation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;KeyLightAzimuth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FileName&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propertyTypeMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vtkSMIntVectorProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMDoubleVectorProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMStringVectorProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMProxyProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;proxy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMInputProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;proxy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtkSMDoubleMapProperty&quot;</span><span class="p">:</span> <span class="s2">&quot;map&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hintsMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;PropertyWidgetDecorator&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ClipScalarsDecorator&quot;</span><span class="p">:</span> <span class="n">clipScalarDecorator</span><span class="p">,</span>
                <span class="s2">&quot;GenericDecorator&quot;</span><span class="p">:</span> <span class="n">genericDecorator</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;Widget&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;multi_line&quot;</span><span class="p">:</span> <span class="n">multiLineDecorator</span><span class="p">},</span>
            <span class="s2">&quot;ProxyEditorPropertyWidget&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">proxyEditorPropertyWidgetDecorator</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setBaseDirectory</span><span class="p">(</span><span class="n">baseDir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowUnconfiguredReaders</span> <span class="o">=</span> <span class="n">allowUnconfiguredReaders</span>

        <span class="c1"># If there was a proxy list file, use it, otherwise use the default</span>
        <span class="k">if</span> <span class="n">allowedProxiesFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readAllowedProxies</span><span class="p">(</span><span class="n">allowedProxiesFile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">._default_proxies</span> <span class="kn">import</span> <span class="n">getDefaultProxies</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">readAllowedProxies</span><span class="p">(</span><span class="n">getDefaultProxies</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">fileToLoad</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">fileToLoad</span><span class="p">:</span>
                <span class="n">fullBasePathForGroup</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAbsolutePath</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">))</span>
                <span class="n">fileNamePattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">)</span>
                <span class="n">groupToLoad</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fullBasePathForGroup</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileNamePattern</span><span class="p">):</span>
                        <span class="n">groupToLoad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fullBasePathForGroup</span><span class="p">,</span> <span class="n">fileName</span><span class="p">))</span>

                <span class="n">groupToLoad</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">alphanum_key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">groupToLoad</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simpleTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRenderView</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">SetActiveView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Read the configured proxies json file into a dictionary and process.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.readAllowedProxies"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.readAllowedProxies">[docs]</a>    <span class="k">def</span> <span class="nf">readAllowedProxies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepathOrConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">availableList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">configurationData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepathOrConfig</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">configurationData</span> <span class="o">=</span> <span class="n">filepathOrConfig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepathOrConfig</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">configurationData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureFiltersOrSources</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="n">configurationData</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureFiltersOrSources</span><span class="p">(</span><span class="s2">&quot;filters&quot;</span><span class="p">,</span> <span class="n">configurationData</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureReaders</span><span class="p">(</span><span class="n">configurationData</span><span class="p">[</span><span class="s2">&quot;readers&quot;</span><span class="p">])</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Handle filters and sources sections of the proxies config file.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.configureFiltersOrSources"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.configureFiltersOrSources">[docs]</a>    <span class="k">def</span> <span class="nf">configureFiltersOrSources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">flist</span><span class="p">):</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">availableList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Handle the readers section of the proxies config file.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.configureReaders"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.configureReaders">[docs]</a>    <span class="k">def</span> <span class="nf">configureReaders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">rlist</span><span class="p">:</span>
            <span class="n">readerName</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">readerMethod</span> <span class="o">=</span> <span class="s2">&quot;FileName&quot;</span>
            <span class="n">useDirectory</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">readerMethod</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;useDirectory&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">useDirectory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;useDirectory&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;extensions&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">readerName</span><span class="p">,</span> <span class="n">readerMethod</span><span class="p">,</span> <span class="n">useDirectory</span><span class="p">]</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Convenience method to get proxy defs, cached if available</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getProxyDefinition"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getProxyDefinition">[docs]</a>    <span class="k">def</span> <span class="nf">getProxyDefinition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">cacheKey</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cacheKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyDefinitionCache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyDefinitionCache</span><span class="p">[</span><span class="n">cacheKey</span><span class="p">]</span>

        <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">ActiveConnection</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">GetProxyDefinitionManager</span><span class="p">()</span><span class="o">.</span><span class="n">GetCollapsedProxyDefinition</span><span class="p">(</span>
            <span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="c1"># print(&#39;\n\n\n (%s, %s): \n\n&#39; % (group, name))</span>
        <span class="c1"># xmlElement.PrintXML()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyDefinitionCache</span><span class="p">[</span><span class="n">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlElement</span>
        <span class="k">return</span> <span class="n">xmlElement</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Look higher up in XML hierarchy for attributes on a property (useful if</span>
    <span class="c1"># a property is an exposed property).  From the documentation of vtkSMProperty,</span>
    <span class="c1"># the GetParent method will access the sub-proxy to which the property</span>
    <span class="c1"># actually belongs, if that is the case.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.extractParentAttributes"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.extractParentAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">extractParentAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="nb">property</span><span class="o">.</span><span class="n">SMProperty</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetPropertyName</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">SMProperty</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proxy</span> <span class="o">=</span> <span class="nb">property</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetPropertyName</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: unable to get property parent for property &quot;</span> <span class="o">+</span> <span class="nb">property</span><span class="o">.</span><span class="n">Name</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">{}</span>

        <span class="n">xmlElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProxyDefinition</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLGroup</span><span class="p">(),</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLName</span><span class="p">())</span>
        <span class="n">attrMap</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">nbChildren</span> <span class="o">=</span> <span class="n">xmlElement</span><span class="o">.</span><span class="n">GetNumberOfNestedElements</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbChildren</span><span class="p">):</span>
            <span class="n">xmlChild</span> <span class="o">=</span> <span class="n">xmlElement</span><span class="o">.</span><span class="n">GetNestedElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">elementName</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">elementName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Property&quot;</span><span class="p">):</span>
                <span class="n">propName</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">propName</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">attrName</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">attrName</span><span class="p">):</span>
                            <span class="n">attrMap</span><span class="p">[</span><span class="n">attrName</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">attrName</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attrMap</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># If we have a proxy property, gather up the xml information from the</span>
    <span class="c1"># possible proxy values it can take on.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getProxyListFromProperty"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getProxyListFromProperty">[docs]</a>    <span class="k">def</span> <span class="nf">getProxyListFromProperty</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">proxyPropElement</span><span class="p">,</span> <span class="n">inPropGroup</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">parentGroup</span><span class="p">,</span> <span class="n">detailsKey</span>
    <span class="p">):</span>
        <span class="n">propPropName</span> <span class="o">=</span> <span class="n">proxyPropElement</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">propVisibility</span> <span class="o">=</span> <span class="n">proxyPropElement</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;panel_visibility&quot;</span><span class="p">)</span>
        <span class="n">propInstance</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propPropName</span><span class="p">)</span>
        <span class="n">nbChildren</span> <span class="o">=</span> <span class="n">proxyPropElement</span><span class="o">.</span><span class="n">GetNumberOfNestedElements</span><span class="p">()</span>
        <span class="n">foundPLDChild</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">subProxiesToProcess</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">propInstance</span><span class="o">.</span><span class="n">FindDomain</span><span class="p">(</span><span class="s2">&quot;vtkSMProxyListDomain&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">domain</span><span class="p">:</span>
            <span class="n">foundPLDChild</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()):</span>
                <span class="n">subProxy</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">pelt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProxyDefinition</span><span class="p">(</span>
                    <span class="n">subProxy</span><span class="o">.</span><span class="n">GetXMLGroup</span><span class="p">(),</span> <span class="n">subProxy</span><span class="o">.</span><span class="n">GetXMLName</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">subProxiesToProcess</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">subProxy</span><span class="p">,</span> <span class="n">pelt</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subProxiesToProcess</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newGroup</span> <span class="o">=</span> <span class="n">group</span>
            <span class="n">newParentGroup</span> <span class="o">=</span> <span class="n">parentGroup</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupProxyEditorPropertyWidget</span><span class="p">:</span>
                <span class="n">hintChild</span> <span class="o">=</span> <span class="n">proxyPropElement</span><span class="o">.</span><span class="n">FindNestedElementByName</span><span class="p">(</span><span class="s2">&quot;Hints&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hintChild</span><span class="p">:</span>
                    <span class="n">pepwChild</span> <span class="o">=</span> <span class="n">hintChild</span><span class="o">.</span><span class="n">FindNestedElementByName</span><span class="p">(</span>
                        <span class="s2">&quot;ProxyEditorPropertyWidget&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">pepwChild</span><span class="p">:</span>
                        <span class="n">newGroup</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">(),</span> <span class="n">propPropName</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">newGroup</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;groupName&quot;</span><span class="p">:</span> <span class="n">propPropName</span><span class="p">,</span>
                            <span class="s2">&quot;groupWidget&quot;</span><span class="p">:</span> <span class="s2">&quot;ProxyEditorPropertyWidget&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;groupVisibilityProperty&quot;</span><span class="p">:</span> <span class="n">pepwChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span>
                                <span class="s2">&quot;property&quot;</span>
                            <span class="p">),</span>
                            <span class="s2">&quot;groupVisibility&quot;</span><span class="p">:</span> <span class="n">propVisibility</span>
                            <span class="k">if</span> <span class="n">propVisibility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;groupType&quot;</span><span class="p">:</span> <span class="s2">&quot;ProxyEditorPropertyWidget&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="n">newParentGroup</span> <span class="o">=</span> <span class="n">group</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newGroup</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span>
                            <span class="s2">&quot;parentGroup&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">newParentGroup</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subProxiesToProcess</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processXmlElement</span><span class="p">(</span>
                    <span class="n">sub</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">inPropGroup</span><span class="p">,</span> <span class="n">newGroup</span><span class="p">,</span> <span class="n">newParentGroup</span><span class="p">,</span> <span class="n">detailsKey</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">foundPLDChild</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Decide whether to update our internal map of property details, or just the</span>
    <span class="c1"># ordered list of properties, or both.</span>
    <span class="c1">#</span>
    <span class="c1"># detailsKey  =&gt; uniquely identifies a property via concatenation of proxy</span>
    <span class="c1">#                id and property name, e.g. &#39;476:Opacity&#39;</span>
    <span class="c1"># name        =&gt; property name</span>
    <span class="c1"># panelVis    =&gt; value of &#39;panel_visibilty&#39; attribute on element</span>
    <span class="c1"># size        =&gt; number of elements to set for this property</span>
    <span class="c1"># inPropGroup =&gt; whether or not this property is inside a &#39;PropertyGroup&#39; element</span>
    <span class="c1"># group       =&gt; name of group this property belongs to (could be other than &#39;root&#39;,</span>
    <span class="c1">#                even if &#39;inPropGroup&#39; is false, due to the grouping we impose</span>
    <span class="c1">#                when we encounter a ProxyProperty with Hints: &#39;ProxyEditorPropertyWidget&#39;)</span>
    <span class="c1"># parentGroup =&gt; name of parent group (could be None for root level property)</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.trackProperty"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.trackProperty">[docs]</a>    <span class="k">def</span> <span class="nf">trackProperty</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">detailsKey</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">panelVis</span><span class="p">,</span>
        <span class="n">panelVisQualifier</span><span class="p">,</span>
        <span class="n">size</span><span class="p">,</span>
        <span class="n">inPropGroup</span><span class="p">,</span>
        <span class="n">group</span><span class="p">,</span>
        <span class="n">parentGroup</span><span class="p">,</span>
        <span class="n">belongsToProxyProperty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">detailsKey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;panelVis&quot;</span><span class="p">:</span> <span class="n">panelVis</span><span class="p">,</span>
                <span class="s2">&quot;panelVisQualifier&quot;</span><span class="p">:</span> <span class="n">panelVisQualifier</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
                <span class="s2">&quot;parentGroup&quot;</span><span class="p">:</span> <span class="n">parentGroup</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">belongsToProxyProperty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">belongsToProxyProperty</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span><span class="p">[</span><span class="n">belongsToProxyProperty</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span><span class="p">[</span><span class="n">belongsToProxyProperty</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detailsKey</span><span class="p">)</span>

            <span class="c1"># If this property belongs to a proxy property, and if that property is marked</span>
            <span class="c1"># as advanced, then this property should be marked advanced too.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">belongsToProxyProperty</span><span class="p">][</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span>
                <span class="o">==</span> <span class="s2">&quot;advanced&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;advanced&quot;</span>

        <span class="k">if</span> <span class="n">inPropGroup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;parentGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parentGroup</span>
            <span class="k">if</span> <span class="n">panelVis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelVis</span>
            <span class="k">if</span> <span class="n">panelVisQualifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span>
                    <span class="s2">&quot;panelVisQualifier&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">panelVisQualifier</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">panelVis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelVis</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">panelVisQualifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;panelVisQualifier&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span>
                    <span class="s2">&quot;panelVisQualifier&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">panelVisQualifier</span>

        <span class="k">if</span> <span class="n">detailsKey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detailsKey</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Do already have property in ordered list, but because we&#39;re in a</span>
            <span class="c1"># PropertyGroup, we want to override the previous order</span>
            <span class="k">if</span> <span class="n">inPropGroup</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">detailsKey</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detailsKey</span><span class="p">)</span>

                <span class="c1"># Additionally, if the property we are now re-ordering is a ProxyProperty, then</span>
                <span class="c1"># we also need to grab any properties of the sub proxies of it&#39;s proxy list domain</span>
                <span class="c1"># and move all of those down as well</span>
                <span class="k">if</span> <span class="n">detailsKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span><span class="p">:</span>
                    <span class="n">subProxiesProps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">subProxyPropKey</span> <span class="ow">in</span> <span class="n">subProxiesProps</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">subProxyPropKey</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subProxyPropKey</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Gather information from the xml associated with a proxy and properties.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.processXmlElement"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.processXmlElement">[docs]</a>    <span class="k">def</span> <span class="nf">processXmlElement</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">proxy</span><span class="p">,</span>
        <span class="n">xmlElement</span><span class="p">,</span>
        <span class="n">inPropGroup</span><span class="p">,</span>
        <span class="n">group</span><span class="p">,</span>
        <span class="n">parentGroup</span><span class="p">,</span>
        <span class="n">belongsToProxyProperty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">proxyId</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="n">nbChildren</span> <span class="o">=</span> <span class="n">xmlElement</span><span class="o">.</span><span class="n">GetNumberOfNestedElements</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbChildren</span><span class="p">):</span>
            <span class="n">xmlChild</span> <span class="o">=</span> <span class="n">xmlElement</span><span class="o">.</span><span class="n">GetNestedElement</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
            <span class="n">nameAttr</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">detailsKey</span> <span class="o">=</span> <span class="n">proxyId</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nameAttr</span><span class="p">)</span>

            <span class="n">infoOnly</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;information_only&quot;</span><span class="p">)</span>
            <span class="n">isInternal</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;is_internal&quot;</span><span class="p">)</span>
            <span class="n">panelVis</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;panel_visibility&quot;</span><span class="p">)</span>
            <span class="n">numElts</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;number_of_elements&quot;</span><span class="p">)</span>

            <span class="n">panelVisQualifier</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyIsRepresentation</span><span class="p">:</span>
                <span class="n">panelVisQualifier</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;panel_visibility_default_for_representation&quot;</span>
                <span class="p">)</span>

            <span class="n">size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">informationOnly</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">internal</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Check for attributes that might only exist on parent xml</span>
            <span class="n">parentQueryList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">numElts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parentQueryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;number_of_elements&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numElts</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">infoOnly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parentQueryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;information_only&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">informationOnly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">infoOnly</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">isInternal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parentQueryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;is_internal&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">internal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">isInternal</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">panelVis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parentQueryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;panel_visibility&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyIsRepresentation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">panelVisQualifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parentQueryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;panel_visibility_default_for_representation&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Try to retrieve those attributes from parent xml (implicit assumption is this is a property</span>
            <span class="c1"># which actually belongs to a subproxy)</span>
            <span class="n">parentAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parentQueryList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">propInstance</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">nameAttr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">propInstance</span><span class="p">:</span>
                    <span class="n">parentAttrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractParentAttributes</span><span class="p">(</span>
                        <span class="n">propInstance</span><span class="p">,</span> <span class="n">parentQueryList</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;number_of_elements&quot;</span> <span class="ow">in</span> <span class="n">parentAttrs</span>
                <span class="ow">and</span> <span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;number_of_elements&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;number_of_elements&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;information_only&quot;</span> <span class="ow">in</span> <span class="n">parentAttrs</span> <span class="ow">and</span> <span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;information_only&quot;</span><span class="p">]:</span>
                <span class="n">informationOnly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;information_only&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;is_internal&quot;</span> <span class="ow">in</span> <span class="n">parentAttrs</span> <span class="ow">and</span> <span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;is_internal&quot;</span><span class="p">]:</span>
                <span class="n">internal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;is_internal&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;panel_visibility&quot;</span> <span class="ow">in</span> <span class="n">parentAttrs</span><span class="p">:</span>
                <span class="n">panelVis</span> <span class="o">=</span> <span class="n">parentAttrs</span><span class="p">[</span><span class="s2">&quot;panel_visibility&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;panel_visibility_default_for_representation&quot;</span> <span class="ow">in</span> <span class="n">parentAttrs</span><span class="p">:</span>
                <span class="n">panelVisQualifier</span> <span class="o">=</span> <span class="n">parentAttrs</span><span class="p">[</span>
                    <span class="s2">&quot;panel_visibility_default_for_representation&quot;</span>
                <span class="p">]</span>

            <span class="c1"># Now decide whether we should filter out this property</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Property&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">panelVis</span> <span class="o">==</span> <span class="s2">&quot;never&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">informationOnly</span> <span class="o">==</span> <span class="mi">1</span>
                    <span class="ow">or</span> <span class="n">internal</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="ow">and</span> <span class="n">nameAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysIncludeProperties</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="n">nameAttr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysExcludeProperties</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Filtering out property &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nameAttr</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; because panelVis is never, infoOnly is 1, isInternal is 1, or &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nameAttr</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; is an ALWAYS EXCLUDE property&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Hints&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;    ((((((((((Got the hints))))))))) &quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmlChild</span><span class="o">.</span><span class="n">GetNumberOfNestedElements</span><span class="p">()):</span>
                    <span class="n">hintChild</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetNestedElement</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hintChild</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Visibility&quot;</span><span class="p">:</span>
                        <span class="n">replaceInputAttr</span> <span class="o">=</span> <span class="n">hintChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;replace_input&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">replaceInputAttr</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="s2">&quot;specialHints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s2">&quot;replaceInput&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">replaceInputAttr</span><span class="p">)</span>
                            <span class="p">}</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;          Replace input value: &quot;</span>
                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">replaceInputAttr</span><span class="p">)</span>
                            <span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ProxyProperty&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;InputProperty&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nameAttr</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is a proxy property&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trackProperty</span><span class="p">(</span>
                    <span class="n">detailsKey</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">panelVis</span><span class="p">,</span>
                    <span class="n">panelVisQualifier</span><span class="p">,</span>
                    <span class="n">size</span><span class="p">,</span>
                    <span class="n">inPropGroup</span><span class="p">,</span>
                    <span class="n">group</span><span class="p">,</span>
                    <span class="n">parentGroup</span><span class="p">,</span>
                    <span class="n">belongsToProxyProperty</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">foundProxyListDomain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProxyListFromProperty</span><span class="p">(</span>
                    <span class="n">proxy</span><span class="p">,</span> <span class="n">xmlChild</span><span class="p">,</span> <span class="n">inPropGroup</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">parentGroup</span><span class="p">,</span> <span class="n">detailsKey</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">foundProxyListDomain</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">detailsKey</span><span class="p">][</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Property&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trackProperty</span><span class="p">(</span>
                    <span class="n">detailsKey</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">panelVis</span><span class="p">,</span>
                    <span class="n">panelVisQualifier</span><span class="p">,</span>
                    <span class="n">size</span><span class="p">,</span>
                    <span class="n">inPropGroup</span><span class="p">,</span>
                    <span class="n">group</span><span class="p">,</span>
                    <span class="n">parentGroup</span><span class="p">,</span>
                    <span class="n">belongsToProxyProperty</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Anything else, we recursively process the element, with special handling</span>
                <span class="c1"># in the case that the element is a PropertyGroup</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PropertyGroup&quot;</span><span class="p">:</span>
                    <span class="n">newGroup</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="n">newParentGroup</span> <span class="o">=</span> <span class="n">parentGroup</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">respectPropertyGroups</span><span class="p">:</span>
                        <span class="n">typeAttr</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                        <span class="n">labelAttr</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
                        <span class="n">panelWidgetAttr</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">labelAttr</span><span class="p">:</span>
                            <span class="n">panelWidgetAttr</span> <span class="o">=</span> <span class="n">xmlChild</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;panel_widget&quot;</span><span class="p">)</span>
                            <span class="n">labelAttr</span> <span class="o">=</span> <span class="n">panelWidgetAttr</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">labelAttr</span><span class="p">:</span>
                                <span class="n">labelAttr</span> <span class="o">=</span> <span class="s2">&quot;Unlabeled Property Group (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">proxyId</span>
                        <span class="n">newGroup</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">labelAttr</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">newGroup</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;groupName&quot;</span><span class="p">:</span> <span class="n">labelAttr</span><span class="p">,</span>
                            <span class="s2">&quot;groupWidget&quot;</span><span class="p">:</span> <span class="s2">&quot;PropertyGroup&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;groupVisibility&quot;</span><span class="p">:</span> <span class="n">panelVis</span><span class="p">,</span>
                            <span class="s2">&quot;groupType&quot;</span><span class="p">:</span> <span class="n">typeAttr</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="n">newParentGroup</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processXmlElement</span><span class="p">(</span>
                        <span class="n">proxy</span><span class="p">,</span>
                        <span class="n">xmlChild</span><span class="p">,</span>
                        <span class="kc">True</span><span class="p">,</span>
                        <span class="n">newGroup</span><span class="p">,</span>
                        <span class="n">newParentGroup</span><span class="p">,</span>
                        <span class="n">belongsToProxyProperty</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processXmlElement</span><span class="p">(</span>
                        <span class="n">proxy</span><span class="p">,</span>
                        <span class="n">xmlChild</span><span class="p">,</span>
                        <span class="n">inPropGroup</span><span class="p">,</span>
                        <span class="n">group</span><span class="p">,</span>
                        <span class="n">parentGroup</span><span class="p">,</span>
                        <span class="n">belongsToProxyProperty</span><span class="p">,</span>
                    <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Entry point for the xml processing methods.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getProxyXmlDefinitions"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getProxyXmlDefinitions">[docs]</a>    <span class="k">def</span> <span class="nf">getProxyXmlDefinitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyPropertyDependents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyIsRepresentation</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLGroup</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;representations&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;groupName&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">}</span>

        <span class="n">xmlElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProxyDefinition</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLGroup</span><span class="p">(),</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLName</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processXmlElement</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">xmlElement</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Length of final ordered property list: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">propName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="p">:</span>
            <span class="n">propRec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">propName</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Property &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propName</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;, type = &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propRec</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot;, pvis = &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propRec</span><span class="p">[</span><span class="s2">&quot;panelVis&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot;, size = &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propRec</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">])</span>
            <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function to fill in all the properties of a proxy.  Delegates</span>
    <span class="c1"># properties with specific domain types to other helpers.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.fillPropertyList"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.fillPropertyList">[docs]</a>    <span class="k">def</span> <span class="nf">fillPropertyList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">propertyList</span><span class="p">,</span> <span class="n">dependency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">ListProperties</span><span class="p">():</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
                <span class="n">propertyName</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">Name</span>
                <span class="n">displayName</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetXMLLabel</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">propertyName</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Refresh&quot;</span><span class="p">,</span> <span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">propertyName</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span>
                    <span class="s2">&quot;Info&quot;</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">pythonProp</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_wrap_property</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

                <span class="n">propJson</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">propertyName</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">displayName</span><span class="p">}</span>

                <span class="k">if</span> <span class="n">dependency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;dependency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dependency</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="n">ProxyProperty</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="n">InputProperty</span><span class="p">:</span>
                    <span class="n">proxyListDomain</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">FindDomain</span><span class="p">(</span><span class="s2">&quot;vtkSMProxyListDomain&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">proxyListDomain</span><span class="p">:</span>
                        <span class="c1"># Set the value of this ProxyProperty</span>
                        <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetXMLLabel</span><span class="p">()</span>

                        <span class="c1"># Now recursively fill in properties of this proxy property</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proxyListDomain</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()):</span>
                            <span class="n">subProxy</span> <span class="o">=</span> <span class="n">proxyListDomain</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="n">subProxyId</span> <span class="o">=</span> <span class="n">subProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
                            <span class="n">depStr</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">proxy_id</span>
                                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
                                <span class="o">+</span> <span class="n">propertyName</span>
                                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
                                <span class="o">+</span> <span class="n">subProxy</span><span class="o">.</span><span class="n">GetXMLLabel</span><span class="p">()</span>
                                <span class="o">+</span> <span class="s2">&quot;:1&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fillPropertyList</span><span class="p">(</span><span class="n">subProxyId</span><span class="p">,</span> <span class="n">propertyList</span><span class="p">,</span> <span class="n">depStr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># The value of this ProxyProperty is the list of proxy ids</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()):</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">())</span>
                        <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For everything but ProxyProperty, we should just be able to call GetData()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">attrErr</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Property &quot;</span>
                            <span class="o">+</span> <span class="n">propertyName</span>
                            <span class="o">+</span> <span class="s2">&quot; has no GetData() method, skipping&quot;</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># One exception is properties which have enumeration domain, in which case we substitute</span>
                    <span class="c1"># the numeric value for the enum text value.</span>
                    <span class="n">enumDomain</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">FindDomain</span><span class="p">(</span><span class="s2">&quot;vtkSMEnumerationDomain&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">enumDomain</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">entryNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">enumDomain</span><span class="o">.</span><span class="n">GetNumberOfEntries</span><span class="p">()):</span>
                            <span class="k">if</span> <span class="n">enumDomain</span><span class="o">.</span><span class="n">GetEntryText</span><span class="p">(</span><span class="n">entryNum</span><span class="p">)</span> <span class="o">==</span> <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]:</span>
                                <span class="n">propJson</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enumDomain</span><span class="o">.</span><span class="n">GetEntryValue</span><span class="p">(</span><span class="n">entryNum</span><span class="p">)</span>
                                <span class="k">break</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding a property to the pre-sorted list: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propJson</span><span class="p">))</span>
                <span class="n">propertyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propJson</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Make a first pass over the properties, building up a couple of data</span>
    <span class="c1"># structures we can use to reorder the properties to match the xml order.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.reorderProperties"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.reorderProperties">[docs]</a>    <span class="k">def</span> <span class="nf">reorderProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rootProxyId</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getProxyXmlDefinitions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">rootProxyId</span><span class="p">))</span>

        <span class="n">propMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">proxyProperties</span><span class="p">:</span>
            <span class="n">propMap</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">prop</span>

        <span class="n">orderedList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">groupsInfo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedNameList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">propMap</span><span class="p">:</span>
                <span class="n">orderedList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propMap</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="n">xmlDetails</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">groupsInfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">xmlDetails</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;parentGroup&quot;</span><span class="p">:</span> <span class="n">xmlDetails</span><span class="p">[</span><span class="s2">&quot;parentGroup&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">orderedList</span><span class="p">,</span> <span class="n">groupsInfo</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Convenience function to set a property value.  Can be extended with other</span>
    <span class="c1"># special cases as the need arises.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.setProperty"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.setProperty">[docs]</a>    <span class="k">def</span> <span class="nf">setProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">propertyValue</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">propertyValue</span> <span class="o">==</span> <span class="s2">&quot;vtkProcessId&quot;</span><span class="p">:</span>
            <span class="nb">property</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">propertyValue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">property</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">propertyValue</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Taken directly from helper.py, applies domains so we can see real values.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.applyDomains"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.applyDomains">[docs]</a>    <span class="k">def</span> <span class="nf">applyDomains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentProxy</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is used to apply the domains so that queries for</span>
<span class="sd">        specific values like range min and max retrieve something useful.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>

        <span class="c1"># Call recursively on each sub-proxy if any</span>
        <span class="k">for</span> <span class="n">property_name</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">ListProperties</span><span class="p">():</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">property_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkSMProxyProperty&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">Available</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">listdomain</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">FindDomain</span><span class="p">(</span><span class="s2">&quot;vtkSMProxyListDomain&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">listdomain</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">listdomain</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()):</span>
                                <span class="n">internal_proxy</span> <span class="o">=</span> <span class="n">listdomain</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">applyDomains</span><span class="p">(</span>
                                    <span class="n">parentProxy</span><span class="p">,</span> <span class="n">internal_proxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
                                <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_obj</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="s2">&quot; line: &quot;</span><span class="p">,</span> <span class="n">exc_tb</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">)</span>

        <span class="c1"># Reset all properties to leverage domain capabilities</span>
        <span class="k">for</span> <span class="n">prop_name</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">ListProperties</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">prop_name</span> <span class="o">==</span> <span class="s2">&quot;Input&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">skipReset</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">prop_name</span><span class="p">)</span>
                <span class="nb">iter</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">NewDomainIterator</span><span class="p">()</span>
                <span class="nb">iter</span><span class="o">.</span><span class="n">Begin</span><span class="p">()</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="nb">iter</span><span class="o">.</span><span class="n">IsAtEnd</span><span class="p">():</span>
                    <span class="n">domain</span> <span class="o">=</span> <span class="nb">iter</span><span class="o">.</span><span class="n">GetDomain</span><span class="p">()</span>
                    <span class="nb">iter</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkSMBoundsDomain&quot;</span><span class="p">):</span>
                            <span class="n">domain</span><span class="o">.</span><span class="n">SetDomainValues</span><span class="p">(</span>
                                <span class="n">parentProxy</span><span class="o">.</span><span class="n">GetDataInformation</span><span class="p">()</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">()</span>
                            <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">attrErr</span><span class="p">:</span>
                        <span class="n">skipReset</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;Caught exception setting domain values in apply_domains:&quot;</span>
                        <span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">attrErr</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">skipReset</span><span class="p">:</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">ResetToDefault</span><span class="p">()</span>

                <span class="c1"># Need to UnRegister to handle the ref count from the NewDomainIterator</span>
                <span class="nb">iter</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_obj</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="s2">&quot; line: &quot;</span><span class="p">,</span> <span class="n">exc_tb</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">)</span>

        <span class="n">proxy</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function to gather information about the bounds, point, and cell</span>
    <span class="c1"># data.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getDataInformation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getDataInformation">[docs]</a>    <span class="k">def</span> <span class="nf">getDataInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c1"># The stuff in here works, but only after you have created the</span>
        <span class="c1"># representation.</span>
        <span class="n">dataInfo</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetDataInformation</span><span class="p">()</span>

        <span class="c1"># Get some basic statistics about the data</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">(),</span>
            <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetNumberOfPoints</span><span class="p">(),</span>
            <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetNumberOfCells</span><span class="p">(),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetPrettyDataTypeString</span><span class="p">(),</span>
            <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetMemorySize</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="n">arrayData</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get information about point data arrays</span>
        <span class="n">pdInfo</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetPointDataInformation</span><span class="p">()</span>
        <span class="n">numberOfPointArrays</span> <span class="o">=</span> <span class="n">pdInfo</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">numberOfPointArrays</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">pdInfo</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">numComps</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="n">ParaViewWebProxyManager</span><span class="o">.</span><span class="n">VTK_DATA_TYPES</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">GetDataType</span><span class="p">()]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">numComps</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;POINTS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">typeStr</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">magRange</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rangeList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">numComps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numComps</span><span class="p">):</span>
                    <span class="n">ithrange</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">GetComponentName</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>

            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rangeList</span>
            <span class="n">arrayData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Get information about cell data arrays</span>
        <span class="n">cdInfo</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetCellDataInformation</span><span class="p">()</span>
        <span class="n">numberOfCellArrays</span> <span class="o">=</span> <span class="n">cdInfo</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">numberOfCellArrays</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">cdInfo</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">numComps</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="n">ParaViewWebProxyManager</span><span class="o">.</span><span class="n">VTK_DATA_TYPES</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">GetDataType</span><span class="p">()]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">numComps</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;CELLS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">typeStr</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">magRange</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rangeList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">numComps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numComps</span><span class="p">):</span>
                    <span class="n">ithrange</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">GetComponentName</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">magRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>

            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rangeList</span>
            <span class="n">arrayData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Get field data information</span>
        <span class="n">fdInfo</span> <span class="o">=</span> <span class="n">dataInfo</span><span class="o">.</span><span class="n">DataInformation</span><span class="o">.</span><span class="n">GetFieldDataInformation</span><span class="p">()</span>
        <span class="n">numFieldDataArrays</span> <span class="o">=</span> <span class="n">fdInfo</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">numFieldDataArrays</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">fdInfo</span><span class="o">.</span><span class="n">GetArrayInformation</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">numComps</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="n">ParaViewWebProxyManager</span><span class="o">.</span><span class="n">VTK_DATA_TYPES</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">GetDataType</span><span class="p">()]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">numComps</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;FIELDS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">typeStr</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">rangeList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numComps</span><span class="p">):</span>
                <span class="n">ithrange</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetComponentRange</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">rangeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">GetComponentName</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">ithrange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rangeList</span>
            <span class="n">arrayData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Time data</span>
        <span class="n">timeKeeper</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="nb">iter</span><span class="p">(</span><span class="n">servermanager</span><span class="o">.</span><span class="n">ProxyManager</span><span class="p">()</span><span class="o">.</span><span class="n">GetProxiesInGroup</span><span class="p">(</span><span class="s2">&quot;timekeeper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">tsVals</span> <span class="o">=</span> <span class="n">timeKeeper</span><span class="o">.</span><span class="n">TimestepValues</span>
        <span class="k">if</span> <span class="n">tsVals</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tsVals</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">tsVals</span> <span class="o">=</span> <span class="p">[</span><span class="n">tsVals</span><span class="p">]</span>
            <span class="n">tValStrings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tsVal</span> <span class="ow">in</span> <span class="n">tsVals</span><span class="p">:</span>
                <span class="n">tValStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tsVal</span><span class="p">))</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tValStrings</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;arrays&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrayData</span>
        <span class="k">return</span> <span class="n">info</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function to gather information about the coloring used by this</span>
    <span class="c1"># representation proxy.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getColorInformation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getColorInformation">[docs]</a>    <span class="k">def</span> <span class="nf">getColorInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a block of color information, given a representation proxy.</span>

<span class="sd">            colorBy: {</span>
<span class="sd">                &#39;representation&#39;: &#39;652&#39;,</span>
<span class="sd">                &#39;scalarBar&#39;: 0,</span>
<span class="sd">                &#39;mode&#39;: &#39;color&#39;    # &#39;array&#39;</span>
<span class="sd">                &#39;color&#39;: [ 0.5, 1.0, 1.0 ],</span>
<span class="sd">                &#39;array&#39;: [ &#39;POINTS&#39;, &#39;RTData&#39;, -1 ],</span>
<span class="sd">                &#39;colorMap&#39;: &#39;Blue to Red&#39;</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colorInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;representation&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DiffuseColor&quot;</span><span class="p">):</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DiffuseColor&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;ColorArrayName&quot;</span><span class="p">):</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;array&quot;</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sbVisible</span> <span class="o">=</span> <span class="n">vtkSMPVRepresentationProxy</span><span class="o">.</span><span class="n">IsScalarBarVisible</span><span class="p">(</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">SMProxy</span>
            <span class="p">)</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;scalarBar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">sbVisible</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;LookupTable&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
            <span class="n">component</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">lut</span> <span class="ow">and</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;VectorMode&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Component&quot;</span><span class="p">:</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;VectorComponent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>

            <span class="n">colorArrayProp</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;ColorArrayName&quot;</span><span class="p">)</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">colorArrayProp</span><span class="o">.</span><span class="n">GetAssociation</span><span class="p">(),</span>
                <span class="n">colorArrayProp</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">(),</span>
                <span class="n">component</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;color&quot;</span>
            <span class="n">colorInfo</span><span class="p">[</span><span class="s2">&quot;scalarBar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">colorInfo</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function populate the ui structures list, which corresponds with</span>
    <span class="c1"># with the properties list, element by element, and provides information</span>
    <span class="c1"># about the ui elements needed to represent each property.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.getUiProperties"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.getUiProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getUiProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates an array of objects, parallel to the properties, containing</span>
<span class="sd">        the information needed to render ui for each property.  Not all of the</span>
<span class="sd">        following attributes will always be present.</span>

<span class="sd">        ui : [ {</span>
<span class="sd">                 &#39;name&#39;: &#39;Clip Type&#39;,</span>
<span class="sd">                 &#39;advanced&#39;: 1,                 # 0</span>
<span class="sd">                 &#39;doc&#39;: &#39;Documentation string for the property&#39;,</span>
<span class="sd">                 &#39;dependency&#39;: &#39;498:ClipFunction:Sphere:1&#39;,</span>
<span class="sd">                 &#39;values&#39;: { &#39;Plane&#39;: &#39;456&#39;, &#39;Box&#39;: &#39;457&#39;, &#39;Scalar&#39;: &#39;458&#39;, &#39;Sphere&#39;: &#39;459&#39; },</span>
<span class="sd">                 &#39;type&#39;: &#39;int&#39;,                    # &#39;float&#39;, &#39;int&#39;, &#39;str&#39;, &#39;proxy&#39;, &#39;input&#39;, ...</span>
<span class="sd">                 &#39;widget&#39;: &#39;textfield&#39;,            # &#39;checkbox&#39;, &#39;textarea&#39;, &#39;list-1&#39;, &#39;list-n&#39;</span>
<span class="sd">                 &#39;size&#39;: -1,                       # -1, 0, 2, 3, 6</span>
<span class="sd">                 &#39;range&#39;: [ { &#39;min&#39;: 0, &#39;max&#39;: 1 }, { &#39;min&#39;: 4, &#39;max&#39;: 7 }, ... ]</span>
<span class="sd">               }, ...</span>
<span class="sd">             ]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyIsRepresentation</span><span class="p">:</span>
            <span class="n">reprProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
            <span class="n">reprProp</span> <span class="o">=</span> <span class="n">reprProxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Representation&quot;</span><span class="p">)</span>
            <span class="n">reprValue</span> <span class="o">=</span> <span class="n">reprProp</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>

        <span class="n">uiProps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">proxyProp</span> <span class="ow">in</span> <span class="n">proxyProperties</span><span class="p">:</span>
            <span class="n">uiElt</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">pid</span> <span class="o">=</span> <span class="n">proxyProp</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">propertyName</span> <span class="o">=</span> <span class="n">proxyProp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span>

            <span class="c1"># Get the xml details we already parsed out for this property</span>
            <span class="n">xmlProps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="n">pid</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">propertyName</span><span class="p">]</span>

            <span class="c1"># Set a few defaults for the ui elements, which may be overridden</span>
            <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlProps</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;textfield&quot;</span>
            <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyTypeMap</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">()]</span>

            <span class="n">doc</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetDocumentation</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">doc</span><span class="p">:</span>
                <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">GetDescription</span><span class="p">()</span>

            <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyProp</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
            <span class="n">proxyProp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;dependency&quot;</span> <span class="ow">in</span> <span class="n">proxyProp</span><span class="p">:</span>
                <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;depends&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyProp</span><span class="p">[</span><span class="s2">&quot;dependency&quot;</span><span class="p">]</span>
                <span class="n">proxyProp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dependency&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmlProps</span><span class="p">[</span><span class="s2">&quot;panelVis&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;advanced&quot;</span><span class="p">:</span>
                <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proxyIsRepresentation</span>
                    <span class="ow">and</span> <span class="s2">&quot;panelVisQualifier&quot;</span> <span class="ow">in</span> <span class="n">xmlProps</span>
                    <span class="ow">and</span> <span class="n">xmlProps</span><span class="p">[</span><span class="s2">&quot;panelVisQualifier&quot;</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">xmlProps</span><span class="p">[</span><span class="s2">&quot;panelVisQualifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">reprValue</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uiElt</span><span class="p">[</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Iterate over the property domains until we find the interesting one</span>
            <span class="n">domainIter</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">NewDomainIterator</span><span class="p">()</span>
            <span class="n">domainIter</span><span class="o">.</span><span class="n">Begin</span><span class="p">()</span>
            <span class="n">foundDomain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="n">domainIter</span><span class="o">.</span><span class="n">IsAtEnd</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">foundDomain</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">nextDomain</span> <span class="o">=</span> <span class="n">domainIter</span><span class="o">.</span><span class="n">GetDomain</span><span class="p">()</span>
                <span class="n">domainName</span> <span class="o">=</span> <span class="n">nextDomain</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainFunctionMap</span><span class="p">:</span>
                    <span class="n">domainFunction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainFunctionMap</span><span class="p">[</span><span class="n">domainName</span><span class="p">]</span>
                    <span class="n">foundDomain</span> <span class="o">=</span> <span class="n">domainFunction</span><span class="p">(</span><span class="n">proxyProp</span><span class="p">,</span> <span class="n">xmlProps</span><span class="p">,</span> <span class="n">uiElt</span><span class="p">,</span> <span class="n">nextDomain</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Processed &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot; as domain &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domainName</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">domainIter</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">foundDomain</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;  ~~~|~~~ &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; did not have recognized domain&quot;</span>
                <span class="p">)</span>

            <span class="n">domainIter</span><span class="o">.</span><span class="n">FastDelete</span><span class="p">()</span>

            <span class="c1"># Now get hints for the property and provide an opportunity to decorate</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">GetHints</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hints</span><span class="p">:</span>
                <span class="n">numHints</span> <span class="o">=</span> <span class="n">hints</span><span class="o">.</span><span class="n">GetNumberOfNestedElements</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numHints</span><span class="p">):</span>
                    <span class="n">hint</span> <span class="o">=</span> <span class="n">hints</span><span class="o">.</span><span class="n">GetNestedElement</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hint</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hintsMap</span><span class="p">:</span>
                        <span class="n">hmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hintsMap</span><span class="p">[</span><span class="n">hint</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span>
                        <span class="n">hintType</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                        <span class="n">hmapKey</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">hintType</span> <span class="ow">and</span> <span class="n">hintType</span> <span class="ow">in</span> <span class="n">hmap</span><span class="p">:</span>
                            <span class="n">hmapKey</span> <span class="o">=</span> <span class="n">hintType</span>
                        <span class="k">elif</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">hmap</span><span class="p">:</span>
                            <span class="n">hmapKey</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

                        <span class="k">if</span> <span class="n">hmapKey</span><span class="p">:</span>
                            <span class="c1"># We&#39;re interested in decorating based on this hint</span>
                            <span class="n">hintFunction</span> <span class="o">=</span> <span class="n">hmap</span><span class="p">[</span><span class="n">hmapKey</span><span class="p">]</span>
                            <span class="n">hintFunction</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">uiElt</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>

            <span class="n">uiProps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uiElt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uiProps</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function to restructure the properties so they reflect the grouping</span>
    <span class="c1"># encountered when processing the xml.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.restructureProperties"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.restructureProperties">[docs]</a>    <span class="k">def</span> <span class="nf">restructureProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupList</span><span class="p">,</span> <span class="n">propList</span><span class="p">,</span> <span class="n">uiList</span><span class="p">):</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uis</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">uiList</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">groupMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;proxy&quot;</span><span class="p">:</span> <span class="n">props</span><span class="p">,</span> <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="n">uis</span><span class="p">}}</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groupList</span><span class="p">)):</span>
            <span class="n">groupInfo</span> <span class="o">=</span> <span class="n">groupList</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">groupInfo</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span>
            <span class="n">parentGroup</span> <span class="o">=</span> <span class="n">groupInfo</span><span class="p">[</span><span class="s2">&quot;parentGroup&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">group</span> <span class="o">!=</span> <span class="s2">&quot;root&quot;</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupVisibility&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;never&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Culling property (</span><span class="si">%s</span><span class="s2">) in group (</span><span class="si">%s</span><span class="s2">) because group has visibility never&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">propList</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">group</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupMap</span><span class="p">:</span>
                <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;proxy&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">uiList</span> <span class="k">else</span> <span class="kc">None</span><span class="p">}</span>
                <span class="n">groupMap</span><span class="p">[</span><span class="n">parentGroup</span><span class="p">][</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupName&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;proxy&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">uiList</span><span class="p">:</span>
                    <span class="n">groupMap</span><span class="p">[</span><span class="n">parentGroup</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;widget&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupWidget&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupName&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupType&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;advanced&quot;</span><span class="p">:</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupVisibility&quot;</span><span class="p">]</span>
                            <span class="o">==</span> <span class="s2">&quot;advanced&quot;</span>
                            <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                    <span class="c1"># Make sure we can find the group ui item we just appended</span>
                    <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupItem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">groupMap</span><span class="p">[</span><span class="n">parentGroup</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">pushToFront</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">uiList</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;groupVisibilityProperty&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">propList</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupDetailsMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;groupVisibilityProperty&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="c1"># If a proxy property claimed this property as its visibilty property, we should not</span>
                    <span class="c1"># allow it to remain marked as &#39;advanced&#39;.</span>
                    <span class="n">uiList</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">pushToFront</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">pushToFront</span><span class="p">:</span>
                    <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">uiList</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uiList</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">pushToFront</span><span class="p">:</span>
                <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">propList</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">groupMap</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propList</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="c1"># Before we&#39;re done we need to check for groups of properties where every</span>
        <span class="c1"># property in the group has a panel_visibilty of &#39;advanced&#39;, in which</span>
        <span class="c1"># case, the group should be marked the same.</span>
        <span class="k">if</span> <span class="n">uiList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">groupMap</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">groupName</span> <span class="o">!=</span> <span class="s2">&quot;root&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ui&quot;</span> <span class="ow">in</span> <span class="n">groupMap</span><span class="p">[</span><span class="n">groupName</span><span class="p">]:</span>
                    <span class="n">groupUiList</span> <span class="o">=</span> <span class="n">groupMap</span><span class="p">[</span><span class="n">groupName</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span>
                    <span class="n">firstUiElt</span> <span class="o">=</span> <span class="n">groupUiList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">groupDependency</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="s2">&quot;depends&quot;</span> <span class="ow">in</span> <span class="n">firstUiElt</span> <span class="ow">and</span> <span class="n">firstUiElt</span><span class="p">[</span><span class="s2">&quot;depends&quot;</span><span class="p">]:</span>
                        <span class="n">groupDependency</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">advancedGroup</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">uiProp</span> <span class="ow">in</span> <span class="n">groupUiList</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">uiProp</span><span class="p">[</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">advancedGroup</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">groupDependency</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="s2">&quot;depends&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uiProp</span>
                            <span class="ow">or</span> <span class="n">uiProp</span><span class="p">[</span><span class="s2">&quot;depends&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">firstUiElt</span><span class="p">[</span><span class="s2">&quot;depends&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">groupDependency</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">advancedGroup</span><span class="p">:</span>
                        <span class="n">groupMap</span><span class="p">[</span><span class="n">groupName</span><span class="p">][</span><span class="s2">&quot;groupItem&quot;</span><span class="p">][</span><span class="s2">&quot;advanced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">groupDependency</span><span class="p">:</span>
                        <span class="n">groupMap</span><span class="p">[</span><span class="n">groupName</span><span class="p">][</span><span class="s2">&quot;groupItem&quot;</span><span class="p">][</span><span class="s2">&quot;depends&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">firstUiElt</span><span class="p">[</span>
                            <span class="s2">&quot;depends&quot;</span>
                        <span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;proxy&quot;</span><span class="p">:</span> <span class="n">props</span><span class="p">,</span> <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="n">uis</span><span class="p">}</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper function validates the string we get from the client to make sure</span>
    <span class="c1"># it is one of the allowed proxies that has been set up on the server side.</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParaViewWebProxyManager.validate"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functionName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">functionName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">functionName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.create"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.create">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.create&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">functionName</span><span class="p">,</span>
        <span class="n">parentId</span><span class="p">,</span>
        <span class="n">initialValues</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">skipDomain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">subProxyValues</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new filter/source proxy as a child of the specified</span>
<span class="sd">        parent proxy.  Returns the proxy state for the newly created</span>
<span class="sd">        proxy as a JSON object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">functionName</span>
                <span class="o">+</span> <span class="s1">&#39;&quot; was not valid and could not be evaluated&#39;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">pid</span> <span class="o">=</span> <span class="n">parentId</span>
        <span class="n">parentProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">parentId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parentProxy</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">SetActiveSource</span><span class="p">(</span><span class="n">parentProxy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

        <span class="c1"># Create new source/filter</span>
        <span class="n">sanitizedInitialValues</span> <span class="o">=</span> <span class="n">sanitizeKeys</span><span class="p">(</span><span class="n">initialValues</span><span class="p">)</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowedProxies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">newProxy</span> <span class="o">=</span> <span class="n">paraview</span><span class="o">.</span><span class="n">simple</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">allowed</span><span class="p">](</span><span class="o">**</span><span class="n">sanitizedInitialValues</span><span class="p">)</span>

        <span class="c1"># Update subproxy values</span>
        <span class="k">if</span> <span class="n">newProxy</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subProxyName</span> <span class="ow">in</span> <span class="n">subProxyValues</span><span class="p">:</span>
                <span class="n">subProxy</span> <span class="o">=</span> <span class="n">newProxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">subProxyName</span><span class="p">)</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">subProxy</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">propName</span> <span class="ow">in</span> <span class="n">subProxyValues</span><span class="p">[</span><span class="n">subProxyName</span><span class="p">]:</span>
                        <span class="n">prop</span> <span class="o">=</span> <span class="n">subProxy</span><span class="o">.</span><span class="n">SMProxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propName</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">subProxyValues</span><span class="p">[</span><span class="n">subProxyName</span><span class="p">][</span><span class="n">propName</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="n">prop</span><span class="o">.</span><span class="n">SetElements</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">prop</span><span class="o">.</span><span class="n">SetElements</span><span class="p">([</span><span class="n">value</span><span class="p">])</span>
                    <span class="n">subProxy</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>

        <span class="c1"># To make WebGL export work</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipDomain</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">applyDomains</span><span class="p">(</span><span class="n">parentProxy</span><span class="p">,</span> <span class="n">newProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Caught exception applying domains:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">newProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">())</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.open"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.open">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.create.reader&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativePath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open relative file paths, attempting to use the file extension to select</span>
<span class="sd">        from the configured readers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileToLoad</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">relativePath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">relativePath</span><span class="p">:</span>
                <span class="n">validPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAbsolutePath</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validPath</span><span class="p">:</span>
                    <span class="n">fileToLoad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">validPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAbsolutePath</span><span class="p">(</span><span class="n">relativePath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">validPath</span><span class="p">:</span>
                <span class="n">fileToLoad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validPath</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No valid path name &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">relativePath</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="c1"># Get file extension and look for configured reader</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">fileToLoad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">fileToLoad</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>

        <span class="c1"># Check if we were asked to load a state file</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;pvsm&quot;</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">LoadState</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">newView</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">SetActiveView</span><span class="p">(</span><span class="n">newView</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;ResetActiveView&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">newView</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()}</span>

        <span class="n">readerName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span><span class="p">:</span>
            <span class="n">readerName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span><span class="p">[</span><span class="n">extension</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">customMethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span><span class="p">[</span><span class="n">extension</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">useDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerFactoryMap</span><span class="p">[</span><span class="n">extension</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Open the file(s)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">readerName</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">useDirectory</span><span class="p">:</span>
                <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">customMethod</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">customMethod</span><span class="p">:</span> <span class="n">fileToLoad</span><span class="p">}</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">paraview</span><span class="o">.</span><span class="n">simple</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">readerName</span><span class="p">](</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowUnconfiguredReaders</span><span class="p">:</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">OpenDataFile</span><span class="p">(</span><span class="n">fileToLoad</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No configured reader found for &quot;</span>
                    <span class="o">+</span> <span class="n">extension</span>
                    <span class="o">+</span> <span class="s2">&quot; files, and unconfigured readers are not enabled.&quot;</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="c1"># Rename the reader proxy</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">fileToLoad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">RenameSource</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>

        <span class="c1"># Representation, view, and camera setup</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">ResetCamera</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()}</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.get"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.get">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">,</span> <span class="n">ui</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the proxy state for the given proxyId as a JSON object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proxyProperties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">proxyId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillPropertyList</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">)</span>

        <span class="n">proxyProperties</span><span class="p">,</span> <span class="n">groupsInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorderProperties</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">)</span>
        <span class="n">proxyJson</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">proxyId</span><span class="p">}</span>

        <span class="c1"># Perform costly request only when needed</span>
        <span class="n">uiProperties</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ui</span><span class="p">:</span>
            <span class="n">uiProperties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUiProperties</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">)</span>

        <span class="c1"># Now restructure the flat, ordered lists to reflect grouping</span>
        <span class="n">restructuredProperties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restructureProperties</span><span class="p">(</span>
            <span class="n">groupsInfo</span><span class="p">,</span> <span class="n">proxyProperties</span><span class="p">,</span> <span class="n">uiProperties</span>
        <span class="p">)</span>

        <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restructuredProperties</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ui</span><span class="p">:</span>
            <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restructuredProperties</span><span class="p">[</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;specialHints&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">:</span>
            <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;hints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertyDetailsMap</span><span class="p">[</span><span class="s2">&quot;specialHints&quot;</span><span class="p">]</span>

        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="o">.</span><span class="n">SMProxy</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkSMRepresentationProxy&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">colorInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColorInformation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
            <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;colorBy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colorInfo</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="n">SMProxy</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkSMSourceProxy&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dataInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataInformation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
            <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataInfo</span>

        <span class="k">return</span> <span class="n">proxyJson</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.findProxyId"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.findProxyId">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.find.id&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">findProxyId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupName</span><span class="p">,</span> <span class="n">proxyName</span><span class="p">):</span>
        <span class="n">proxyMgr</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">ProxyManager</span><span class="p">()</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">proxyMgr</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span> <span class="n">proxyName</span><span class="p">)</span>
        <span class="n">proxyId</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">SMProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">proxyId</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.update"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.update">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.update&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertiesList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a list of properties and updates the corresponding proxies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">failureList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">newPropObj</span> <span class="ow">in</span> <span class="n">propertiesList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proxyId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newPropObj</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
                <span class="n">propertyName</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_make_name_valid</span><span class="p">(</span><span class="n">newPropObj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">propertyValue</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">removeUnicode</span><span class="p">(</span><span class="n">newPropObj</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
                <span class="n">proxyProperty</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_wrap_property</span><span class="p">(</span>
                    <span class="n">proxy</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="n">proxyProperty</span><span class="p">,</span> <span class="n">propertyValue</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">failureList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to set property for proxy &quot;</span>
                    <span class="o">+</span> <span class="n">proxyId</span>
                    <span class="o">+</span> <span class="s2">&quot;: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">newPropObj</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;errorList&quot;</span><span class="p">:</span> <span class="n">failureList</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.delete"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.delete">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.delete&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the proxy can be deleted (it is not the input to another</span>
<span class="sd">        proxy), and then deletes it if so.  Returns True if the proxy was</span>
<span class="sd">        deleted, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="n">canDelete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">for</span> <span class="n">proxyJson</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">()[</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">proxyId</span><span class="p">:</span>
                <span class="n">canDelete</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">proxyId</span><span class="p">:</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">proxyJson</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">canDelete</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateScalarBars</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">pid</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.list"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.list">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.list&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current proxy list, specifying for each proxy it&#39;s</span>
<span class="sd">        name, id, and parent (input) proxy id.  A &#39;parent&#39; of &#39;0&#39; means</span>
<span class="sd">        the proxy has no input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proxies</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">ProxyManager</span><span class="p">()</span><span class="o">.</span><span class="n">GetProxiesInGroup</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">)</span>
        <span class="n">viewProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="n">proxyObj</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">viewProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()}</span>
        <span class="n">proxyList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proxies</span><span class="p">:</span>
            <span class="n">listElt</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">proxies</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">viewProxy</span><span class="p">)</span>
            <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
            <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">Visibility</span>
            <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="s2">&quot;Input&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">proxy</span><span class="o">.</span><span class="n">Input</span><span class="p">:</span>
                <span class="n">inputProp</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">Input</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inputProp</span><span class="p">,</span> <span class="s2">&quot;GetNumberOfProxies&quot;</span><span class="p">):</span>
                    <span class="n">numProxies</span> <span class="o">=</span> <span class="n">inputProp</span><span class="o">.</span><span class="n">GetNumberOfProxies</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">numProxies</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;multiparent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numProxies</span>
                        <span class="k">for</span> <span class="n">inputIdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numProxies</span><span class="p">):</span>
                            <span class="n">proxyId</span> <span class="o">=</span> <span class="n">inputProp</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="n">inputIdx</span><span class="p">)</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">inputIdx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyId</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;parent_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inputIdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyId</span>
                    <span class="k">elif</span> <span class="n">numProxies</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputProp</span><span class="o">.</span><span class="n">GetProxy</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">listElt</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputProp</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span>

            <span class="n">proxyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listElt</span><span class="p">)</span>

        <span class="n">proxyObj</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyList</span>
        <span class="k">return</span> <span class="n">proxyObj</span></div>

<div class="viewcode-block" id="ParaViewWebProxyManager.available"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebProxyManager.available">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.proxy.manager.available&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeOfProxy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the available sources or filters, depending on the</span>
<span class="sd">        argument typeOfProxy, which can be either &#39;filters&#39; or &#39;sources&#39;.  If</span>
<span class="sd">        typeOfProxy is anything other than &#39;filter&#39; or &#39;source&#39;, the empty</span>
<span class="sd">        list will be returned.</span>

<span class="sd">        Any attempt to create a source or filter not returned by this method</span>
<span class="sd">        will result in an error response.  The returned list has the following</span>
<span class="sd">        form:</span>

<span class="sd">        [ &#39;Wavelet&#39;, &#39;Cone&#39;, &#39;Sphere&#39;, ... ]</span>

<span class="sd">           or</span>

<span class="sd">        [ &#39;Contour&#39;, &#39;Clip&#39;, &#39;Slice&#39;, ... ]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">availableList</span><span class="p">[</span><span class="n">typeOfProxy</span><span class="p">]</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Key/Value Store Protocol</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebKeyValuePairStore"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebKeyValuePairStore">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebKeyValuePairStore</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebKeyValuePairStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyValStore</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># RpcName: storeKeyPair =&gt; &#39;pv.keyvaluepair.store&#39;</span>
<div class="viewcode-block" id="ParaViewWebKeyValuePairStore.storeKeyPair"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebKeyValuePairStore.storeKeyPair">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.keyvaluepair.store&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">storeKeyPair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyValStore</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="c1"># RpcName: retrieveKeyPair =&gt; &#39;pv.keyvaluepair.retrieve&#39;</span>
<div class="viewcode-block" id="ParaViewWebKeyValuePairStore.retrieveKeyPair"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebKeyValuePairStore.retrieveKeyPair">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.keyvaluepair.retrieve&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">retrieveKeyPair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyValStore</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyValStore</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Save Data Protocol</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebSaveData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebSaveData">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebSaveData</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseSavePath</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebSaveData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="n">savePath</span> <span class="o">=</span> <span class="n">baseSavePath</span>

        <span class="k">if</span> <span class="n">baseSavePath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">baseSavePath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">savePath</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">baseSavePath</span> <span class="o">=</span> <span class="n">savePath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imageExtensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataExtensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;vtk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ex2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vti&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtu&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vtr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateExtensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pvsm&quot;</span><span class="p">]</span>

    <span class="c1"># RpcName: saveData =&gt; &#39;pv.data.save&#39;</span>
<div class="viewcode-block" id="ParaViewWebSaveData.saveData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebSaveData.saveData">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.data.save&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">saveData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save some data on the server side.  Can save data from a proxy, a</span>
<span class="sd">        screenshot, or else the current state.  Options may be different</span>
<span class="sd">        depending on the type of data to be save.  Saving a screenshot</span>
<span class="sd">        can take an optional size array indicating the desired width and</span>
<span class="sd">        height of the saved image.  Saving data can take an optional proxy</span>
<span class="sd">        id specifying which filter or source to save output from.</span>

<span class="sd">            options = {</span>
<span class="sd">                &#39;proxyId&#39;: &#39;426&#39;,</span>
<span class="sd">                &#39;size&#39;: [ &lt;imgWidth&gt;, &lt;imgHeight&gt; ]</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure file path exists</span>
        <span class="n">fullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseSavePath</span><span class="p">,</span> <span class="n">filePath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullPath</span><span class="p">))</span>

        <span class="c1"># Get file extension and look for configured reader</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">filePath</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>

        <span class="c1"># Now find out what kind of save it is, and do it</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageExtensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="c1"># Get the active view</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Keep track of current size</span>
                <span class="n">cw</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">ViewSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Resize to desired screenshot size</span>
                <span class="n">v</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])),</span>
                <span class="p">]</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>

                <span class="c1"># Save actual screenshot</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">SaveScreenshot</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span>

                <span class="c1"># Put the size back the way we found it</span>
                <span class="n">v</span><span class="o">.</span><span class="n">ViewSize</span> <span class="o">=</span> <span class="p">[</span><span class="n">cw</span><span class="p">,</span> <span class="n">ch</span><span class="p">]</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">SaveScreenshot</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataExtensions</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="s2">&quot;proxyId&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">proxyId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;proxyId&quot;</span><span class="p">])</span>
                <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">SaveData</span><span class="p">(</span><span class="n">fullPath</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateExtensions</span><span class="p">:</span>
            <span class="c1"># simple.SaveState(fullPath) # FIXME: Fixed after 4.3.1</span>
            <span class="n">servermanager</span><span class="o">.</span><span class="n">SaveState</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;ERROR: Unrecognized extension (</span><span class="si">%s</span><span class="s2">) in relative path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">extension</span><span class="p">,</span>
                <span class="n">filePath</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle remote Connection</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebRemoteConnection"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebRemoteConnection">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebRemoteConnection</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="c1"># RpcName: connect =&gt; pv.remote.connect</span>
<div class="viewcode-block" id="ParaViewWebRemoteConnection.connect"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebRemoteConnection.connect">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.remote.connect&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a connection to a remote pvserver.</span>
<span class="sd">        Expect an option argument which should override any of</span>
<span class="sd">        those default properties::</span>

<span class="sd">            {</span>
<span class="sd">            &#39;host&#39;: &#39;localhost&#39;,</span>
<span class="sd">            &#39;port&#39;: 11111,</span>
<span class="sd">            &#39;rs_host&#39;: None,</span>
<span class="sd">            &#39;rs_port&#39;: 11111</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ds_host</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
        <span class="n">ds_port</span> <span class="o">=</span> <span class="mi">11111</span>
        <span class="n">rs_host</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">rs_port</span> <span class="o">=</span> <span class="mi">11111</span>

        <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;host&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">ds_host</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;port&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">ds_port</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;rs_host&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">rs_host</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;rs_host&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;rs_port&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">rs_host</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;rs_port&quot;</span><span class="p">]</span>

        <span class="n">simple</span><span class="o">.</span><span class="n">Connect</span><span class="p">(</span><span class="n">ds_host</span><span class="p">,</span> <span class="n">ds_port</span><span class="p">,</span> <span class="n">rs_host</span><span class="p">,</span> <span class="n">rs_port</span><span class="p">)</span></div>

    <span class="c1"># RpcName: reverseConnect =&gt; pv.remote.reverse.connect</span>
<div class="viewcode-block" id="ParaViewWebRemoteConnection.reverseConnect"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebRemoteConnection.reverseConnect">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.remote.reverse.connect&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reverseConnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">11111</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a reverse connection to a server.  Listens on port and waits for</span>
<span class="sd">        an incoming connection from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">ReverseConnect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span></div>

    <span class="c1"># RpcName: pvDisconnect =&gt; pv.remote.disconnect</span>
<div class="viewcode-block" id="ParaViewWebRemoteConnection.pvDisconnect"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebRemoteConnection.pvDisconnect">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.remote.disconnect&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pvDisconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Free the current active session&quot;&quot;&quot;</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">()</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle remote Connection at startup</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebStartupRemoteConnection"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebStartupRemoteConnection">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebStartupRemoteConnection</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dsHost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dsPort</span><span class="o">=</span><span class="mi">11111</span><span class="p">,</span> <span class="n">rsHost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rsPort</span><span class="o">=</span><span class="mi">22221</span><span class="p">,</span> <span class="n">rcPort</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebStartupRemoteConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ParaViewWebStartupRemoteConnection</span><span class="o">.</span><span class="n">connected</span> <span class="ow">and</span> <span class="n">dsHost</span><span class="p">:</span>
            <span class="n">ParaViewWebStartupRemoteConnection</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">Connect</span><span class="p">(</span><span class="n">dsHost</span><span class="p">,</span> <span class="n">dsPort</span><span class="p">,</span> <span class="n">rsHost</span><span class="p">,</span> <span class="n">rsPort</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ParaViewWebStartupRemoteConnection</span><span class="o">.</span><span class="n">connected</span> <span class="ow">and</span> <span class="n">rcPort</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ParaViewWebStartupRemoteConnection</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">simple</span><span class="o">.</span><span class="n">ReverseConnect</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rcPort</span><span class="p">))</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle plugin loading at startup</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebStartupPluginLoader"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebStartupPluginLoader">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebStartupPluginLoader</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="n">loaded</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathSeparator</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebStartupPluginLoader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ParaViewWebStartupPluginLoader</span><span class="o">.</span><span class="n">loaded</span> <span class="ow">and</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="n">ParaViewWebStartupPluginLoader</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">plugins</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pathSeparator</span><span class="p">):</span>
                <span class="n">simple</span><span class="o">.</span><span class="n">LoadPlugin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle State Loading</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebStateLoader"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebStateLoader">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebStateLoader</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParaViewWebStateLoader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state_path</span> <span class="ow">and</span> <span class="n">state_path</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.pvsm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadState</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>

    <span class="c1"># RpcName: loadState =&gt; pv.loader.state</span>
<div class="viewcode-block" id="ParaViewWebStateLoader.loadState"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebStateLoader.loadState">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.loader.state&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">loadState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a state file and return the list of view ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">LoadState</span><span class="p">(</span><span class="n">state_file</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRenderViews</span><span class="p">():</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ids</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle Server File Listing</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebFileListing"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebFileListing">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebFileListing</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">basePath</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">excludeRegex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\.|~$|^\$&quot;</span><span class="p">,</span>
        <span class="n">groupRegex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;[0-9]+\.&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure the way the WebFile browser will expose the server content.</span>
<span class="sd">         - basePath: specify the base directory (or directories) that we should start with, if this</span>
<span class="sd">         parameter takes the form: &quot;name1=path1|name2=path2|...&quot;, then we will treat this as the</span>
<span class="sd">         case where multiple data directories are required.  In this case, each top-level directory</span>
<span class="sd">         will be given the name associated with the directory in the argument.</span>
<span class="sd">         - name: Name of that base directory that will show up on the web</span>
<span class="sd">         - excludeRegex: Regular expression of what should be excluded from the list of files/directories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBaseDirectory</span><span class="p">(</span><span class="n">basePath</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rootName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overrideDataDirKey</span> <span class="ow">or</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">excludeRegex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gPattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">groupRegex</span><span class="p">)</span>
        <span class="n">pxm</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">ProxyManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span> <span class="o">=</span> <span class="n">pxm</span><span class="o">.</span><span class="n">NewProxy</span><span class="p">(</span><span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;ListDirectory&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">VectorProperty</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;FileList&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">VectorProperty</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DirectoryList&quot;</span><span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ParaViewWebFileListing.handleSingleRoot"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebFileListing.handleSingleRoot">[docs]</a>    <span class="k">def</span> <span class="nf">handleSingleRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseDirectory</span><span class="p">,</span> <span class="n">relativeDir</span><span class="p">,</span> <span class="n">startPath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">startPath</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rootName</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relativeDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootName</span><span class="p">):</span>
            <span class="n">relativeDir</span> <span class="o">=</span> <span class="n">relativeDir</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootName</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="n">relativeDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="n">currentPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">baseDirectory</span><span class="p">,</span> <span class="n">relativeDir</span><span class="p">))</span>
        <span class="n">normBase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">baseDirectory</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">currentPath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">normBase</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### CAUTION ==========================================&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Attempt to get to another root path ###&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  =&gt; Requested:&quot;</span><span class="p">,</span> <span class="n">relativeDir</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  =&gt; BaseDir:&quot;</span><span class="p">,</span> <span class="n">normBase</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  =&gt; Computed path:&quot;</span><span class="p">,</span> <span class="n">currentPath</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### CAUTION ==========================================&quot;</span><span class="p">)</span>
            <span class="n">currentPath</span> <span class="o">=</span> <span class="n">normBase</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">currentPath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory_proxy</span><span class="o">.</span><span class="n">UpdatePropertyInformation</span><span class="p">()</span>

        <span class="c1"># build file/dir lists</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="o">.</span><span class="n">GetData</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="o">.</span><span class="n">GetData</span><span class="p">()})</span>

        <span class="n">dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span><span class="o">.</span><span class="n">GetData</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
                    <span class="n">dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directoryList</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">relativeDir</span><span class="p">,</span>
            <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
            <span class="s2">&quot;dirs&quot;</span><span class="p">:</span> <span class="n">dirs</span><span class="p">,</span>
            <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">relativeDir</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootName</span>

        <span class="c1"># Filter files to create groups. Dicts are not orderable in Py3 - supply a key function.</span>
        <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;groups&quot;</span><span class="p">]</span>
        <span class="n">groupIdx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">filesToRemove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">fileSplit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gPattern</span><span class="p">,</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fileSplit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">filesToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">gName</span> <span class="o">=</span> <span class="s2">&quot;*.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fileSplit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gName</span> <span class="ow">in</span> <span class="n">groupIdx</span><span class="p">:</span>
                    <span class="n">groupIdx</span><span class="p">[</span><span class="n">gName</span><span class="p">][</span><span class="s2">&quot;files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">groupIdx</span><span class="p">[</span><span class="n">gName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">file</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">gName</span><span class="p">}</span>
                    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupIdx</span><span class="p">[</span><span class="n">gName</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filesToRemove</span><span class="p">:</span>
            <span class="n">gName</span> <span class="o">=</span> <span class="s2">&quot;*.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gPattern</span><span class="p">,</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupIdx</span><span class="p">[</span><span class="n">gName</span><span class="p">][</span><span class="s2">&quot;files&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">groupIdx</span><span class="p">[</span><span class="n">gName</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ParaViewWebFileListing.handleMultiRoot"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebFileListing.handleMultiRoot">[docs]</a>    <span class="k">def</span> <span class="nf">handleMultiRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeDir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">relativeDir</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootName</span><span class="p">,</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;dirs&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">),</span>
                <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rootName</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="n">pathList</span> <span class="o">=</span> <span class="n">relativeDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">currentBaseDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseDirectoryMap</span><span class="p">[</span><span class="n">pathList</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleSingleRoot</span><span class="p">(</span><span class="n">currentBaseDir</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">pathList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># must be greater than 2</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleSingleRoot</span><span class="p">(</span>
                <span class="n">currentBaseDir</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pathList</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">pathList</span><span class="p">[</span><span class="mi">2</span><span class="p">:]),</span> <span class="n">pathList</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span></div>

    <span class="c1"># RpcName: listServerDirectory =&gt; file.server.directory.list</span>
<div class="viewcode-block" id="ParaViewWebFileListing.listServerDirectory"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebFileListing.listServerDirectory">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;file.server.directory.list&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">listServerDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeDir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RPC Callback to list a server directory relative to the basePath</span>
<span class="sd">        provided at start-up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiRoot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleMultiRoot</span><span class="p">(</span><span class="n">relativeDir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleSingleRoot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseDirectory</span><span class="p">,</span> <span class="n">relativeDir</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle Data Selection</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="ParaViewWebSelectionHandler"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebSelectionHandler">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebSelectionHandler</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_interaction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># RpcName: startSelection =&gt; pv.selection.start</span>
<div class="viewcode-block" id="ParaViewWebSelectionHandler.startSelection"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebSelectionHandler.startSelection">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.selection.start&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">startSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewId</span><span class="p">,</span> <span class="n">selectionType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to initialize an interactive selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewId</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">IsSelectionAvailable</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_interaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">InteractionMode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">InteractionMode</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">vtkPVRenderView</span><span class="o">.</span><span class="n">INTERACTION_MODE_SELECTION</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="c1"># RpcName: endSelection =&gt; pv.selection.end</span>
<div class="viewcode-block" id="ParaViewWebSelectionHandler.endSelection"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebSelectionHandler.endSelection">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.selection.end&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">endSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">extract</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to finalize an interactive selection by providing</span>
<span class="sd">        the [ startPointX, startPointY, endPointX, endPointY ] area</span>
<span class="sd">        where (0,0) match the lower left corner of the pixel screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">InteractionMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_interaction</span>
            <span class="n">representations</span> <span class="o">=</span> <span class="n">vtkCollection</span><span class="p">()</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="n">vtkCollection</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">SelectSurfacePoints</span><span class="p">(</span>
                    <span class="n">area</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">SelectSurfaceCells</span><span class="p">(</span>
                    <span class="n">area</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">SelectFrustumPoints</span><span class="p">(</span>
                    <span class="n">area</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">SelectFrustumCells</span><span class="p">(</span>
                    <span class="n">area</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_view</span><span class="o">.</span><span class="n">SelectSurfacePoints</span><span class="p">(</span>
                    <span class="n">area</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">False</span>
                <span class="p">)</span>
            <span class="c1"># Don&#39;t know what to do if more than one representation/source</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">representations</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()</span> <span class="o">==</span> <span class="n">sources</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">sources</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="c1"># We are good for selection</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_getPyProxy</span><span class="p">(</span><span class="n">representations</span><span class="o">.</span><span class="n">GetItemAsObject</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">selection</span> <span class="o">=</span> <span class="n">servermanager</span><span class="o">.</span><span class="n">_getPyProxy</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">GetItemAsObject</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">extract</span><span class="p">:</span>
                    <span class="n">extract</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">ExtractSelection</span><span class="p">(</span>
                        <span class="n">Input</span><span class="o">=</span><span class="n">rep</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">Selection</span><span class="o">=</span><span class="n">selection</span>
                    <span class="p">)</span>
                    <span class="n">simple</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">extract</span><span class="p">)</span>
                    <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rep</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">SMProxy</span><span class="o">.</span><span class="n">SetSelectionInput</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">SMProxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle Data Export</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebExportData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebExportData">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebExportData</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basePath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_export_path</span> <span class="o">=</span> <span class="n">basePath</span>

    <span class="c1"># RpcName: exportData =&gt; pv.export.data</span>
<div class="viewcode-block" id="ParaViewWebExportData.exportData"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebExportData.exportData">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.export.data&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">exportData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_export_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">fullpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;.vtk&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fullpath</span> <span class="o">+=</span> <span class="s2">&quot;.vtk&quot;</span>
        <span class="n">parentDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parentDir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parentDir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">DataSetWriter</span><span class="p">(</span><span class="n">Input</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span> <span class="n">FileName</span><span class="o">=</span><span class="n">fullpath</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">UpdatePipeline</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">writer</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Protocols useful only for testing purposes</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="ParaViewWebTestProtocols"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTestProtocols">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebTestProtocols</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="c1"># RpcName: clearAll =&gt; pv.test.reset</span>
<div class="viewcode-block" id="ParaViewWebTestProtocols.clearAll"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTestProtocols.clearAll">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.test.reset&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">clearAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Connect</span><span class="p">()</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRenderView</span><span class="p">()</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">SetActiveView</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">simple</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;UpdateEvent&quot;</span><span class="p">)</span></div>

    <span class="c1"># RpcName: getColoringInfo =&gt; pv.test.color.info.get</span>
<div class="viewcode-block" id="ParaViewWebTestProtocols.getColoringInfo"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTestProtocols.getColoringInfo">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.test.color.info.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getColoringInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">LookupTable</span>
        <span class="n">arrayInfo</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetArrayInformationForColorArray</span><span class="p">()</span>
        <span class="n">arrayName</span> <span class="o">=</span> <span class="n">arrayInfo</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;arrayName&quot;</span><span class="p">:</span> <span class="n">arrayName</span><span class="p">,</span>
            <span class="s2">&quot;vectorMode&quot;</span><span class="p">:</span> <span class="n">lut</span><span class="o">.</span><span class="n">VectorMode</span><span class="p">,</span>
            <span class="s2">&quot;vectorComponent&quot;</span><span class="p">:</span> <span class="n">lut</span><span class="o">.</span><span class="n">VectorComponent</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ParaViewWebTestProtocols.getReprFromSource"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebTestProtocols.getReprFromSource">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.test.repr.get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getReprFromSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcProxyId</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">srcProxyId</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;reprProxyId&quot;</span><span class="p">:</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()}</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># Handle Widget Representation</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>


<span class="k">def</span> <span class="nf">_line_update_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">Point1WorldPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Point1</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">Point2WorldPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Point2</span>


<span class="k">def</span> <span class="nf">_line_widget_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Point1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Point1WorldPositionInfo&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Point2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Point2WorldPositionInfo&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_plane_update_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;OriginInfo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Origin</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">Origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Origin</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">Normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_plane_widget_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Origin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;OriginInfo&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;Normal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;NormalInfo&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>
    <span class="n">_hide_plane</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_draw_plane</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DrawPlane&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_hide_plane</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DrawPlane&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>


<div class="viewcode-block" id="ParaViewWebWidgetManager"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebWidgetManager">[docs]</a><span class="k">class</span> <span class="nc">ParaViewWebWidgetManager</span><span class="p">(</span><span class="n">ParaViewWebProtocol</span><span class="p">):</span>

    <span class="c1"># RpcName: addRuler =&gt; pv.widgets.ruler.add</span>
<div class="viewcode-block" id="ParaViewWebWidgetManager.addRuler"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebWidgetManager.addRuler">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.widgets.ruler.add&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">addRuler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">Ruler</span><span class="p">(</span><span class="n">Point1</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">Point2</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createWidgetRepresentation</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">GetGlobalID</span><span class="p">(),</span> <span class="n">view_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span></div>

    <span class="c1"># RpcName: createWidgetRepresentation =&gt; pv.widgets.representation.create</span>
<div class="viewcode-block" id="ParaViewWebWidgetManager.createWidgetRepresentation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebWidgetManager.createWidgetRepresentation">[docs]</a>    <span class="nd">@exportRpc</span><span class="p">(</span><span class="s2">&quot;pv.widgets.representation.create&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">createWidgetRepresentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">view_id</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapIdToProxy</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">view_id</span><span class="p">)</span>
        <span class="n">widgetProxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Find the corresponding widget representation</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Plane&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;ImplicitPlaneWidgetRepresentation&quot;</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;UpdateWidget&quot;</span><span class="p">,</span> <span class="n">_plane_update_widget</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;WidgetUpdate&quot;</span><span class="p">,</span> <span class="n">_plane_widget_update</span><span class="p">)</span>
            <span class="n">widgetProxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;DrawPlane&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">widgetProxy</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s2">&quot;PlaceFactor&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">UpdateWidget</span><span class="p">(</span><span class="n">widgetProxy</span><span class="p">)</span>
            <span class="n">widgetProxy</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s2">&quot;StartInteractionEvent&quot;</span><span class="p">,</span> <span class="n">_draw_plane</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">Observed</span> <span class="o">=</span> <span class="n">widgetProxy</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">ObserverTag</span> <span class="o">=</span> <span class="n">widgetProxy</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">WidgetUpdate</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Box&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;BoxWidgetRepresentation&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Handle&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;HandleWidgetRepresentation&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;PointSource&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;PointSourceWidgetRepresentation&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;LineSource&quot;</span>
            <span class="ow">or</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;HighResolutionLineSource&quot;</span>
        <span class="p">):</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;LineSourceWidgetRepresentation&quot;</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;UpdateWidget&quot;</span><span class="p">,</span> <span class="n">_line_update_widget</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;WidgetUpdate&quot;</span><span class="p">,</span> <span class="n">_line_widget_update</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">UpdateWidget</span><span class="p">(</span><span class="n">widgetProxy</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">Observed</span> <span class="o">=</span> <span class="n">widgetProxy</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">ObserverTag</span> <span class="o">=</span> <span class="n">widgetProxy</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">WidgetUpdate</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;LineWidgetRepresentation&quot;</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;UpdateWidget&quot;</span><span class="p">,</span> <span class="n">_line_update_widget</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;WidgetUpdate&quot;</span><span class="p">,</span> <span class="n">_line_widget_update</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">UpdateWidget</span><span class="p">(</span><span class="n">widgetProxy</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">Observed</span> <span class="o">=</span> <span class="n">widgetProxy</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">ObserverTag</span> <span class="o">=</span> <span class="n">widgetProxy</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">WidgetUpdate</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruler&quot;</span><span class="p">]:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;DistanceWidgetRepresentation&quot;</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;UpdateWidget&quot;</span><span class="p">,</span> <span class="n">_line_update_widget</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;WidgetUpdate&quot;</span><span class="p">,</span> <span class="n">_line_widget_update</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">UpdateWidget</span><span class="p">(</span><span class="n">widgetProxy</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">Observed</span> <span class="o">=</span> <span class="n">widgetProxy</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">ObserverTag</span> <span class="o">=</span> <span class="n">widgetProxy</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
                <span class="s2">&quot;EndInteractionEvent&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">WidgetUpdate</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Sphere&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;SphereWidgetRepresentation&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Spline&quot;</span><span class="p">:</span>
            <span class="n">widgetProxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateWidgetRepresentation</span><span class="p">(</span>
                <span class="n">view</span><span class="p">,</span> <span class="s2">&quot;SplineWidgetRepresentation&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No widget representation for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">widgetProxy</span><span class="o">.</span><span class="n">GetGlobalIDAsString</span><span class="p">()</span></div>

<div class="viewcode-block" id="ParaViewWebWidgetManager.CreateWidgetRepresentation"><a class="viewcode-back" href="../../../paraview.web.protocols.html#paraview.web.protocols.ParaViewWebWidgetManager.CreateWidgetRepresentation">[docs]</a>    <span class="k">def</span> <span class="nf">CreateWidgetRepresentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">CreateProxy</span><span class="p">(</span><span class="s2">&quot;representations&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pythonWrap</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">servermanager</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">proxy</span><span class="o">.</span><span class="n">GetXMLName</span><span class="p">()]()</span>
        <span class="n">pythonWrap</span><span class="o">.</span><span class="n">UpdateVTKObjects</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">Representations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pythonWrap</span><span class="p">)</span>
        <span class="n">pythonWrap</span><span class="o">.</span><span class="n">Visibility</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pythonWrap</span><span class="o">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">pythonWrap</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013, Kitware, Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   
  <!-- KW:BEGIN -->
  <script type="text/javascript" src="/paraview-docs/paraview-version.js"></script>
  <!-- KW:END -->
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>